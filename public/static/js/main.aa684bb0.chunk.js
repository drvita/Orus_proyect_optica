(this.webpackJsonpreact_frontend=this.webpackJsonpreact_frontend||[]).push([[0],{26:function(e,a,t){e.exports=t(38)},38:function(e,a,t){"use strict";t.r(a);var n=t(7),r=t(1),o=t(2),l=t(4),s=t(3),c=t(0),i=t.n(c),m=t(24),d=t(8),u=t(10),p=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(){return Object(r.a)(this,t),a.apply(this,arguments)}return Object(o.a)(t,[{key:"render",value:function(){return i.a.createElement("nav",{className:"main-header navbar navbar-expand navbar-dark navbar-lightblue"},i.a.createElement("ul",{className:"navbar-nav"},i.a.createElement("li",{className:"nav-item"},i.a.createElement("a",{className:"nav-link","data-widget":"pushmenu",href:"#end",role:"button"},i.a.createElement("i",{className:"fas fa-bars"})))),i.a.createElement("ul",{className:"navbar-nav ml-auto"},i.a.createElement("li",{className:"nav-item dropdown"},i.a.createElement("a",{href:"#end",className:"nav-link","data-toggle":"dropdown"},i.a.createElement("i",{className:"far fa-comments"}),i.a.createElement("span",{className:"badge badge-danger navbar-badge"},"0")),i.a.createElement("div",{className:"dropdown-menu dropdown-menu-lg dropdown-menu-right"},i.a.createElement("a",{href:"#end",className:"dropdown-item"},i.a.createElement("div",{className:"media"},i.a.createElement("div",{className:"media-body"},i.a.createElement("h3",{className:"dropdown-item-title"},"Brad Diesel",i.a.createElement("span",{className:"float-right text-sm text-danger"},i.a.createElement("i",{className:"fas fa-star"}))),i.a.createElement("p",{className:"text-sm"},"Call me whenever you can..."),i.a.createElement("p",{className:"text-sm text-muted"},i.a.createElement("i",{className:"far fa-clock mr-1"})," 4 Hours Ago")))),i.a.createElement("div",{className:"dropdown-divider"}),i.a.createElement("a",{href:"#end",className:"dropdown-item dropdown-footer"},"See All Messages"))),i.a.createElement("li",{className:"nav-item dropdown"},i.a.createElement("a",{className:"nav-link","data-toggle":"dropdown",href:"#end"},i.a.createElement("i",{className:"far fa-bell"}),i.a.createElement("span",{className:"badge badge-warning navbar-badge"},"0")),i.a.createElement("div",{className:"dropdown-menu dropdown-menu-lg dropdown-menu-right"},i.a.createElement("span",{className:"dropdown-header"},"15 Notifications"),i.a.createElement("div",{className:"dropdown-divider"}),i.a.createElement("a",{href:"#end",className:"dropdown-item"},i.a.createElement("i",{className:"fas fa-file mr-2"})," 3 new reports",i.a.createElement("span",{className:"float-right text-muted text-sm"},"2 days")),i.a.createElement("div",{className:"dropdown-divider"}),i.a.createElement("a",{href:"#end",className:"dropdown-item dropdown-footer"},"See All Notifications")))))}}]),t}(c.Component),h=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(){var e;Object(r.a)(this,t);for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return(e=a.call.apply(a,[this].concat(o))).changePage=function(a){e.props.page(a)},e.handleLogOut=function(a){a.preventDefault(),window.Swal.fire({title:"Session",text:"\xbfEsta seguro de cerrar la sesion?",icon:"question",showCancelButton:!0,confirmButtonColor:"#007bff",confirmButtonText:"Si",cancelButtonText:"Cancelar"}).then((function(a){a&&!a.dismiss&&a.value&&(e.props.logOut(),e.changePage("/"))}))},e}return Object(o.a)(t,[{key:"render",value:function(){var e=this,a=this.props,t=a.companyName,n=a.user,r=a.active,o="/img/avatars/avatar5.png";return 1===n.rol&&(o="/img/avatars/avatar2.png"),n.rol||(o="/img/avatars/avatar3.png"),2===n.idUser&&(o="/img/avatars/avatar4.png"),i.a.createElement("aside",{className:"main-sidebar sidebar-dark-primary elevation-4"},i.a.createElement(d.b,{to:"/",className:"brand-link",onClick:function(a){e.changePage("/")}},i.a.createElement("img",{src:"/img/AdminLTELogo.png",alt:t+" logo ",className:"brand-image img-circle elevation-3",style:{opacity:.8}}),i.a.createElement("span",{className:"brand-text font-weight-light text-uppercase"},t)),i.a.createElement("div",{className:"sidebar"},i.a.createElement("div",{className:"user-panel mt-3 pb-3 mb-3 d-flex"},i.a.createElement("div",{className:"image"},i.a.createElement("img",{src:o,className:"img-circle elevation-2",alt:n.name})),i.a.createElement("div",{className:"info"},i.a.createElement("a",{href:"#end",className:"d-block text-capitalize"},n.name,i.a.createElement("small",{className:"text-lowercase"},"(",n.username,")"),i.a.createElement("br",null),i.a.createElement("span",{className:"badge badge-light"},n.rol>0?1===n.rol?"Ventas":"Optometrista":"Administrador")))),i.a.createElement("nav",{className:"mt-2"},i.a.createElement("ul",{className:"nav nav-pills nav-sidebar flex-column","data-widget":"treeview",role:"menu","data-accordion":"false"},i.a.createElement("li",{className:"nav-item has-treeview"},i.a.createElement(d.b,{to:"/",className:"dashboard"===r?"nav-link active":"nav-link",onClick:function(a){e.changePage("/")}},i.a.createElement("i",{className:"nav-icon fas fa-tachometer-alt"}),i.a.createElement("p",null,"Dashboard",i.a.createElement("i",{className:"right fas fa-angle-left"})))),i.a.createElement("li",{className:"nav-item has-treeview"},i.a.createElement(d.b,{to:"/contactos",className:"contactos"===r?"nav-link active":"nav-link",onClick:function(a){e.changePage("/contactos")}},i.a.createElement("i",{className:"nav-icon fas fa-address-book"}),i.a.createElement("p",null,"Contactos",i.a.createElement("i",{className:"right fas fa-angle-left"})))),2!==n.rol&&n.rol?null:i.a.createElement("li",{className:"nav-item has-treeview"},i.a.createElement(d.b,{to:"/consultorio",className:"consultorio"===r?"nav-link active":"nav-link",onClick:function(a){e.changePage("/consultorio")}},i.a.createElement("i",{className:"nav-icon fas fa-notes-medical"}),i.a.createElement("p",null,"Consultorio",i.a.createElement("i",{className:"right fas fa-angle-left"})))),n.rol<=1?i.a.createElement("li",{className:"nav-item has-treeview"},i.a.createElement(d.b,{to:"/pedidos",className:"pedidos"===r?"nav-link active":"nav-link",onClick:function(a){e.changePage("/pedidos")}},i.a.createElement("i",{className:"nav-icon fas fa-clipboard-list"}),i.a.createElement("p",null,"Pedidos",i.a.createElement("i",{className:"right fas fa-angle-left"})))):null,n.rol<=1?i.a.createElement("li",{className:"nav-item has-treeview"},i.a.createElement(d.b,{to:"/notas",className:"notas"===r?"nav-link active":"nav-link",onClick:function(a){e.changePage("/Ventas")}},i.a.createElement("i",{className:"nav-icon fas fa-cash-register"}),i.a.createElement("p",null,"Ventas",i.a.createElement("i",{className:"right fas fa-angle-left"})))):null,n.rol?null:i.a.createElement(i.a.Fragment,null,i.a.createElement("li",{className:"nav-item has-treeview"},i.a.createElement(d.b,{to:"/almacen",className:"almacen"===r?"nav-link active":"nav-link",onClick:function(a){e.changePage("/almacen")}},i.a.createElement("i",{className:"nav-icon fas fa-database"}),i.a.createElement("p",null,"Almacen",i.a.createElement("i",{className:"right fas fa-angle-left"})))),i.a.createElement("li",{className:"nav-item has-treeview"},i.a.createElement(d.b,{to:"/usuarios",className:"usuarios"===r?"nav-link active":"nav-link",onClick:function(a){e.changePage("/usuarios")}},i.a.createElement("i",{className:"nav-icon fas fa-user"}),i.a.createElement("p",null,"Usuarios",i.a.createElement("i",{className:"right fas fa-angle-left"})))),i.a.createElement("li",{className:"nav-item has-treeview"},i.a.createElement(d.b,{to:"/configuraciones",className:"configuraciones"===r?"nav-link active":"nav-link",onClick:function(a){e.changePage("/configuraciones")}},i.a.createElement("i",{className:"nav-icon fas fa-tools"}),i.a.createElement("p",null,"Configuraciones",i.a.createElement("i",{className:"right fas fa-angle-left"}))))),i.a.createElement("li",{className:"nav-item has-treeview"},i.a.createElement(d.b,{to:"/",className:"nav-link",onClick:this.handleLogOut},i.a.createElement("i",{className:"nav-icon fas fa-sign-out-alt"}),i.a.createElement("p",null,"Cerrar sesion")))))))}}]),t}(c.Component),g=t(5),f=t.n(g),E=(t(12),function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(e){var n;return Object(r.a)(this,t),(n=a.call(this,e)).state={date:f()().format("LLLL")},setInterval((function(){console.log("Actualizando hora de sistema"),n.setState({date:f()().format("LLLL")})}),6e4),n}return Object(o.a)(t,[{key:"render",value:function(){var e=this.props.title;return i.a.createElement("div",{className:"content-header"},i.a.createElement("div",{className:"container-fluid"},i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-6"},i.a.createElement("h1",{className:"m-0 text-dark text-capitalize"},e)),i.a.createElement("div",{className:"col"},i.a.createElement("h6",{className:"text-dark text-right"},this.state.date)))),i.a.createElement("hr",null))}}]),t}(c.Component)),v=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(){return Object(r.a)(this,t),a.apply(this,arguments)}return Object(o.a)(t,[{key:"render",value:function(){return i.a.createElement("footer",{className:"main-footer d-print-none"},i.a.createElement("div",{className:"float-right d-none d-sm-inline"},"V2.0"),i.a.createElement("strong",null,"Copyright \xa9 2015-2020 ",i.a.createElement("a",{href:"#end"},"Orus"),".")," ","Todos los derechos reservados.")}}]),t}(c.Component),b=t(6),N=t.n(b),y=t(9),w=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(){var e;Object(r.a)(this,t);for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return(e=a.call.apply(a,[this].concat(o))).handleOrder=function(a){e.props.handleOrder(a)},e}return Object(o.a)(t,[{key:"render",value:function(){var e=this,a=this.props,t=a.data,n=a.order,r=a.orderby,o=a.actions;return t.length?i.a.createElement("thead",{className:"thead-light"},i.a.createElement("tr",null,t.map((function(a,t){return a.filter?i.a.createElement("th",{scope:"col",key:t,onClick:function(){e.handleOrder(a.type)},style:{cursor:"desc"===n?"n-resize":"s-resize"}},a.name,r===a.type?i.a.createElement("span",{className:"ml-2"},i.a.createElement("i",{className:"fas fa-sort text-primary"})):""):i.a.createElement("th",{scope:"col",key:t},a.name)})),o?i.a.createElement("th",{className:"text-center"},"Acciones"):"")):i.a.createElement("thead",null,i.a.createElement("tr",null,i.a.createElement("th",{scope:"col",className:"text-center"},"No hay datos de columnas")))}}]),t}(c.Component),x=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(){var e;Object(r.a)(this,t);for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return(e=a.call.apply(a,[this].concat(o))).handleChangePage=function(a){e.props.handleChangePage(a)},e}return Object(o.a)(t,[{key:"render",value:function(){var e=this,a=this.props.meta;return a.total>10&&i.a.createElement("div",{className:"btn-group"},i.a.createElement("ul",{className:"pagination pagination-sm"},i.a.createElement("li",{className:1===a.current_page?"page-item disabled":"page-item"},i.a.createElement("a",{className:1===a.current_page?"page-link text-dark":"page-link text-primary",href:"#pageBefore",onClick:function(a){a.preventDefault(),e.handleChangePage(1)}},"Primero")),i.a.createElement("li",{className:1===a.current_page?"page-item disabled":"page-item"},i.a.createElement("a",{className:1===a.current_page?"page-link text-dark":"page-link text-primary",href:"#pageBefore",onClick:function(t){t.preventDefault(),e.handleChangePage(a.current_page-1)}},i.a.createElement("i",{className:"fas fa-step-backward"}))),i.a.createElement("li",{className:"page-item"},i.a.createElement("span",{className:"page-link"},a.current_page," /"," ",Math.ceil(a.total/a.per_page).toFixed(0))),i.a.createElement("li",{className:a.current_page===a.last_page?"page-item disabled":"page-item"},i.a.createElement("a",{className:a.current_page===a.last_page?"page-link text-dark":"page-link text-primary",href:"#pageBefore",onClick:function(t){t.preventDefault(),e.handleChangePage(a.current_page+1)}},i.a.createElement("i",{className:"fas fa-step-forward"}))),i.a.createElement("li",{className:a.current_page===a.last_page?"page-item disabled":"page-item"},i.a.createElement("a",{className:a.current_page===a.last_page?"page-link text-dark":"page-link text-primary",href:"#pageBefore",onClick:function(t){t.preventDefault(),e.handleChangePage(a.last_page)}},"Ultimo"))))}}]),t}(c.Component),C=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(){var e;Object(r.a)(this,t);for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return(e=a.call.apply(a,[this].concat(o))).onKeyPressSearch=function(a){"Enter"===a.key&&(a.preventDefault(),e.setFilters())},e.onClickClean=function(){e.props.changeFilters("search",""),e.props.changeFilters("rol",""),e.setFilters()},e.setFilters=function(){e.props.handleChangePage(1),window.$("#filters").modal("hide")},e.changeFilters=function(a){var t=a.target,n=t.name,r=t.value;e.props.changeFilters(n,r)},e}return Object(o.a)(t,[{key:"render",value:function(){var e=this.props,a=e.search,t=e.rol;return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"btn-group"},i.a.createElement("a",{href:"#Filters",className:"btn btn-tool text-dark","data-toggle":"modal","data-target":"#filters"},i.a.createElement("i",{className:"fas fa-filter"}))),i.a.createElement("div",{className:"modal",tabIndex:"-1",role:"dialog",id:"filters"},i.a.createElement("div",{className:"modal-dialog"},i.a.createElement("div",{className:"modal-content"},i.a.createElement("div",{className:"modal-header"},i.a.createElement("h5",{className:"modal-title"},"Busquedas"),i.a.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-label":"Close"},i.a.createElement("span",{"aria-hidden":"true"},"\xd7"))),i.a.createElement("form",{className:"modal-body"},i.a.createElement("div",{className:"input-group mb-3"},i.a.createElement("div",{className:"input-group-prepend"},i.a.createElement("span",{className:"input-group-text"},i.a.createElement("i",{className:"fas fa-search"}))),i.a.createElement("input",{type:"text",name:"search",className:"form-control",placeholder:"Por: nombre, usuario o email",value:a,onChange:this.changeFilters,onKeyPress:this.onKeyPressSearch})),i.a.createElement("div",{className:"input-group mb-3"},i.a.createElement("label",null,"Rol"),i.a.createElement("div",{className:"input-group-prepend ml-4"},i.a.createElement("span",{className:"input-group-text"},i.a.createElement("i",{className:"fas fa-address-book"}))),i.a.createElement("select",{className:"form-control",name:"rol",value:t,onChange:this.changeFilters},i.a.createElement("option",{value:""},"Todos"),i.a.createElement("option",{value:"0"},"Administrador"),i.a.createElement("option",{value:"1"},"Ventas"),i.a.createElement("option",{value:"2"},"Optometrista")))),i.a.createElement("div",{className:"modal-footer"},i.a.createElement("div",{className:"btn-group btn-group-lg",role:"group"},i.a.createElement("button",{type:"button",className:"btn btn-outline-dark","data-dismiss":"modal"},i.a.createElement("i",{className:"fas fa-window-close mr-2"}),"Cancelar"),i.a.createElement("button",{type:"button",className:this.props.search||this.props.rol?"btn btn-outline-dark":"btn btn-outline-dark disabled",onClick:this.onClickClean},i.a.createElement("i",{className:"fas fa-eraser mr-2"}),"Limpiar"),i.a.createElement("button",{type:"button",className:"btn btn-outline-dark",onClick:this.setFilters,"data-dismiss":"modal"},i.a.createElement("i",{className:"fas fa-search mr-2"}),"Buscar")))))))}}]),t}(c.Component),k=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(){var e;Object(r.a)(this,t);for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return(e=a.call.apply(a,[this].concat(o))).handleDelete=function(a,t){e.props.delete(a,t)},e}return Object(o.a)(t,[{key:"render",value:function(){var e=this,a=this.props,t=a.item,n=a.edit,r=a.id;return i.a.createElement("td",{className:"text-right"},this.props.delete?i.a.createElement("a",{className:"btn-flat text-dark mr-4",href:"#delete",onClick:function(a){a.preventDefault(),e.handleDelete(r,t)}},i.a.createElement("i",{className:"fas fa-trash"})):"",n?i.a.createElement(d.b,{className:"btn-flat text-dark",to:n+r},i.a.createElement("i",{className:"fas fa-pencil-alt"})):"")}}]),t}(c.Component),S=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(e){var o;Object(r.a)(this,t),(o=a.call(this,e)).changeFilters=function(e,a){o.setState(Object(n.a)({},e,a))},o.handleOrder=function(e){o.setState({orderby:e,order:"desc"===o.state.order?"asc":"desc",load:!0})},o.handleChangePage=function(e){o.setState({page:e,load:!0})},o.handleDelete=function(e,a){window.Swal.fire({title:"Eliminar",text:"\xbfEsta seguro de eliminar el usuario "+a.toUpperCase()+"?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Eliminar",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,preConfirm:function(a){if(a){var t=o.state,n=t.host,r=t.token;return console.log("Solicitud de eliminaci\xf3n de usuario por API"),fetch("http://"+n+"/api/users/"+e,{method:"DELETE",signal:o.signal,headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+r}}).then(function(){var e=Object(y.a)(N.a.mark((function e(a){var t;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t={},204===a.status){e.next=5;break}return e.next=4,a.json();case 4:t=e.sent;case 5:if(a.ok){e.next=7;break}throw new Error(t.message);case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}()).catch((function(e){console.error("Orus fetch",e),window.Swal.fire("Fallo de conexion","Verifique la conexion al servidor","error")}))}}}).then((function(e){e&&!e.dismiss&&e.value?(console.log("Usuario eliminado"),window.Swal.fire({icon:"success",title:"Usuario eliminado con exito",showConfirmButton:!1,timer:1500}).then((function(e){return o.getUsers()}))):e&&!e.dismiss&&(console.log("Orus res: ",e),window.Swal.fire("Error","Se perdio la conexion con el servidor","error"))}))},o.getUsers=function(){var e=o.state,a=e.load,t=e.host,n=e.token,r="http://"+t+"/api/users",l="&orderby=".concat(o.state.orderby,"&order=").concat(o.state.order),s=o.state.search?"&search=".concat(o.state.search):"",c=o.state.rol.length>0?"&rol=".concat(o.state.rol):"",i=o.state.page>0?"?page="+o.state.page:"?page=1";a||o.setState({load:!0}),console.log("Solicitando usuarios a la API"),fetch(r+i+l+s+c,{method:"GET",signal:o.signal,headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+n}}).then((function(e){if(!e.ok)throw new Error(e.statusText);return e.json()})).then((function(e){e.data?(console.log("Descargando usuarios"),o.setState({users:e,load:!1})):(console.error("Orus: ",e.message),window.Swal.fire("Error","Al descargar usuarios","error"),o.setState({load:!1}))})).catch((function(e){console.error("Orus: "+e),window.Swal.fire("Fallo de conexion","Verifique la conexion al servidor","error"),o.setState({load:!1})}))};var l=JSON.parse(localStorage.getItem("OrusUsers"));return o.state={users:{data:[],meta:{}},load:!0,page:l?l.page:1,orderby:l?l.orderby:"created_at",order:l?l.order:"asc",search:l?l.search:"",rol:l?l.rol:"",host:e.data.host,token:e.data.token},o.controller=new AbortController,o.signal=o.controller.signal,o}return Object(o.a)(t,[{key:"componentWillUnmount",value:function(){this.controller.abort()}},{key:"componentDidMount",value:function(){this.getUsers(),localStorage.setItem("OrusUsers",JSON.stringify({page:this.state.page,orderby:this.state.orderby,order:this.state.order,search:this.state.search,rol:this.state.rol}))}},{key:"componentDidUpdate",value:function(e,a){!1===a.load&&!0===this.state.load&&(console.log("Recargando usuarios y almacenando configuracion"),localStorage.setItem("OrusUsers",JSON.stringify({page:this.state.page,orderby:this.state.orderby,order:this.state.order,search:this.state.search,rol:this.state.rol})),this.getUsers())}},{key:"render",value:function(){var e=this,a=this.state,t=a.users,n=a.load;return i.a.createElement("div",{className:"card card-primary card-outline"},i.a.createElement("div",{className:"card-header"},i.a.createElement("h2",{className:"card-title text-primary"},i.a.createElement("i",{className:"fas fa-user mr-1"}),"Usuarios registrados"),i.a.createElement("div",{className:"card-tools"},i.a.createElement(C,{search:this.state.search,rol:this.state.rol,changeFilters:this.changeFilters,handleChangePage:this.handleChangePage}),i.a.createElement(x,{meta:t.meta,handleChangePage:this.handleChangePage}))),i.a.createElement("div",{className:"card-body table-responsive p-0"},i.a.createElement("table",{className:"table table-bordered table-hover table-nowrap"},i.a.createElement(w,{orderby:this.state.orderby,order:this.state.order,data:[{name:"usuario",type:"username",filter:!0},{name:"nombre",type:"name",filter:!0},{name:"e-mail",type:"email",filter:!0},{name:"Rol",type:"rol",filter:!0},{name:"Actividad",type:"session"},{name:"Actualizado",type:"updated_at",filter:!0},{name:"Registrado",type:"created_at",filter:!0}],actions:!0,handleOrder:this.handleOrder}),i.a.createElement("tbody",null,n?i.a.createElement("tr",null,i.a.createElement("td",{colSpan:"9",className:"alert alert-light text-center p-4"},i.a.createElement("div",{className:"spinner-border text-primary",role:"status"},i.a.createElement("span",{className:"sr-only"},"Loading...")))):Object.keys(t.data).length?t.data.map((function(a){return i.a.createElement("tr",{key:a.id},i.a.createElement("th",{scope:"row"},i.a.createElement("span",{className:"text-capitalize text-primary"},a.username)),i.a.createElement("td",null,i.a.createElement(d.b,{to:"/usuarios/registro/"+a.id},i.a.createElement("span",{className:"badge badge-primary text-capitalize p-1"},a.name,i.a.createElement("i",{className:"fas fa-pencil-alt ml-1"})))),i.a.createElement("td",null,a.email),i.a.createElement("td",null,a.rol>0?1===a.rol?i.a.createElement("span",{className:"text-capitalize text-success"},i.a.createElement("i",{className:"fas fa-user-tag mr-2"}),"Ventas"):i.a.createElement("span",{className:"text-capitalize text-primary"},i.a.createElement("i",{className:"fas fa-user-tie mr-2"}),"Optometrista"):i.a.createElement("span",{className:"text-capitalize text-danger"},i.a.createElement("i",{className:"fas fa-user-shield mr-2"}),"Administrador")),i.a.createElement("td",null,a.session?f()(a.session.last_activity).fromNow():"--"),i.a.createElement("td",null,f()(a.updated_at).fromNow()),i.a.createElement("td",{className:"text-right"},f()(a.created_at).format("ll")),i.a.createElement(k,{id:a.id,item:a.username,delete:e.handleDelete,edit:"/usuarios/registro/"}))})):i.a.createElement("tr",null,i.a.createElement("th",{colSpan:"8",className:"alert alert-info text-center"},i.a.createElement("i",{className:"fas fa-info mr-2"}),"No hay datos para mostrar"))))),i.a.createElement("div",{className:"card-footer text-right"},i.a.createElement(d.b,{to:"/usuarios/registro",className:"btn btn-outline-primary btn-lg"},i.a.createElement("i",{className:"fas fa-plus mr-2"}),"Nuevo usuario")))}}]),t}(c.Component),O=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(e){var n;return Object(r.a)(this,t),(n=a.call(this,e)).handleChange=function(e){var a=e.target.value,t={target:{name:"validUserName",value:""}};e.target.value=a.replace(/ /g,"").toLowerCase(),/^[\w]{4,16}$/.test(a)?n.validUser(e.target.value,t):a.length>4?(n.setState({bgColor:"bg-red",validate:" border border-danger",text:"No tiene el formato de usuario"}),t.target.value=!1,n.props.onChange(t)):a.length||(n.setState({bgColor:"bg-blue",validate:" border border-danger",text:"Debe de tener de 4 a 16 caracteres alfanumericos."}),t.target.value=!1,n.props.onChange(t)),n.props.onChange(e)},n.validUser=function(e,a){var t=JSON.parse(localStorage.getItem("OrusSystem")),r="http://"+t.host+"/api/users",o="?username="+e;n.timeFetch&&clearTimeout(n.timeFetch),n.timeFetch=setTimeout((function(){n.setState({searchUser:!0}),fetch(r+o,{method:"GET",signal:n.signal,headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+t.token}}).then((function(e){return e.ok||(window.alert("Ups!\n Hubo un error, intentelo mas tarde"),console.error(e)),e.json()})).then((function(t){t.message?console.error("Error en la descarga de usuarios",t.message):t.data.length&&t.data[0].username.toLowerCase()===e?(n.setState({bgColor:"bg-red",validate:" border border-danger",text:"El usuario ya esta registrado.",searchUser:!1}),a.target.value=!1,n.props.onChange(a)):(n.setState({bgColor:"bg-blue",validate:"",searchUser:!1}),a.target.value=!0,n.props.onChange(a))})).catch((function(e){console.error(e)}))}),1e3)},n.state={bgColor:"bg-blue",validate:"",text:"Debe de tener al menos 4 caracteres.",searchUser:!1},n.controller=new AbortController,n.signal=n.controller.signal,n.timeFetch=null,n}return Object(o.a)(t,[{key:"componentWillUnmount",value:function(){this.controller.abort()}},{key:"render",value:function(){var e=this.props,a=e.col,t=e.username,n=this.state,r=n.bgColor,o=n.validate,l=n.text,s=n.searchUser;return i.a.createElement("div",{className:"col-"+a},t.length?i.a.createElement("small",null,i.a.createElement("label",null,"Usuario")):i.a.createElement("br",null),i.a.createElement("div",{className:"input-group"},i.a.createElement("div",{className:"input-group-prepend"},i.a.createElement("span",{className:"input-group-text "+r},s?i.a.createElement("i",{className:"fas fa-spinner"}):i.a.createElement("i",{className:"fas fa-user-check"}))),i.a.createElement("input",{type:"text",className:"form-control"+o,placeholder:"Usuario",name:"username",autoComplete:"off",autoFocus:"autofocus",value:t,onChange:this.handleChange,required:"required",minLength:"4",maxLength:"16",pattern:"^[\\w]{4,16}$"})),o?i.a.createElement("small",{className:"text-muted"},l):"")}}]),t}(c.Component),j=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(e){var n;return Object(r.a)(this,t),(n=a.call(this,e)).handleChange=function(e){var a=e.target.value,t={target:{name:"validUserEmail",value:!0}};e.target.value=a.replace(/\s/g,"").toLowerCase(),/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(a)?n.validEmail(e.target.value,t):a.length>8?(n.setState({bgColor:"bg-red",validate:" border border-danger",text:"No tiene el formato de un email"}),t.target.value=!1,n.props.onChange(t)):a.length||(n.setState({bgColor:"bg-blue",validate:"",text:"No tiene el formato de un email"}),t.target.value=!1,n.props.onChange(t)),n.props.onChange(e)},n.validEmail=function(e,a){var t=JSON.parse(localStorage.getItem("OrusSystem")),r="http://"+t.host+"/api/users",o="?email="+e;n.timeFetch&&clearTimeout(n.timeFetch),n.timeFetch=setTimeout((function(){n.setState({searchUser:!0}),fetch(r+o,{method:"GET",signal:n.signal,headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+t.token}}).then((function(e){return e.ok||(window.alert("Ups!\n Hubo un error, intentelo mas tarde"),console.error(e)),e.json()})).then((function(t){t.message?(console.error("Error en la descarga de usuarios",t.message),n.setState({bgColor:"bg-red",validate:" border border-danger",text:"Error en la consulta",searchUser:!1})):t.data.length&&t.data[0].email.toLowerCase()===e?(n.setState({bgColor:"bg-red",validate:" border border-danger",text:"El email ya esta registrado.",searchUser:!1}),a.target.value=!1,n.props.onChange(a)):(n.setState({bgColor:"bg-blue",validate:"",searchUser:!1}),a.target.value=!0,n.props.onChange(a))})).catch((function(e){console.error(e)}))}),1e3)},n.state={bgColor:"bg-blue",validate:"",text:"No tiene el formato de un email",searchUser:!1},n.controller=new AbortController,n.signal=n.controller.signal,n.timeFetch=null,n}return Object(o.a)(t,[{key:"componentWillUnmount",value:function(){this.controller.abort()}},{key:"render",value:function(){var e=this.props,a=e.col,t=e.email,n=this.state,r=n.bgColor,o=n.validate,l=n.text;return i.a.createElement("div",{className:"col-"+a},t.length?i.a.createElement("small",null,i.a.createElement("label",null,"Usuario")):i.a.createElement("br",null),i.a.createElement("div",{className:"input-group"},i.a.createElement("div",{className:"input-group-prepend"},i.a.createElement("span",{className:"input-group-text "+r},i.a.createElement("i",{className:"fas fa-at"}))),i.a.createElement("input",{type:"email",className:"form-control"+o,placeholder:"email",name:"email",autoComplete:"off",value:t,onChange:this.handleChange,required:"required"})),o?i.a.createElement("small",{className:"text-muted"},l):"")}}]),t}(c.Component),_=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(e){var o;return Object(r.a)(this,t),(o=a.call(this,e)).changePage=function(e){o.props.page(e.target.id)},o.catchInputs=function(e){var a=e.target,t=a.name,r=a.value;o.setState(Object(n.a)({},t,r))},o.handleSave=function(e){e.preventDefault();var a=o.state,t=a.id,n=a.validUserName,r=a.validUserEmail;return n?r?void window.Swal.fire({title:"Almacenamiento",text:t?"\xbfEsta seguro de actualizar el usuario?":"\xbfEsta seguro de crear un nuevo usuario?",icon:"question",showCancelButton:!0,confirmButtonColor:"#007bff",confirmButtonText:t?"Actualizar":"Crear",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,preConfirm:function(e){if(e){var a=o.state,t=a.host,n=a.token,r=a.id,l=a.name,s=a.username,c=a.rol,i=a.password,m={name:l,username:s,rol:c,email:a.email},d=r?"http://"+t+"/api/users/"+r:"http://"+t+"/api/users",u=r?"PUT":"POST";return i.length>8&&(m.password=i),console.log("Enviando datos del usuario a API"),fetch(d,{method:u,body:JSON.stringify(m),headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+n}}).then((function(e){if(!e.ok)throw new Error(e.statusText);return e.json()})).catch((function(e){console.error("Orus fetch",e),window.Swal.fire("Fallo de conexion","Verifique la conexion al servidor","error")}))}}}).then((function(e){if(e&&!e.dismiss&&e.value){var a=e.value;a.data?(console.log("Usuario almacenado"),window.Swal.fire({icon:"success",title:t?"Usuario actualizado con exito":"Usuario almacenado con exito",showConfirmButton:!1,timer:1500}).then((function(e){return o.props.history.goBack()}))):(window.Swal.fire("Error","al almacenar el usuario","error"),console.error("Orus res: ",a.message))}})):(window.Swal.fire({icon:"error",title:"El correo ya esta en uso",showConfirmButton:!1,timer:1500}),!1):(window.Swal.fire({icon:"error",title:"El nombre de usuario ya esta en uso",showConfirmButton:!1,timer:1500}),!1)},o.getUser=function(e){var a=o.state,t=a.host,n=a.token;e>0?fetch("http://"+t+"/api/users/"+e,{method:"GET",signal:o.signal,headers:{Accept:"application/json",Authorization:"Bearer "+n}}).then((function(e){if(!e.ok)throw new Error(e.statusText);return e.json()})).then((function(e){e.data?(console.log("Cargando datos de usuario"),o.setState({id:e.data.id,rol:e.data.rol,username:e.data.username,name:e.data.name,email:e.data.email,updated_at:e.data.updated_at,created_at:e.data.created_at,session:e.data.session,load:!1,validUserName:!0,validUserEmail:!0})):(console.error("Orus: ",e.message),window.Swal.fire("Error","Error en el sistema, comuniquese con el administrador de sistema","error"),o.setState({load:!1}))})).catch((function(e){console.log("Orus:",e),window.Swal.fire("Fallo de conexion","Verifique la conexion al servidor","error"),o.setState({load:!1})})):o.setState({load:!1})},o.state={id:0,rol:1,username:"",validUserName:!1,name:"",email:"",validUserEmail:!1,password:"",updated_at:"",created_at:"",session:{},load:!1,host:e.data.host,token:e.data.token},o.controller=new AbortController,o.signal=o.controller.signal,o}return Object(o.a)(t,[{key:"componentWillUnmount",value:function(){this.controller.abort()}},{key:"componentDidMount",value:function(){var e=this.props.match.params.id;e&&this.getUser(e)}},{key:"render",value:function(){var e=this.state,a=e.load,t=e.id,n=e.rol,r=e.username,o=e.name,l=e.email,s=e.password,c=e.updated_at,m=e.created_at,u=e.session,p=e.validUserName,h=e.validUserEmail,g=!(!a&&p&&o.length&&h);return i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col"},i.a.createElement("form",{className:"card card-primary card-outline",onSubmit:this.handleSave},i.a.createElement("div",{className:"card-header"},i.a.createElement("h1",{className:"card-title text-primary"},i.a.createElement("i",{className:"fas fa-user mr-2"}),t?"Editar usuario":"Registrar nuevo usuario")),i.a.createElement("div",{className:"card-body was-validated"},a?i.a.createElement("div",{className:"alert alert-light text-center p-4"},i.a.createElement("div",{className:"spinner-border text-primary",role:"status"},i.a.createElement("span",{className:"sr-only"},"Loading..."))):i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"row mb-3"},i.a.createElement(O,{username:r,col:6,onChange:this.catchInputs}),i.a.createElement("div",{className:"col-6"},o.length?i.a.createElement("small",null,i.a.createElement("label",null,"Nombre completo")):i.a.createElement("br",null),i.a.createElement("div",{className:"input-group mb-3"},i.a.createElement("div",{className:"input-group-prepend"},i.a.createElement("span",{className:"input-group-text bg-blue"},i.a.createElement("i",{className:"fas fa-user-tag"}))),i.a.createElement("input",{type:"text",className:"form-control text-capitalize",placeholder:"Nombre completo",name:"name",autoComplete:"off",value:o,onChange:this.catchInputs,required:"required",minLength:"8",pattern:"^[a-zA-Z]{2,20}[\\s]{1}[a-zA-Z]{2,20}.*"})))),i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-md-6"},s.length||t?i.a.createElement("small",null,i.a.createElement("label",null,"Contrase\xf1a"),t?"":i.a.createElement("span",{className:"ml-2"},"De 8 a 16 caracteres, por lo menos una mayuscula, un numero y un caracter especial")):i.a.createElement("br",null),i.a.createElement("div",{className:"input-group mb-3"},i.a.createElement("div",{className:"input-group-prepend"},i.a.createElement("span",{className:"input-group-text bg-blue"},i.a.createElement("i",{className:"fas fa-lock"}))),i.a.createElement("input",{type:"password",className:"form-control",placeholder:"Contrase\xf1a",name:"password",autoComplete:"off",value:s,onChange:this.catchInputs,required:!t,minLength:"8",maxLength:"16",pattern:"^(?=.*[A-Z])(?=.*[!@#$&.*])(?=.*[0-9])(?=.*[a-z]).{8,16}$"}))),i.a.createElement(j,{email:l,col:6,onChange:this.catchInputs})),i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-md-6"},i.a.createElement("small",null,i.a.createElement("label",null,"Rol")),i.a.createElement("div",{className:"input-group mb-3"},i.a.createElement("div",{className:"input-group-prepend"},i.a.createElement("span",{className:"input-group-text bg-blue"},i.a.createElement("i",{className:"fas fa-id-card"}))),i.a.createElement("select",{className:"custom-select",name:"rol",value:n,onChange:this.catchInputs},i.a.createElement("option",{value:"0"},"Administrador"),i.a.createElement("option",{value:"1"},"Ventas"),i.a.createElement("option",{value:"2"},"Optometrista"))))))),i.a.createElement("div",{className:"card-footer"},i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-md-12 text-right"},i.a.createElement("div",{className:"btn-group btn-group-lg",role:"group"},i.a.createElement(d.b,{to:"/usuarios",className:"btn btn-dark",onClick:this.changePage,id:"/usuarios"},i.a.createElement("i",{className:"fas fa-ban mr-1"}),"Cancelar"),i.a.createElement("button",{type:"submit",className:a?"btn btn-primary disabled":"btn btn-primary",disabled:!!g},i.a.createElement("i",{className:"fas fa-save mr-1"}),"Guardar"))))))),t?i.a.createElement("div",{className:"col"},i.a.createElement("div",{className:"card card-primary card-outline"},i.a.createElement("div",{className:"card-header"},i.a.createElement("h3",{className:"card-title text-primary"},i.a.createElement("i",{className:"fas fa-database mr-2"}),"Metadata")),i.a.createElement("div",{className:"card-body"},u?i.a.createElement("ul",{className:"list-group"},i.a.createElement("li",{className:"list-group-item"},i.a.createElement("h6",null,"Datos del usuario"),i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col"},i.a.createElement("span",{className:"text-primary"},"Registrado"),i.a.createElement("p",null,f()(m).fromNow())),i.a.createElement("div",{className:"col"},i.a.createElement("span",{className:"text-primary"},"Ultima actualizacion"),i.a.createElement("p",null,f()(c).fromNow())))),i.a.createElement("li",{className:"list-group-item"},i.a.createElement("h6",null,"Actividad"),i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col"},i.a.createElement("span",{className:"text-primary"},"IP"),i.a.createElement("p",null,u.ip_address)),i.a.createElement("div",{className:"col"},i.a.createElement("span",{className:"text-primary"},"Ultima actividad"),i.a.createElement("p",null,f()(u.last_activity).fromNow())))),i.a.createElement("li",{className:"list-group-item"},i.a.createElement("span",{className:"text-primary"},"Navegador y OS"),i.a.createElement("p",null,u.user_agent)),i.a.createElement("li",{className:"list-group-item"},i.a.createElement("span",{className:"text-primary"},"Token"),i.a.createElement("p",null,u.user_data))):i.a.createElement("p",null,"Usuario no ha registrado actividad.")))):null)}}]),t}(c.Component),I=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(){var e;Object(r.a)(this,t);for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return(e=a.call.apply(a,[this].concat(o))).onKeyPressSearch=function(a){"Enter"===a.key&&(a.preventDefault(),e.setFilters())},e.onClickClean=function(){e.props.changeFilters("search",""),e.setFilters()},e.setFilters=function(){e.props.handleChangePage(1),window.$("#filters").modal("hide")},e.changeFilters=function(a){var t=a.target,n=t.name,r=t.value;e.props.changeFilters(n,r)},e}return Object(o.a)(t,[{key:"render",value:function(){var e=this.props.search;return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"btn-group"},i.a.createElement("a",{href:"#Filters",className:"btn btn-tool text-dark","data-toggle":"modal","data-target":"#filters"},i.a.createElement("i",{className:"fas fa-filter"}))),i.a.createElement("div",{className:"modal",tabIndex:"-1",role:"dialog",id:"filters"},i.a.createElement("div",{className:"modal-dialog"},i.a.createElement("div",{className:"modal-content"},i.a.createElement("div",{className:"modal-header"},i.a.createElement("h5",{className:"modal-title"},"Busquedas"),i.a.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-label":"Close"},i.a.createElement("span",{"aria-hidden":"true"},"\xd7"))),i.a.createElement("form",{className:"modal-body"},i.a.createElement("div",{className:"input-group mb-3"},i.a.createElement("div",{className:"input-group-prepend"},i.a.createElement("span",{className:"input-group-text"},i.a.createElement("i",{className:"fas fa-search"}))),i.a.createElement("input",{type:"text",name:"search",className:"form-control",placeholder:"Por: codigo o producto",value:e,onChange:this.changeFilters,onKeyPress:this.onKeyPressSearch}))),i.a.createElement("div",{className:"modal-footer"},i.a.createElement("div",{className:"btn-group btn-group-lg",role:"group"},i.a.createElement("button",{type:"button",className:"btn btn-outline-dark","data-dismiss":"modal"},i.a.createElement("i",{className:"fas fa-window-close mr-2"}),"Cancelar"),i.a.createElement("button",{type:"button",className:e?"btn btn-outline-dark":"btn btn-outline-dark disabled",onClick:this.onClickClean},i.a.createElement("i",{className:"fas fa-eraser mr-2"}),"Limpiar"),i.a.createElement("button",{type:"button",className:"btn btn-outline-dark",onClick:this.setFilters,"data-dismiss":"modal"},i.a.createElement("i",{className:"fas fa-search mr-2"}),"Buscar")))))))}}]),t}(c.Component),A=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(e){var o;Object(r.a)(this,t),(o=a.call(this,e)).onchangeSearch=function(e,a){o.setState(Object(n.a)({},e,a))},o.handleOrder=function(e){o.setState({orderby:e,order:"desc"===o.state.order?"asc":"desc",load:!0})},o.handleChangePage=function(e){o.setState({page:e,load:!0})},o.changePage=function(e){o.props.page(e.target.id)},o.handleDelete=function(e,a){window.Swal.fire({title:"Eliminar",text:"\xbfEsta seguro de eliminar el producto "+a.toUpperCase()+"?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Eliminar",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,preConfirm:function(a){if(a){var t=o.state,n=t.host,r=t.token;return console.log("Solicitud de eliminaci\xf3n de producto por API"),fetch("http://"+n+"/api/store/"+e,{method:"DELETE",signal:o.signal,headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+r}}).then(function(){var e=Object(y.a)(N.a.mark((function e(a){var t;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t={},204===a.status){e.next=5;break}return e.next=4,a.json();case 4:t=e.sent;case 5:if(a.ok){e.next=7;break}throw new Error(t.message);case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}()).catch((function(e){console.error("Orus fetch",e),window.Swal.fire("Fallo de conexion","Verifique la conexion al servidor","error")}))}}}).then((function(e){e&&!e.dismiss&&e.value?(console.log("Producto eliminado"),window.Swal.fire({icon:"success",title:"Producto eliminado con exito",showConfirmButton:!1,timer:1500}).then((function(e){return o.getItems()}))):e&&!e.dismiss&&(console.log("Orus res: ",e),window.Swal.fire("Error","Se perdio la conexion con el servidor","error"))}))};var l=JSON.parse(localStorage.getItem("OrusStore"));return o.state={items:{data:[],meta:{}},load:!0,page:l?l.page:1,orderby:l?l.orderby:"created_at",order:l?l.order:"desc",search:l?l.search:"",host:e.data.host,token:e.data.token},o.controller=new AbortController,o.signal=o.controller.signal,o}return Object(o.a)(t,[{key:"componentWillUnmount",value:function(){this.controller.abort()}},{key:"componentDidMount",value:function(){this.getItems(),localStorage.setItem("OrusStore",JSON.stringify({page:this.state.page,orderby:this.state.orderby,order:this.state.order,search:this.state.search}))}},{key:"componentDidUpdate",value:function(e,a){!1===a.load&&!0===this.state.load&&(console.log("Recargando productos"),this.getItems(),localStorage.setItem("OrusStore",JSON.stringify({page:this.state.page,orderby:this.state.orderby,order:this.state.order,search:this.state.search})))}},{key:"render",value:function(){var e=this,a=this.state,t=a.items,n=a.load;return i.a.createElement("div",{className:"card card-primary card-outline"},i.a.createElement("div",{className:"card-header"},i.a.createElement("h3",{className:"card-title text-primary"},i.a.createElement("i",{className:"fas fa-database mr-1"}),"Productos en almacen"),i.a.createElement("div",{className:"card-tools"},i.a.createElement(I,{search:this.state.search,changeFilters:this.onchangeSearch,handleChangePage:this.handleChangePage}),i.a.createElement(x,{meta:t.meta,handleChangePage:this.handleChangePage}))),i.a.createElement("div",{className:"card-body table-responsive p-0"},i.a.createElement("table",{className:"table table-bordered table-hover table-nowrap"},i.a.createElement(w,{orderby:this.state.orderby,order:this.state.order,data:[{name:"Codigo",type:"code",filter:!0},{name:"Marca",type:"brand",filter:!0},{name:"Producto",type:"name",filter:!0},{name:"PS"},{name:"UND"},{name:"Precio",type:"price",filter:!0},{name:"Categoria"},{name:"Actualizado",type:"updated_at",filter:!0},{name:"Registrado",type:"created_at",filter:!0}],actions:!0,handleOrder:this.handleOrder}),i.a.createElement("tbody",null,n?i.a.createElement("tr",null,i.a.createElement("td",{colSpan:"10",className:"text-center"},i.a.createElement("div",{className:"spinner-border text-primary",role:"status"},i.a.createElement("span",{className:"sr-only"},"Loading...")))):Object.keys(t.data).length?t.data.map((function(a){return i.a.createElement("tr",{key:a.id},i.a.createElement("td",null,i.a.createElement("span",{className:"text-primary"},a.codigo)),i.a.createElement("td",{className:"text-uppercase"},a.marca?a.marca:"sin marca"),i.a.createElement("td",null,i.a.createElement(d.b,{to:"/almacen/registro/"+a.id},i.a.createElement("span",{className:"badge badge-primary text-capitalize p-1"},a.producto,i.a.createElement("i",{className:"fas fa-pencil-alt ml-1"})))),i.a.createElement("td",{className:"text-right"},a.unidad),i.a.createElement("td",null,i.a.createElement("span",{className:a.cantidades>0?"text-success":"text-danger"},a.cantidades>0?a.cantidades:0)),i.a.createElement("td",{className:"text-right"},"$ ",a.precio.toFixed(2)),i.a.createElement("td",null,a.categoria.categoria),i.a.createElement("td",{className:"text-capitalize"},f()(a.updated_at).fromNow()),i.a.createElement("td",{className:"text-capitalize"},f()(a.created_at).format("LL")),i.a.createElement(k,{id:a.id,item:a.producto,delete:a.lotes||a.cantidades?null:e.handleDelete,edit:"/almacen/registro/"}))})):i.a.createElement("tr",null,i.a.createElement("th",{colSpan:"10",className:"text-center"},"No hay datos para mostrar"))))),i.a.createElement("div",{className:"card-footer text-right"},i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-md-12"},i.a.createElement("div",{className:"btn-group",role:"group"},i.a.createElement(d.b,{to:"/almacen/registro",className:"btn btn-outline-primary",onClick:this.changePage,id:"/almacen/registro"},i.a.createElement("i",{className:"fas fa-plus mr-1"}),"Nuevo producto"))))))}},{key:"getItems",value:function(){var e=this,a=this.state,t=a.load,n=a.orderby,r=a.order,o=a.search,l=a.page,s=a.host,c=a.token,i="http://"+s+"/api/store",m="&orderby=".concat(n,"&order=").concat(r),d=o?"&search=".concat(o):"",u=l>0?"?page="+l:"?page=1";t||this.setState({load:!0}),console.log("Descargando productos de API"),fetch(i+u+m+d,{method:"GET",signal:this.signal,headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+c}}).then((function(e){if(!e.ok)throw new Error(e.statusText);return e.json()})).then((function(a){a.data?(console.log("Almacenando productos"),e.setState({items:a,load:!1})):(console.error("Orus: ",a.message),window.Swal.fire("Error","Al descargar pedidos","error"),e.setState({load:!1}))})).catch((function(a){console.error("Orus: "+a),window.Swal.fire("Fallo de conexion","Verifique la conexion al servidor","error"),e.setState({load:!1})}))}}]),t}(c.Component),T=t(16),P=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(e){var n;return Object(r.a)(this,t),(n=a.call(this,e)).handleDelete=function(e,a,t){e.preventDefault(),window.Swal.fire({title:"Eliminar",text:"\xbfEsta seguro de eliminar el lote "+t.toUpperCase()+"?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Eliminar",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,preConfirm:function(t){if(t&&a){var r=e.target.parentNode.parentNode.parentNode;r.classList.add("bg-danger");var o=JSON.parse(localStorage.getItem("OrusSystem")),l=setInterval((function(){clearInterval(l),r.classList.remove("bg-danger")}),6500);return console.log("Solicitud de eliminaci\xf3n de lote por API"),fetch("http://"+o.host+"/api/items/"+a,{method:"DELETE",signal:n.signal,headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+o.token}}).then(function(){var e=Object(y.a)(N.a.mark((function e(a){var t;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t={},204===a.status){e.next=5;break}return e.next=4,a.json();case 4:t=e.sent;case 5:if(a.ok){e.next=7;break}throw new Error(t.message);case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}()).catch((function(e){console.error("Orus fetch",e),window.Swal.fire("Fallo de conexion","Verifique la conexion al servidor","error")}))}}}).then((function(e){e&&!e.dismiss&&e.value?(console.log("Producto eliminado"),n.setState({load:!0,loteNew:!1}),window.Swal.fire("Lote eliminado con exito","","success").then((function(e){n.handelGetLots(n.state.page),n.props.refresh()}))):e&&!e.dismiss&&(console.log("Orus res: ",e),window.Swal.fire("Error","Se perdio la conexion con el servidor","error"))}))},n.state={id:0,bill:"",cost:0,price:n.props.price,amount:0,lote:{data:[],meta:{}},loteNew:!1,load:!0,page:1},n.handleNewLote=n.handleNewLote.bind(Object(T.a)(n)),n.handleSave=n.handleSave.bind(Object(T.a)(n)),n.catchInputs=n.catchInputs.bind(Object(T.a)(n)),n.handelGetLots=n.handelGetLots.bind(Object(T.a)(n)),n}return Object(o.a)(t,[{key:"componentDidMount",value:function(){this.handelGetLots(this.state.page)}},{key:"render",value:function(){var e=this,a=this.state,t=a.lote,n=a.load,r=[];if(this.state.lote.meta.total>10)for(var o=1;o<=this.state.lote.meta.last_page;o++)r.push(i.a.createElement("li",{key:o,className:this.state.lote.meta.current_page===o?"page-item disabled":"page-item"},i.a.createElement("a",{href:"#e",id:o,className:"page-link",onClick:this.handleChangePage.bind(this)},o)));return i.a.createElement("div",{className:"card card-primary card-outline"},i.a.createElement("div",{className:"card-header"},i.a.createElement("h3",{className:"card-title text-primary"},i.a.createElement("i",{className:"fas fa-list"}),"Listado de lotes"),i.a.createElement("div",{className:"card-tools"},this.state.lote.meta.total>10?i.a.createElement("div",{className:"btn-group"},i.a.createElement("ul",{className:"pagination pagination-sm"},r)):"")),i.a.createElement("div",{className:"card-body table-responsive p-0"},i.a.createElement("table",{className:"table table-hover table-nowrap"},i.a.createElement("thead",null,i.a.createElement("tr",null,i.a.createElement("th",null,"Registrado"),i.a.createElement("th",{style:{width:140}},"Factura"),i.a.createElement("th",{className:"text-right",style:{width:90}},"Unidades"),i.a.createElement("th",{className:"text-right",style:{width:110}},"Costo"),i.a.createElement("th",{className:"text-right",style:{width:110}},"Precio"),i.a.createElement("th",null,"Acciones"))),i.a.createElement("tbody",null,n?i.a.createElement("tr",null,i.a.createElement("td",{colSpan:"6",className:"text-center"},i.a.createElement("div",{className:"spinner-border text-primary",role:"status"},i.a.createElement("span",{className:"sr-only"},"Loading...")))):Object.keys(t.data).length?t.data.map((function(a){return i.a.createElement("tr",{key:a.id},i.a.createElement("td",null,a.created_at),i.a.createElement("td",{className:"text-uppercase"},a.factura?a.factura:"XXXX"),i.a.createElement("td",{className:"text-right"},a.cantidades),i.a.createElement("td",{className:"text-right"},"$ ",a.costo?a.costo:0),i.a.createElement("td",{className:"text-right"},"$ ",a.precio?a.precio:0),i.a.createElement("td",{className:"text-right"},i.a.createElement("a",{className:"btn-flat text-dark",href:"#delete",onClick:function(t){e.handleDelete(t,a.id,a.factura)}},i.a.createElement("i",{className:"fas fa-trash"}))))})):i.a.createElement("tr",null,i.a.createElement("th",{colSpan:"6",className:"text-center"},"No hay datos para mostrar")),this.state.loteNew?i.a.createElement("tr",null,i.a.createElement("th",null,"Nuevo"),i.a.createElement("td",null,i.a.createElement("input",{className:"form-control text-uppercase",type:"text",name:"bill",value:this.state.bill,onChange:this.catchInputs})),i.a.createElement("td",null,i.a.createElement("input",{className:"form-control text-right",type:"number",name:"amount",min:"1",value:this.state.amount,onChange:this.catchInputs})),i.a.createElement("td",null,i.a.createElement("input",{className:"form-control text-right",type:"number",name:"cost",value:this.state.cost,onChange:this.catchInputs})),i.a.createElement("td",null,i.a.createElement("input",{className:"form-control text-right",type:"number",name:"price",value:this.state.price,onChange:this.catchInputs})),i.a.createElement("td",{className:"text-right"},i.a.createElement("div",{className:"btn-group",role:"group"},i.a.createElement("button",{className:"btn btn-outline-primary btn-sm",onClick:this.handleSave},i.a.createElement("i",{className:"fas fa-save"})),i.a.createElement("button",{className:"btn btn-outline-dark btn-sm",onClick:this.handleNewLote},i.a.createElement("i",{className:"fas fa-undo"}))))):i.a.createElement("tr",null)))),i.a.createElement("div",{className:"card-footer"},i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-md-12"},i.a.createElement("div",{className:"btn-group float-right",role:"group"},i.a.createElement("button",{className:"btn btn-primary",onClick:this.handleNewLote},"Nuevo lote"))))))}},{key:"handleChangePage",value:function(e){e.preventDefault(),this.setState({page:e.target.id}),this.handelGetLots(e.target.id)}},{key:"handleNewLote",value:function(){this.setState({loteNew:!this.state.loteNew})}},{key:"catchInputs",value:function(e){var a=e.target,t=a.name,r=a.value;this.setState(Object(n.a)({},t,r.toLowerCase()))}},{key:"validInputs",value:function(){var e=this.state,a=e.bill,t=e.price,n=e.amount;return a.length||(a="XXXX"),t||(t=1e3),!!n||(window.alert("La cantidad de articulos no puede ser cero"),!1)}},{key:"handleSave",value:function(e){var a=this;if(e.preventDefault(),!this.validInputs())return!1;window.Swal.fire({title:"Almacenamiento",text:"\xbfEsta seguro de almacenar un nuevo lote?",icon:"question",showCancelButton:!0,confirmButtonColor:"#007bff",confirmButtonText:"Guardar",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,preConfirm:function(e){if(e){var t=JSON.parse(localStorage.getItem("OrusSystem")),n=a.state,r=n.id,o={bill:n.bill,cost:n.cost,price:n.price,amount:n.amount,store_items_id:r};return console.log("Enviando datos del producto a API"),fetch("http://"+t.host+"/api/items",{method:"POST",body:JSON.stringify(o),headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+t.token}}).then((function(e){if(!e.ok)throw new Error(e.statusText);return e.json()})).catch((function(e){console.error("Orus fetch",e),window.Swal.fire("Fallo de conexion","Verifique la conexion al servidor","error")}))}}}).then((function(e){if(e&&!e.dismiss&&e.value){var t=e.value;t.data?(console.log("Lote almacenada"),a.setState({load:!0,loteNew:!1}),window.Swal.fire("Lote guardado con exito","","success").then((function(e){a.handelGetLots(a.state.page),a.props.refresh()}))):(window.Swal.fire("Error","al almacenar el lote","error"),console.error("Orus res: ",t.message))}}))}},{key:"handelGetLots",value:function(e){var a=this,t=JSON.parse(localStorage.getItem("OrusSystem")),n=this.props.id,r="http://"+t.host+"/api/items?store_items_id="+n;fetch(r+"&page="+e,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+t.token}}).then((function(e){if(!e.ok)throw new Error(e.statusText);return e.json()})).then((function(e){console.log("Descargando lotes"),a.setState({id:n,lote:e,load:!1})})).catch((function(e){console.log("Orus:",e),window.Swal.fire("Fallo de conexion","Verifique la conexion al servidor","error"),a.setState({load:!1})}))}}]),t}(c.Component),F=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(e){var o;return Object(r.a)(this,t),(o=a.call(this,e)).setNew=function(e){o.setState({id:0,code:"",codebar:"",grad:"",brand:"",name:"",unit:"PZ",cant:1,price:1,category_id:1,load:!1})},o.changePage=function(e){o.props.page(e)},o.catchInputs=function(e){var a=e.target,t=a.name,r=a.value;o.setState(Object(n.a)({},t,r.toLowerCase()))},o.getCategory=function(){var e=o.state,a=e.host,t=e.token;console.log("solicitando categorias al API"),fetch("http://"+a+"/api/categories",{method:"GET",signal:o.signal,headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+t}}).then((function(e){if(!e.ok)throw new Error(e.statusText);return e.json()})).then((function(e){e.data?(console.log("descargando categorias"),o.setState({category_list:e.data})):(console.error("Orus: ",e.message),window.Swal.fire("Error","Error al descargar las categorias","error"))})).catch((function(e){console.log("Orus:",e),window.Swal.fire("Fallo de conexion","Verifique la conexion al servidor","error"),o.setState({load:!1})}))},o.handleSave=function(e){e.preventDefault();var a=o.state.id;window.Swal.fire({title:"Almacenamiento",text:a?"\xbfEsta seguro de actualizar el producto?":"\xbfEsta seguro de crear un nuevo producto?",icon:"question",showCancelButton:!0,confirmButtonColor:"#007bff",confirmButtonText:a?"Actualizar":"Crear",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,preConfirm:function(e){if(e){var a=o.state,t=a.id,n=a.code,r=a.codebar,l=a.brand,s=a.name,c=a.unit,i=a.cant,m=a.price,d=a.category_id,u=a.token,p=a.host,h={code:n,codebar:r,brand:l,name:s,unit:c,cant:i,price:m,category_id:d},g=t?"http://"+p+"/api/store/"+t:"http://"+p+"/api/store",f=t?"PUT":"POST";return console.log("Enviando datos del producto a API"),fetch(g,{method:f,body:JSON.stringify(h),headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+u}}).then(function(){var e=Object(y.a)(N.a.mark((function e(a){var t;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t={},204===a.status){e.next=5;break}return e.next=4,a.json();case 4:t=e.sent;case 5:if(a.ok){e.next=7;break}throw new Error(t.message);case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}()).catch((function(e){console.error("Orus fetch",e),window.Swal.fire("Fallo de conexion","Verifique la conexion al servidor","error")}))}}}).then((function(e){if(e&&!e.dismiss&&e.value){var t=e.value;t.data?(console.log("Producto almacenada"),window.Swal.fire({icon:"success",title:a?"Producto actualizado con exito":"Producto almacenado con exito",showConfirmButton:!1,timer:1500}).then((function(e){o.setState({id:t.data.id}),o.props.history.push("/almacen/registro/".concat(t.data.id))}))):(window.Swal.fire("Error","al almacenar el producto","error"),console.error("Orus res: ",t.message))}}))},o.getItem=function(e){if(e>0){var a=o.state,t=a.host,n=a.token;console.log("Solicitando datos de producto a la API"),fetch("http://"+t+"/api/store/"+e,{method:"GET",signal:o.signal,headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+n}}).then((function(e){if(!e.ok)throw new Error(e.statusText);return e.json()})).then((function(e){e.data?(console.log("Descargando producto"),o.setState({id:e.data.id,code:e.data.codigo,codebar:e.data.c_barra,brand:e.data.marca,name:e.data.producto,unit:e.data.unidad,cant:e.data.cantidades,price:e.data.precio,category_id:e.data.categoria.id,load:!1})):(console.error("Orus: ",e.message),window.Swal.fire("Error","Error en el sistema, comuniquese con el administrador de sistema","error"),o.setState({load:!1}))})).catch((function(e){console.log("Orus:",e),window.Swal.fire("Fallo de conexion","Verifique la conexion al servidor","error"),o.setState({load:!1})}))}else o.setState({load:!1})},o.state={id:0,code:"",codebar:"",grad:"",brand:"",name:"",unit:"PZ",cant:1,price:1,category_id:1,category_list:[],load:!1,host:e.data.host,token:e.data.token},o.controller=new AbortController,o.signal=o.controller.signal,o}return Object(o.a)(t,[{key:"componentWillUnmount",value:function(){this.controller.abort()}},{key:"componentDidMount",value:function(){var e=this.props.match.params.id;this.getItem(e),this.getCategory()}},{key:"render",value:function(){var e=this,a=this.state,t=a.id,n=a.load;return i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:this.state.id?"col-5":"col-6"},i.a.createElement("form",{className:"card card-primary card-outline",onSubmit:this.handleSave},i.a.createElement("div",{className:"card-header"},i.a.createElement("h3",{className:"card-title text-primary"},i.a.createElement("i",{className:"fas fa-database mr-1"}),this.state.id?"Editar producto":"Registrar nuevo producto")),i.a.createElement("div",{className:"card-body"},n?i.a.createElement("div",{className:"text-center"},i.a.createElement("div",{className:"spinner-border text-primary",role:"status"},i.a.createElement("span",{className:"sr-only"},"Loading..."))):i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-md-5"},this.state.code?i.a.createElement("small",null,i.a.createElement("label",null,"Codigo")):i.a.createElement("br",null),i.a.createElement("div",{className:"input-group mb-3"},i.a.createElement("div",{className:"input-group-prepend"},i.a.createElement("span",{className:"input-group-text"},i.a.createElement("i",{className:"fas fa-code"}))),i.a.createElement("input",{type:"text",className:"form-control text-uppercase",placeholder:"Codigo",name:"code",value:this.state.code,onChange:this.catchInputs,autoComplete:"off"}))),i.a.createElement("div",{className:"col-md-7"},this.state.codebar?i.a.createElement("small",null,i.a.createElement("label",null,"Codigo de barras")):i.a.createElement("br",null),i.a.createElement("div",{className:"input-group mb-3"},i.a.createElement("div",{className:"input-group-prepend"},i.a.createElement("span",{className:"input-group-text"},i.a.createElement("i",{className:"fas fa-barcode"}))),i.a.createElement("input",{type:"text",className:"form-control",placeholder:"Codigo de barras",name:"codebar",value:this.state.codebar,onChange:this.catchInputs,autoComplete:"off"})))),i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-md-12"},this.state.name?i.a.createElement("small",null,i.a.createElement("label",null,"Nombre del producto")):i.a.createElement("br",null),i.a.createElement("div",{className:"input-group mb-3"},i.a.createElement("div",{className:"input-group-prepend"},i.a.createElement("span",{className:"input-group-text"},i.a.createElement("i",{className:"fas fa-archive"}))),i.a.createElement("input",{type:"text",className:"form-control",placeholder:"Nombre del producto",name:"name",value:this.state.name,onChange:this.catchInputs,autoComplete:"off"})))),i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-md-10"},this.state.brand?i.a.createElement("small",null,i.a.createElement("label",null,"Marca")):i.a.createElement("br",null),i.a.createElement("div",{className:"input-group mb-5"},i.a.createElement("div",{className:"input-group-prepend"},i.a.createElement("span",{className:"input-group-text"},i.a.createElement("i",{className:"fas fa-copyright"}))),i.a.createElement("input",{type:"text",className:"form-control",placeholder:"Marca",name:"brand",value:this.state.brand?this.state.brand:"",onChange:this.catchInputs})))),i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-md-6"},this.state.unit?i.a.createElement("small",null,i.a.createElement("label",null,"Unidad de presentacion")):i.a.createElement("br",null),i.a.createElement("div",{className:"input-group mb-3"},i.a.createElement("div",{className:"input-group-prepend"},i.a.createElement("span",{className:"input-group-text"},i.a.createElement("i",{className:"fas fa-balance-scale"}))),i.a.createElement("input",{type:"text",className:"form-control",placeholder:"Unidad de presentaci\xf3n",name:"unit",value:this.state.unit,onChange:this.catchInputs}))),i.a.createElement("div",{className:"col-md-6"},i.a.createElement("small",null,i.a.createElement("label",null,"Cantidad en existencia")),i.a.createElement("div",{className:"input-group mb-3"},i.a.createElement("div",{className:"input-group-prepend"},i.a.createElement("span",{className:"input-group-text"},i.a.createElement("i",{className:"fas fa-database"}))),i.a.createElement("input",{type:"number",className:"form-control text-right",placeholder:"Cantidades en existencia",name:"cant",min:"0",value:this.state.cant,onChange:this.catchInputs})))),i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-md-6"},i.a.createElement("small",null,i.a.createElement("label",null,"Precio")),i.a.createElement("div",{className:"input-group mb-3"},i.a.createElement("div",{className:"input-group-prepend"},i.a.createElement("span",{className:"input-group-text"},i.a.createElement("i",{className:"fas fa-money-bill"}))),i.a.createElement("input",{type:"number",className:"form-control text-right",placeholder:"Precio",name:"price",value:this.state.price,onChange:this.catchInputs})))),i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-md-12"},i.a.createElement("small",null,i.a.createElement("label",null,"Categoria")),i.a.createElement("div",{className:"input-group mb-3"},i.a.createElement("div",{className:"input-group-prepend"},i.a.createElement("span",{className:"input-group-text"},i.a.createElement("i",{className:"fas fa-sort-amount-down"}))),i.a.createElement("select",{className:"custom-select",name:"category_id",value:this.state.category_id,onChange:this.catchInputs},this.state.category_list.map((function(e){return null===e.depende_de?i.a.createElement("option",{value:e.id,key:e.id},e.categoria):null})))))))),i.a.createElement("div",{className:"card-footer text-right"},i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-md-12"},i.a.createElement("div",{className:"btn-group",role:"group"},i.a.createElement(d.b,{to:"/almacen/registro",className:"btn btn-dark",onClick:this.setNew},i.a.createElement("i",{className:"fas fa-plus mr-1"}),"Nuevo"),i.a.createElement(d.b,{to:"/almacen",className:"btn btn-dark",onClick:function(a){e.changePage("/almacen")}},i.a.createElement("i",{className:t?"fas fa-ban mr-1":"fas fa-undo mr-1"}),t?"Cerrar":"Cancelar"),i.a.createElement("button",{type:"submit",className:"btn btn-primary"},i.a.createElement("i",{className:"fas fa-save mr-1"}),"Guardar"))))))),this.state.id?i.a.createElement("div",{className:"col"},i.a.createElement(P,{id:this.state.id,price:this.state.price,refresh:this.getItem})):null)}}]),t}(c.Component),B=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(){var e;Object(r.a)(this,t);for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return(e=a.call.apply(a,[this].concat(o))).onKeyPressSearch=function(a){"Enter"===a.key&&(a.preventDefault(),e.setFilters())},e.onClickClean=function(){e.props.changeFilters("search",""),e.props.changeFilters("type",""),e.props.changeFilters("business",""),e.setFilters()},e.setFilters=function(){e.props.handleChangePage(1),window.$("#filters").modal("hide")},e.changeFilters=function(a){var t=a.target,n=t.name,r=t.value;e.props.changeFilters(n,r)},e}return Object(o.a)(t,[{key:"render",value:function(){var e=this.props,a=e.search,t=e.type,n=e.business;return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"btn-group"},i.a.createElement("a",{href:"#Filters",className:"btn btn-tool text-dark","data-toggle":"modal","data-target":"#filters"},i.a.createElement("i",{className:"fas fa-filter"}))),i.a.createElement("div",{className:"modal",tabIndex:"-1",role:"dialog",id:"filters"},i.a.createElement("div",{className:"modal-dialog"},i.a.createElement("div",{className:"modal-content"},i.a.createElement("div",{className:"modal-header"},i.a.createElement("h5",{className:"modal-title"},"Busquedas"),i.a.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-label":"Close"},i.a.createElement("span",{"aria-hidden":"true"},"\xd7"))),i.a.createElement("form",{className:"modal-body"},i.a.createElement("div",{className:"input-group mb-3"},i.a.createElement("div",{className:"input-group-prepend"},i.a.createElement("span",{className:"input-group-text"},i.a.createElement("i",{className:"fas fa-search"}))),i.a.createElement("input",{type:"text",name:"search",className:"form-control",placeholder:"Por: nombre, RFC o email",value:a,onChange:this.changeFilters,onKeyPress:this.onKeyPressSearch})),i.a.createElement("div",{className:"input-group mb-3"},i.a.createElement("label",null,"Tipo de contacto"),i.a.createElement("div",{className:"input-group-prepend ml-4"},i.a.createElement("span",{className:"input-group-text"},i.a.createElement("i",{className:"fas fa-address-book"}))),i.a.createElement("select",{className:"form-control",name:"type",value:t,onChange:this.changeFilters},i.a.createElement("option",{value:""},"Todos"),i.a.createElement("option",{value:"0"},"Clientes"),i.a.createElement("option",{value:"1"},"Proveedores"))),i.a.createElement("div",{className:"input-group mb-3"},i.a.createElement("label",null,"\xbfEs una empresa?"),i.a.createElement("div",{className:"input-group-prepend ml-4"},i.a.createElement("span",{className:"input-group-text"},i.a.createElement("i",{className:"fas fa-building"}))),i.a.createElement("select",{className:"form-control",name:"business",value:n,onChange:this.changeFilters},i.a.createElement("option",{value:""},"Todos"),i.a.createElement("option",{value:"1"},"Si"),i.a.createElement("option",{value:"0"},"No")))),i.a.createElement("div",{className:"modal-footer"},i.a.createElement("div",{className:"btn-group btn-group-lg",role:"group"},i.a.createElement("button",{type:"button",className:"btn btn-outline-dark","data-dismiss":"modal"},i.a.createElement("i",{className:"fas fa-window-close mr-2"}),"Cancelar"),i.a.createElement("button",{type:"button",className:a||t||n?"btn btn-outline-dark":"btn btn-outline-dark disabled",onClick:this.onClickClean},i.a.createElement("i",{className:"fas fa-eraser mr-2"}),"Limpiar"),i.a.createElement("button",{type:"button",className:"btn btn-outline-dark",onClick:this.setFilters,"data-dismiss":"modal"},i.a.createElement("i",{className:"fas fa-search mr-2"}),"Buscar")))))))}}]),t}(c.Component),D=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(e){var o;Object(r.a)(this,t),(o=a.call(this,e)).onchangeSearch=function(e,a){o.setState(Object(n.a)({},e,a))},o.handleOrder=function(e){o.setState({orderby:e,order:"desc"===o.state.order?"asc":"desc",load:!0})},o.handleChangePage=function(e){o.setState({page:e,load:!0})},o.changePage=function(e){o.props.page(e.target.id)},o.handleDelete=function(e,a){window.Swal.fire({title:"Eliminar",text:"\xbfEsta seguro de eliminar el contacto "+a.toUpperCase()+"?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Eliminar",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,preConfirm:function(a){if(a){var t=o.state,n=t.host,r=t.token;return console.log("Solicitud de eliminaci\xf3n por API"),fetch("http://"+n+"/api/contacts/"+e,{method:"DELETE",signal:o.signal,headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+r}}).then(function(){var e=Object(y.a)(N.a.mark((function e(a){var t;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t={},204===a.status){e.next=5;break}return e.next=4,a.json();case 4:t=e.sent;case 5:if(a.ok){e.next=7;break}throw new Error(t.message);case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}()).catch((function(e){console.error("Orus fetch: ",e),window.Swal.fire("Fallo de conexion","Verifique la conexion al servidor","error")}))}}}).then((function(e){e&&!e.dismiss&&e.value?window.Swal.fire({icon:"success",title:"Contacto eliminado con exito",showConfirmButton:!1,timer:1500}).then((function(e){return o.getContacts()})):e&&!e.dismiss&&(console.log("Orus res: ",e),window.Swal.fire("Error","Se perdio la conexion con el servidor","error"))}))};var l=JSON.parse(localStorage.getItem("OrusContacts"));return o.state={contacts:{data:[],meta:{}},load:!0,page:l?l.page:1,orderby:l&&l.orderby?l.orderby:"created_at",order:l&&l.order?l.order:"desc",search:l&&l.search?l.search:"",type:l&&l.type?l.type:"",business:l&&l.business?l.business:"",host:e.data.host,token:e.data.token},o.controller=new AbortController,o.signal=o.controller.signal,o}return Object(o.a)(t,[{key:"componentWillUnmount",value:function(){this.controller.abort()}},{key:"componentDidMount",value:function(){this.getContacts(),localStorage.setItem("OrusContacts",JSON.stringify({page:this.state.page,orderby:this.state.orderby,order:this.state.order,search:this.state.search,type:this.state.type,business:this.state.business}))}},{key:"componentDidUpdate",value:function(e,a){!1===a.load&&!0===this.state.load&&(console.log("Recargando contactos"),this.getContacts(),localStorage.setItem("OrusContacts",JSON.stringify({page:this.state.page,orderby:this.state.orderby,order:this.state.order,search:this.state.search,type:this.state.type,business:this.state.business})))}},{key:"render",value:function(){var e=this,a=this.state,t=a.contacts,n=a.load;return i.a.createElement("div",{className:"card card-danger card-outline"},i.a.createElement("div",{className:"card-header"},i.a.createElement("h2",{className:"card-title text-danger"},i.a.createElement("i",{className:"fas fa-address-book mr-1"}),"Lista de contactos"),i.a.createElement("div",{className:"card-tools"},i.a.createElement(B,{search:this.state.search,type:this.state.type,business:this.state.business,changeFilters:this.onchangeSearch,handleChangePage:this.handleChangePage}),i.a.createElement(x,{meta:t.meta,handleChangePage:this.handleChangePage}))),i.a.createElement("div",{className:"card-body table-responsive p-0"},i.a.createElement("table",{className:"table table-bordered table-hover table-nowrap"},i.a.createElement(w,{orderby:this.state.orderby,order:this.state.order,data:[{name:"Nombre",type:"name",filter:!0},{name:"RFC",type:"name",filter:!0},{name:"E-mail",type:"email",filter:!0},{name:"Tipo",type:"type",filter:!0},{name:"Telefono"},{name:"Actualizado",type:"updated_at",filter:!0},{name:"Registrado",type:"created_at",filter:!0}],actions:!0,handleOrder:this.handleOrder}),i.a.createElement("tbody",null,n?i.a.createElement("tr",null,i.a.createElement("td",{colSpan:"10",className:"text-center"},i.a.createElement("div",{className:"spinner-border text-danger",role:"status"},i.a.createElement("span",{className:"sr-only"},"Loading...")))):Object.keys(t.data).length?t.data.map((function(a){return i.a.createElement("tr",{key:a.id},i.a.createElement("td",null,i.a.createElement(d.b,{to:"/contactos/registro/"+a.id},i.a.createElement("span",{className:"badge badge-danger text-capitalize p-1"},a.nombre,i.a.createElement("i",{className:"fas fa-pencil-alt ml-1"})))),i.a.createElement("td",{className:"text-uppercase"},a.rfc?a.rfc:"--"),i.a.createElement("td",{className:"text-lowercase"},a.email?a.email:"--"),i.a.createElement("td",{className:"text-uppercase"},a.tipo?i.a.createElement("span",{className:"text-purple"},"Proveedor"):i.a.createElement("span",{className:"text-green"},"Cliente")),i.a.createElement("td",null,a.telefonos&&a.telefonos.t_movil?a.telefonos.t_movil:"--"),i.a.createElement("td",null,f()(a.updated_at).fromNow()),i.a.createElement("td",null,f()(a.created_at).format("ll")),i.a.createElement(k,{id:a.id,item:a.nombre,delete:a.enUso?null:e.handleDelete,edit:"/contactos/registro/"}))})):i.a.createElement("tr",null,i.a.createElement("th",{colSpan:"10",className:"text-center"},"No hay datos para mostrar"))))),i.a.createElement("div",{className:"card-footer text-right"},i.a.createElement(d.b,{to:"/contactos/registro",className:"btn btn-outline-danger",onClick:this.changePage,id:"/contactos/registro"},i.a.createElement("i",{className:"fas fa-plus",id:"/contactos/registro"}),"\xa0 Nuevo contacto")))}},{key:"getContacts",value:function(){var e=this,a=this.state,t=a.host,n=a.token,r=a.order,o=a.orderby,l=a.search,s=a.page,c=a.type,i=a.business,m=a.load,d="http://"+t+"/api/contacts",u="&orderby=".concat(o,"&order=").concat(r),p=l?"&search=".concat(l):"",h=s>0?"?page="+s:"?page=1",g=""===c?"":"&type="+c,f=""===i?"":"&business="+i;m||this.setState({load:!0}),console.log("Descargando contactos del API"),fetch(d+h+u+p+g+f,{method:"GET",signal:this.signal,headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+n}}).then((function(e){if(!e.ok)throw new Error(e.statusText);return e.json()})).then((function(a){a.data?(console.log("Almacenando contactos"),e.setState({contacts:a,load:!1})):(console.error("Orus: ",a.message),window.Swal.fire("Error","Al descargar contactos","error"),e.setState({load:!1}))})).catch((function(a){console.error(a),window.Swal.fire("Fallo de conexion","Verifique la conexion al servidor","error"),e.setState({load:!1})}))}}]),t}(c.Component),L=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(e){var n;return Object(r.a)(this,t),(n=a.call(this,e)).eventLoadMap=function(){var e={query:n.props.calle+","+n.props.colonia+","+n.props.municipio+","+n.props.estado+","+n.props.cp,fields:["formatted_address","geometry"]};n.service=new n.google.maps.places.PlacesService(n.map),n.service.findPlaceFromQuery(e,(function(e,a){"OK"===a&&(n.markers.length&&(n.markers[0].setMap(null),n.markers=[]),e.map((function(e){return n.marker=new n.google.maps.Marker({position:e.geometry.location,title:e.formatted_address,map:n.map}),n.marker.addListener("click",(function(){var e=n.marker.title.split(","),a=e[2].split(/(\d{5})/g);a.length||(a=e[3].split(/(\d{5})/g)),n.props.changeAddress({calle:e[0].trim(),colonia:e[1].trim(),municipio:a[2]?a[2].trim():n.props.municipio,estado:e[3].trim(),cp:a[1]?a[1].trim():n.props.cp})})),n.markers.push(n.marker),n.markers[0].setMap(n.map),n.map.setCenter(n.markers[0].position),null})))}))},n.state={load:!0},n.markers=[],n.map="",n}return Object(o.a)(t,[{key:"componentDidMount",value:function(){var e=this,a=setInterval((function(){if(window.google){e.google=window.google,clearInterval(a),console.log("Cargando mapa");var t=new e.google.maps.LatLng(19.2487072,-103.747381);e.map=new e.google.maps.Map(document.getElementById("gmapContainer"),{center:t,zoom:16}),e.props.calle.length>6&&(console.log("Cargando Marker"),e.eventLoadMap()),e.setState({load:!1})}}),100)}},{key:"componentDidUpdate",value:function(){this.props.calle.length>6&&(console.log("Cargando Marker"),this.eventLoadMap())}},{key:"render",value:function(){return i.a.createElement("div",{className:"card card-danger card-outline"},i.a.createElement("div",{className:"card-header"},i.a.createElement("i",{className:"fas fa-map-marked mr-1"}),"Mapa"),i.a.createElement("div",{className:"card-body",id:"gmapContainer",style:{height:400}}))}}]),t}(c.Component),z=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(){var e;Object(r.a)(this,t);for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return(e=a.call.apply(a,[this].concat(o))).catchInputs=function(a){var t=a.target.name,n="checkbox"===a.target.type?a.target.checked:a.target.value.toLowerCase();e.props.onChangeInput(t,n)},e}return Object(o.a)(t,[{key:"render",value:function(){return i.a.createElement(i.a.Fragment,null,i.a.createElement("table",{className:"table table-bordered table-hover"},i.a.createElement("thead",null,i.a.createElement("tr",null,i.a.createElement("th",null,"#"),i.a.createElement("th",null,"Esfera"),i.a.createElement("th",null,"Cilindro"),i.a.createElement("th",null,"Eje"),i.a.createElement("th",null,"Adici\xf3n"),i.a.createElement("th",null,"D/P"),i.a.createElement("th",null,"Altura"))),i.a.createElement("tbody",null,i.a.createElement("tr",null,i.a.createElement("td",null,i.a.createElement("label",null,"D"),i.a.createElement("i",{className:"fa fa-eye"})),i.a.createElement("td",null,i.a.createElement("input",{type:"number",name:"esferaod",min:"-20",max:"20",step:".25",className:this.props.readOnly?"form-control disabled":"form-control",disabled:!!this.props.readOnly,value:this.props.esferaod?this.props.esferaod:0,onChange:this.catchInputs})),i.a.createElement("td",null,i.a.createElement("input",{type:"number",name:"cilindrod",min:"-20",max:"0",step:".25",className:this.props.readOnly?"form-control disabled":"form-control",disabled:!!this.props.readOnly,value:this.props.cilindrod?this.props.cilindrod:0,onChange:this.catchInputs})),i.a.createElement("td",null,i.a.createElement("input",{type:"number",name:"ejeod",min:"0",max:"180",step:"1",className:this.props.readOnly?"form-control disabled":"form-control",disabled:!!this.props.readOnly,placeholder:"\xb0",value:this.props.ejeod?this.props.ejeod:0,onChange:this.catchInputs})),i.a.createElement("td",null,i.a.createElement("input",{type:"number",name:"adiciond",min:"0",max:"3",step:".25",className:this.props.readOnly?"form-control disabled":"form-control",disabled:!!this.props.readOnly,value:this.props.adiciond?this.props.adiciond:0,onChange:this.catchInputs})),i.a.createElement("td",null,i.a.createElement("input",{type:"number",name:"dpod",min:"0",max:"80",step:".1",className:this.props.readOnly?"form-control disabled":"form-control",disabled:!!this.props.readOnly,value:this.props.dpod?this.props.dpod:0,onChange:this.catchInputs})),i.a.createElement("td",null,i.a.createElement("input",{type:"number",name:"alturaod",min:"0",max:"80",step:".1",className:this.props.readOnly?"form-control disabled":"form-control",disabled:!!this.props.readOnly,value:this.props.alturaod?this.props.alturaod:0,onChange:this.catchInputs}))),i.a.createElement("tr",null,i.a.createElement("td",null,i.a.createElement("label",null,"I"),i.a.createElement("i",{className:"fa fa-eye"})),i.a.createElement("td",null,i.a.createElement("input",{type:"number",name:"esferaoi",min:"-20",max:"20",step:".25",className:this.props.readOnly?"form-control disabled":"form-control",disabled:!!this.props.readOnly,value:this.props.esferaoi?this.props.esferaoi:0,onChange:this.catchInputs})),i.a.createElement("td",null,i.a.createElement("input",{type:"number",name:"cilindroi",min:"-20",max:"0",step:".25",className:this.props.readOnly?"form-control disabled":"form-control",disabled:!!this.props.readOnly,value:this.props.cilindroi?this.props.cilindroi:0,onChange:this.catchInputs})),i.a.createElement("td",null,i.a.createElement("input",{type:"number",name:"ejeoi",min:"0",max:"180",step:"1",className:this.props.readOnly?"form-control disabled":"form-control",disabled:!!this.props.readOnly,placeholder:"\xb0",value:this.props.ejeoi?this.props.ejeoi:0,onChange:this.catchInputs})),i.a.createElement("td",null,i.a.createElement("input",{type:"number",name:"adicioni",min:"0",max:"3",step:".25",className:this.props.readOnly?"form-control disabled":"form-control",disabled:!!this.props.readOnly,value:this.props.adicioni?this.props.adicioni:0,onChange:this.catchInputs})),i.a.createElement("td",null,i.a.createElement("input",{type:"number",name:"dpoi",min:"0",max:"80",step:".1",className:this.props.readOnly?"form-control disabled":"form-control",disabled:!!this.props.readOnly,value:this.props.dpoi?this.props.dpoi:0,onChange:this.catchInputs})),i.a.createElement("td",null,i.a.createElement("input",{type:"number",name:"alturaoi",min:"0",max:"80",step:".1",className:this.props.readOnly?"form-control disabled":"form-control",disabled:!!this.props.readOnly,value:this.props.alturaoi?this.props.alturaoi:0,onChange:this.catchInputs}))))),i.a.createElement("ul",{className:"list-group d-print-none mt-4"},i.a.createElement("li",{className:"list-group-item"},i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-md-12"},"Lente de contacto",i.a.createElement("input",{type:"text",name:"lcmarca",maxLength:"70",className:this.props.readOnly?"form-control disabled":"form-control",disabled:!!this.props.readOnly,value:this.props.lcmarca,onChange:this.catchInputs}))),i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col"},i.a.createElement("i",{className:"fa fa-eye"})," ",i.a.createElement("label",null,"Derecho"),i.a.createElement("input",{type:"text",name:"lcgod",maxLength:"30",className:this.props.readOnly?"form-control disabled":"form-control",disabled:!!this.props.readOnly,value:this.props.lcgod?this.props.lcgod:"",onChange:this.catchInputs})),i.a.createElement("div",{className:"col"},i.a.createElement("i",{className:"fa fa-eye"})," ",i.a.createElement("label",null,"Izquierdo"),i.a.createElement("input",{type:"text",name:"lcgoi",maxLength:"30",className:this.props.readOnly?"form-control disabled":"form-control",disabled:!!this.props.readOnly,value:this.props.lcgoi?this.props.lcgoi:"",onChange:this.catchInputs}))))))}}]),t}(c.Component),U=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(e){var o;return Object(r.a)(this,t),(o=a.call(this,e)).handleClickCategory=function(e){e.preventDefault();var a=o.props,t=a.onChangeInput,n=a.nameCategory;o.setState({category_id:0,category_id_2:0,category_id_3:0,category_list_2:[],category_list_3:[]}),t(n,0)},o.handleCategoryChange=function(e){var a=e.target,t=a.name,r=a.value,l=o.props,s=l.onChangeInput,c=l.nameCategory;"category_id"===t&&r&&o.state.category_list.map((function(e){return e.id===1*r&&o.setState({category_list_2:e.hijos}),null})),"category_id_2"===t&&r&&o.state.category_list_2.map((function(e){return e.id===1*r&&o.setState({category_list_3:e.hijos}),null})),o.setState(Object(n.a)({},t,1*r)),"category_id_3"===t&&s(c,1*r)},o.getCategories=function(){var e=o.props.data,a=e.host,t=e.token;"number"===typeof o.props.category_id&&o.props.category_id>0?(console.log("Descargando recomendacion"),fetch("http://"+a+"/api/categories/"+o.props.category_id,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+t}}).then((function(e){if(!e.ok)throw new Error(e.statusText);return e.json()})).then((function(e){e.data&&(console.log("Recomendacion descargada"),o.setState({category:e.data}))})).catch((function(e){console.error("Orus: "+e),window.Swal.fire("Fallo de conexion","Verifique la conexion al servidor","error")}))):(console.log("Descargando lista de recomendaciones"),fetch("http://"+a+"/api/categories/1?categoryid=raiz",{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+t}}).then((function(e){if(!e.ok)throw new Error(e.statusText);return e.json()})).then((function(e){e.data&&(console.log("Lista de recomendaciones descargadas"),o.setState({category_list:e.data.hijos,meta:e.meta}))})).catch((function(e){console.error("Orus: "+e),window.Swal.fire("Fallo de conexion","Verifique la conexion al servidor","error")})))},o.state={category_list:[],meta:{},category_list_2:[],category_list_3:[],category_id:0,category_id_2:0,category_id_3:0,category:{}},o}return Object(o.a)(t,[{key:"componentDidMount",value:function(){this.getCategories()}},{key:"componentDidUpdate",value:function(e,a){e.category_id!==this.props.category_id&&(console.log("Recargando recomendacion"),this.getCategories())}},{key:"render",value:function(){var e=this.props,a=e.category_id,t=e.title,n=this.state.category,r=i.a.createElement("span",{className:"text-dark"}," / "),o=null;return o=n.depende_de?n.depende_de.depende_de?i.a.createElement(i.a.Fragment,null,n.depende_de.depende_de.categoria,r,n.depende_de.categoria,r,i.a.createElement("strong",null,n.categoria)):i.a.createElement(i.a.Fragment,null,n.depende_de.categoria,r,i.a.createElement("strong",null,n.categoria)):i.a.createElement("strong",null,n.categoria),i.a.createElement("div",{className:"card card-info card-outline mt-4"},i.a.createElement("div",{className:"card-header"},i.a.createElement("h3",{className:"card-title"},i.a.createElement("i",{className:"fas fa-thumbs-up mr-1"}),t)),i.a.createElement("div",{className:"card-body"},a?i.a.createElement(c.Fragment,null,i.a.createElement("h5",{className:"card-title text-info"},o),this.props.update?i.a.createElement("p",{className:"card-text"},i.a.createElement("button",{className:"btn btn-outline-info btn-sm card-link mt-2",onClick:this.handleClickCategory},"Cambiar")):null):this.state.category_list.length?i.a.createElement(c.Fragment,null,this.state.category_list.length?i.a.createElement("div",{className:"input-group mb-3"},i.a.createElement("div",{className:"input-group-prepend"},i.a.createElement("span",{className:"input-group-text"},"Tipo")),i.a.createElement("select",{name:"category_id",className:"custom-select",value:this.state.category_id,onChange:this.handleCategoryChange},i.a.createElement("option",{value:"0"},"Seleccione el tipo"),this.state.category_list.map((function(e){return i.a.createElement("option",{value:e.id,key:e.id},e.categoria)})))):null,this.state.category_list_2.length?i.a.createElement("div",{className:"input-group mb-3"},i.a.createElement("div",{className:"input-group-prepend"},i.a.createElement("span",{className:"input-group-text"},"Material")),i.a.createElement("select",{name:"category_id_2",className:"custom-select",value:this.state.category_id_2,onChange:this.handleCategoryChange},i.a.createElement("option",{value:"0"},"Seleccione el material"),this.state.category_list_2.map((function(e){return i.a.createElement("option",{value:e.id,key:e.id},e.categoria)})))):null,this.state.category_list_3.length?i.a.createElement("div",{className:"input-group mb-3"},i.a.createElement("div",{className:"input-group-prepend"},i.a.createElement("span",{className:"input-group-text"},"Tratamiento")),i.a.createElement("select",{name:"category_id_3",className:"custom-select",value:this.state.category_id_3,onChange:this.handleCategoryChange},i.a.createElement("option",{value:"0"},"Seleccione el tratamiento"),this.state.category_list_3.map((function(e){return i.a.createElement("option",{value:e.id,key:e.id},e.categoria)})))):null):i.a.createElement("div",{className:"spinner-border text-primary",role:"status"},i.a.createElement("span",{className:"sr-only"},"Loading..."))))}}]),t}(c.Component),M=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(e){var n;Object(r.a)(this,t),(n=a.call(this,e)).handleSaveExam=function(e){var a=e.id,t=n.props,r=t.paciente,o=t.edad;delete e.id,e.contact_id=r,e.edad=o,window.Swal.fire({title:"Almacenamiento",text:"\xbfEsta seguro de actualizar el examen?",icon:"question",showCancelButton:!0,confirmButtonColor:"#007bff",confirmButtonText:"Actualizar",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,preConfirm:function(t){if(t){var r=n.state,o=r.host,l=r.token;return console.log("Enviando datos a API para almacenar"),fetch("http://"+o+"/api/exams/"+a,{method:"PUT",body:JSON.stringify(e),headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+l}}).then(function(){var e=Object(y.a)(N.a.mark((function e(a){var t;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t={},204===a.status){e.next=5;break}return e.next=4,a.json();case 4:t=e.sent;case 5:if(a.ok){e.next=7;break}throw new Error(t.message);case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}()).catch((function(e){console.error("Orus fetch",e),window.Swal.fire("Fallo de conexion","Verifique la conexion al servidor","error")}))}}}).then((function(e){if(e&&!e.dismiss&&e.value){var a=e.value;a.data?(console.log("Examen almacenada"),window.Swal.fire({icon:"success",title:"Examen actualizado con exito",showConfirmButton:!1,timer:1500})):(window.Swal.fire("Error","al almacenar el pedido","error"),console.error("Orus res: ",a.message))}}))},n.handleDataExam=function(e,a){var t=n.state.exam;t[e]=a,n.setState({exam:t})},n.handleChangeInput=function(e,a){n.props.ChangeInput(e,a)},n.handleClickDeleteExam=function(e){e.preventDefault(),window.confirm("\xbfRealmente desea cambiar de examen?")&&(n.props.ChangeInput("exam_id",0),n.props.ChangeInput("exam",{}))},n.handleClickSelect=function(e){n.props.ChangeInput("exam_id",e.id),n.props.ChangeInput("exam",e)},n.handleNewOrder=function(e){window.Swal.fire({title:"Almacenamiento",text:"\xbfEsta seguro de crear una nueva orden?",icon:"info",showCancelButton:!0,confirmButtonText:"Si",cancelButtonText:"No",showLoaderOnConfirm:!0,preConfirm:function(a){if(a){var t=n.state,r=t.host,o=t.token,l={contact_id:n.props.paciente,exam_id:e,items:JSON.stringify([])};return console.log("Enviando datos del pedido a la API"),fetch("http://"+r+"/api/orders",{method:"POST",body:JSON.stringify(l),headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+o}}).then((function(e){if(!e.ok)throw new Error(e.statusText);return e.json()})).catch((function(e){console.error("Orus fetch: ",e),window.Swal.fire("Fallo de conexion","Verifique la conexion al servidor","error")}))}}}).then((function(e){if(e&&!e.dismiss&&e.value){var a=e.value;a.data?(console.log("Orden almacenada"),localStorage.setItem("OrusContactNew",JSON.stringify({})),window.Swal.fire("Orden creada con exito","","success").then((function(e){return n.getExams()}))):(window.Swal.fire("Error","al almacenar la orden","error"),console.error("Orus res: ",a.message))}}))},n.handleNewExam=function(e){e.preventDefault(),window.Swal.fire({title:"Almacenamiento",text:"\xbfEsta seguro de crear un nueva examen?",icon:"info",showCancelButton:!0,confirmButtonText:"Si",cancelButtonText:"No",showLoaderOnConfirm:!0,preConfirm:function(e){if(e){var a=n.state,t=a.host,r=a.token,o=n.props,l={contact_id:o.paciente,edad:o.edad};return console.log("Enviando datos del examen a la API"),fetch("http://"+t+"/api/exams",{method:"POST",body:JSON.stringify(l),headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+r}}).then((function(e){if(!e.ok)throw new Error(e.statusText);return e.json()})).catch((function(e){console.error("Orus fetch: ",e),window.Swal.fire("Fallo de conexion","Verifique la conexion al servidor","error")}))}}}).then((function(e){if(e&&!e.dismiss&&e.value){var a=e.value;a.data?(console.log("Examen almacenado"),localStorage.setItem("OrusContactNew",JSON.stringify({})),window.Swal.fire("Examen creado con exito","","success").then((function(e){return n.getExams()}))):(window.Swal.fire("Error","al almacenar el examen","error"),console.error("Orus res: ",a.message))}}))},n.changePage=function(e){n.props.page(e)},n.getExams=function(){var e=n.state,a=e.load,t=e.host,r=e.token,o=n.props.paciente;if(o){var l="http://"+t+"/api/exams",s=n.state.page>0?"?page="+n.state.page:"?page=1",c="&paciente="+o;a||n.setState({load:!0}),console.log("Descargando examenes del contacto"),fetch(l+s+c+"&orderby=created_at&order=desc",{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+r}}).then((function(e){return e.ok||(n.setState({load:!1}),console.log(e)),e.json()})).then((function(e){console.log("Examenes almacenados"),n.setState({data:e.message?[]:e,load:!1})}))}else n.setState({load:!1})};var o=JSON.parse(localStorage.getItem("OrusSystem"));return n.state={id:0,data:{data:[],meta:{}},exam:{},examEdit:!1,load:!0,page:0,host:o.host,token:o.token},n}return Object(o.a)(t,[{key:"componentDidMount",value:function(){this.props.exam&&!this.props.exam.id?this.getExams():this.setState({id:this.props.exam.id,exam:this.props.exam,load:!1})}},{key:"componentDidUpdate",value:function(e,a){this.props.exam&&!this.props.exam.id&&this.props.exam.id!==e.exam.id&&this.getExams(),this.props.exam&&this.props.exam.id!==e.exam.id&&this.setState({id:this.props.exam.id,exam:this.props.exam})}},{key:"render",value:function(){var e=this,a=this.state,t=a.data,n=a.load,r=a.id,o=a.exam,l=a.examEdit,s=this.props,c=s.select,m=s.datos;if(c)return i.a.createElement(i.a.Fragment,null,r?i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"row d-print-none mb-4"},i.a.createElement("div",{className:"col-2"},i.a.createElement("div",{className:"border border-info rounded p-2 d-flex justify-content-between align-items-center"},i.a.createElement("span",{className:"badge badge-pill badge-info mx-2"},"Folio"),i.a.createElement("strong",null,r))),i.a.createElement("div",{className:"col"},i.a.createElement("div",{className:"border border-info rounded p-2 d-flex justify-content-between align-items-center"},i.a.createElement("span",{className:"badge badge-pill badge-info mx-2"},"Estado"),i.a.createElement("strong",null,o.estado))),i.a.createElement("div",{className:"col"},i.a.createElement("div",{className:"border border-info rounded p-2 d-flex justify-content-between align-items-center"},i.a.createElement("span",{className:"badge badge-pill badge-info mx-2"},"Fecha"),i.a.createElement("strong",null,f.a.utc(o.created_at).local().format("LL")))),i.a.createElement("div",{className:"col-2 d-print-none text-right"},i.a.createElement("button",{className:this.props.status?"btn btn-info disabled":"btn btn-info",disabled:!!this.props.status,onClick:this.handleClickDeleteExam},"Cambiar"))),i.a.createElement(z,{esferaod:o.esferaod,esferaoi:o.esferaoi,cilindrod:o.cilindrod,cilindroi:o.cilindroi,ejeod:o.ejeod,ejeoi:o.ejeoi,adiciond:o.adiciond,adicioni:o.adicioni,dpod:o.dpod,dpoi:o.dpoi,alturaod:o.alturaod,alturaoi:o.alturaoi,lcmarca:o.lcmarca,lcgod:o.lcgod,lcgoi:o.lcgoi,readOnly:!l,onChangeInput:this.handleDataExam}),i.a.createElement("div",{className:"row d-print-none"},i.a.createElement("div",{className:"col text-right pt-2"},i.a.createElement("button",{className:l?"btn btn-dark":"btn btn-info",onClick:function(a){a.preventDefault(),l&&e.handleSaveExam(o),e.setState({examEdit:!l})}},l?i.a.createElement(i.a.Fragment,null,i.a.createElement("i",{className:"fas fa-save mr-2"})," Guardar"):i.a.createElement(i.a.Fragment,null,i.a.createElement("i",{className:"fas fa-pencil-alt mr-2"})," Editar")))),o.category_id?i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:o.category_ii?"col":"col-6"},i.a.createElement(U,{category_id:o.category_id,title:"Recomendacion principal",data:m,onChangeInput:this.handleChangeInput})),o.category_ii?i.a.createElement("div",{className:"col"},i.a.createElement(U,{category_id:o.category_ii,title:"Recomendacion adicional",data:m,onChangeInput:this.handleChangeInput})):null):null):i.a.createElement("table",{className:"table table-hover table-nowrap"},i.a.createElement("thead",null,i.a.createElement("tr",null,i.a.createElement("th",null,"Folio"),i.a.createElement("th",null,"Fecha"),i.a.createElement("th",null,"Edad"),i.a.createElement("th",null,"Estado"),i.a.createElement("th",null,"\xa0"))),i.a.createElement("tbody",null,n?i.a.createElement("tr",null,i.a.createElement("td",{colSpan:"5",className:"text-center"},i.a.createElement("div",{className:"spinner-border text-primary",role:"status"},i.a.createElement("span",{className:"sr-only"},"Loading...")))):Object.keys(t.data).length?t.data.map((function(a){return i.a.createElement("tr",{key:a.id,className:f.a.utc(new Date).isSame(f.a.utc(a.created_at),"day")?"table-success":""},i.a.createElement("td",null,i.a.createElement("span",{className:"badge badge-info"},a.id)),i.a.createElement("td",null,f.a.utc(a.created_at).local().format("L"),i.a.createElement("br",null),f()(new Date).isSame(a.created_at)),i.a.createElement("td",null,a.edad),i.a.createElement("td",null,a.estado?i.a.createElement("span",{className:"badge badge-secondary"},"Terminado"):i.a.createElement("span",{className:"badge badge-success"},"Activo")),i.a.createElement("td",null,i.a.createElement("button",{className:"btn btn-outline-dark btn-sm",onClick:function(t){t.preventDefault(),e.handleClickSelect(a)}},i.a.createElement("i",{className:"fas fa-check"}))))})):i.a.createElement("tr",null,i.a.createElement("th",{colSpan:"5",className:"text-center"},"Aun no tiene examenes",i.a.createElement("button",{className:"btn btn-outline-info btn-sm ml-4",onClick:this.handleNewExam},i.a.createElement("i",{className:"fas fa-plus"})))))));var u=!1,p=!1;return i.a.createElement("div",{className:"card card-info card-outline"},i.a.createElement("div",{className:"card-header"},i.a.createElement("i",{className:"fas fa-notes-medical mr-1"}),"Examenes realizados"),i.a.createElement("div",{className:"card-body"},i.a.createElement("table",{className:"table table-hover table-nowrap"},i.a.createElement("thead",null,i.a.createElement("tr",null,i.a.createElement("th",null,"Folio"),i.a.createElement("th",null,"Fecha"),i.a.createElement("th",null,"Edad"),i.a.createElement("th",null,"Estado"),i.a.createElement("th",{className:"text-center"},"Acciones"))),i.a.createElement("tbody",null,n?i.a.createElement("tr",null,i.a.createElement("td",{colSpan:"8",className:"text-center"},i.a.createElement("div",{className:"spinner-border text-primary",role:"status"},i.a.createElement("span",{className:"sr-only"},"Loading...")))):Object.keys(t.data).length?t.data.map((function(a){return u=f()(new Date).isSame(f()(a.created_at),"day"),p=!!p||u,console.log("Hoy: ",u,p),i.a.createElement("tr",{key:a.id,className:u?"table-success":""},i.a.createElement("td",null,i.a.createElement("span",{className:"badge badge-info"},a.id)),i.a.createElement("td",null,f()(a.created_at).format("L")),i.a.createElement("td",null,a.edad),i.a.createElement("td",null,a.estado?i.a.createElement("span",{className:"badge badge-secondary"},"Terminado"):i.a.createElement("span",{className:"badge badge-success"},"Activo")),i.a.createElement("td",{className:"text-right"},i.a.createElement(d.b,{className:"btn btn-outline-info btn-sm",to:"/consultorio/registro/"+a.id,onClick:function(a){e.changePage("/consultorio/registro/")},alt:"Ver examen"},i.a.createElement("i",{className:"fas fa-share"})," Ver examen")))})):i.a.createElement("tr",null,i.a.createElement("th",{colSpan:"5",className:"text-center"},"Aun no tiene examenes"))))),i.a.createElement("div",{className:"card-footer"},p?null:i.a.createElement("button",{type:"button",className:"btn btn-info float-right",onClick:this.handleNewExam},i.a.createElement("i",{className:"fas fa-plus"}))))}}]),t}(c.Component),q=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(e){var n;return Object(r.a)(this,t),(n=a.call(this,e)).eraseTilde=function(e){return e=(e=(e=(e=(e=e.replace(new RegExp(/[\xe0\xe1\xe2\xe3\xe4\xe5]/g),"a")).replace(new RegExp(/[\xe8\xe9\xea\xeb]/g),"e")).replace(new RegExp(/[\xec\xed\xee\xef]/g),"i")).replace(new RegExp(/[\xf2\xf3\xf4\xf5\xf6]/g),"o")).replace(new RegExp(/[\xf9\xfa\xfb\xfc]/g),"u")},n.handleChange=function(e){var a=e.target.value,t={target:{name:"validName",value:"",target:""}},r=n.eraseTilde(a.toLowerCase());e.target.value=r,/^[a-z.]{2,20}[\s]{1}[a-z.]{2,20}.*/.test(a)?(n.setState({bgColor:"bg-blue",validate:""}),t.target.value=!0,n.props.onChange(t),n.validUser(e.target.value,t)):(n.setState({bgColor:"bg-red",validate:" border border-danger",text:"No tiene el formato de nombre de persona",contacts:[]}),t.target.value=!1,n.props.onChange(t)),n.props.onChange(e)},n.validUser=function(e,a){var t=JSON.parse(localStorage.getItem("OrusSystem")),r="http://"+t.host+"/api/contacts",o="?name="+e;n.timeFetch&&clearTimeout(n.timeFetch),n.timeFetch=setTimeout((function(){n.setState({searchUser:!0}),fetch(r+o,{method:"GET",signal:n.signal,headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+t.token}}).then((function(e){return e.ok||(window.alert("Ups!\n Hubo un error, intentelo mas tarde"),console.error(e)),e.json()})).then((function(t){t.message?(console.error("Error en la descarga de contactos",t.message),n.setState({searchUser:!1}),a.target.value=!1,n.props.onChange(a)):(t.data.map((function(t){return n.eraseTilde(t.nombre)===e&&(console.log("Contacto registrado "),n.setState({bgColor:"bg-red",validate:" border border-danger",text:"El contacto ya esta registrado",searchUser:!1,contacts:[]}),a.target.value=!1,n.props.onChange(a)),!1})),n.setState({searchUser:!1,contacts:t.data}))})).catch((function(e){console.error(e),n.setState({searchUser:!1}),a.target.value=!1,n.props.onChange(a)}))}),1e3)},n.state={bgColor:e.validName?"bg-blue":"bg-red",validate:e.validName?"":" border border-danger",text:"Debe de tener por lo menos nombre y apellido",searchUser:!1,contacts:[]},n.controller=new AbortController,n.signal=n.controller.signal,n.timeFetch=null,n}return Object(o.a)(t,[{key:"componentWillUnmount",value:function(){this.controller.abort()}},{key:"componentDidUpdate",value:function(e){e.validName!==this.props.validName&&this.setState({bgColor:this.props.validName?"bg-blue":"bg-red",validate:this.props.validName?"":" border border-danger"})}},{key:"render",value:function(){var e=this,a=this.props,t=a.name,n=a.validName,r=this.state,o=r.bgColor,l=r.validate,s=r.text,c=r.searchUser,m=r.contacts;return t||(t=""),i.a.createElement(i.a.Fragment,null,t?i.a.createElement("div",{className:"ml-2 mt-1"},i.a.createElement("small",null,i.a.createElement("label",null,"Nombre completo"))):i.a.createElement("br",null),i.a.createElement("div",{className:"input-group mb-1"},i.a.createElement("div",{className:"input-group-prepend"},i.a.createElement("span",{className:"input-group-text "+o},c?i.a.createElement("i",{className:"fas fa-spinner"}):i.a.createElement("i",{className:"fas fa-id-card-alt"}))),i.a.createElement("input",{type:"text",className:"form-control text-capitalize"+l,placeholder:"Nombre completo",name:"name",value:t,onChange:this.handleChange,autoFocus:!t.length,autoComplete:"off",required:"required",pattern:"^[a-zA-Z.]{2,20}[\\s]{1}[a-zA-Z.]{2,20}.*",minLength:"8",list:"contactos_db"})),m.length?i.a.createElement("datalist",{id:"contactos_db"},m.map((function(a){return i.a.createElement("option",{key:a.id,value:e.eraseTilde(a.nombre)})}))):null,n?null:i.a.createElement("div",{className:"p-0"},i.a.createElement("small",{className:"text-danger"},s)))}}]),t}(c.Component),J=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(e){var n;return Object(r.a)(this,t),(n=a.call(this,e)).eraseTilde=function(e){return e=(e=(e=(e=(e=e.replace(new RegExp(/[\xe0\xe1\xe2\xe3\xe4\xe5]/g),"a")).replace(new RegExp(/[\xe8\xe9\xea\xeb]/g),"e")).replace(new RegExp(/[\xec\xed\xee\xef]/g),"i")).replace(new RegExp(/[\xf2\xf3\xf4\xf5\xf6]/g),"o")).replace(new RegExp(/[\xf9\xfa\xfb\xfc]/g),"u")},n.handleChange=function(e){var a=e.target.value,t=n.props.id,r={target:{name:"validEmail",value:"",target:""}},o=n.eraseTilde(a.toLowerCase());e.target.value=o,/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(a)?(n.setState({bgColor:"bg-blue",validate:""}),r.target.value=!0,n.props.onChange(r),(t||n.emailOriginal!==e.target.value)&&n.validUser(e.target.value,r)):(n.setState({bgColor:"bg-red",validate:" border border-danger",text:"No es un email correcto",contacts:[]}),r.target.value=!1,n.props.onChange(r)),n.props.onChange(e)},n.validUser=function(e,a){var t=JSON.parse(localStorage.getItem("OrusSystem")),r="http://"+t.host+"/api/contacts",o="?email="+e;n.timeFetch&&clearTimeout(n.timeFetch),n.timeFetch=setTimeout((function(){n.setState({emailContact:!0}),fetch(r+o,{method:"GET",signal:n.signal,headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+t.token}}).then((function(e){return e.ok||(window.alert("Ups!\n Hubo un error, intentelo mas tarde"),console.error(e)),e.json()})).then((function(t){t.message?(console.error("Error en la descarga de contactos",t.message),n.setState({emailContact:!1}),a.target.value=!1,n.props.onChange(a)):(t.data.map((function(t){return t.email===e&&(n.setState({bgColor:"bg-red",validate:" border border-danger",text:"El email ya esta registrado",emailContact:!1,contacts:[]}),a.target.value=!1,n.props.onChange(a)),!1})),n.setState({emailContact:!1,contacts:t.data}))})).catch((function(e){console.error(e),n.setState({emailContact:!1}),a.target.value=!1,n.props.onChange(a)}))}),1e3)},n.state={bgColor:e.validEmail?"bg-blue":"bg-red",validate:e.validEmail?"":" border border-danger",text:"No es un email correcto",emailContact:!1,contacts:[]},n.controller=new AbortController,n.signal=n.controller.signal,n.timeFetch=null,n.emailOriginal=e.email,n}return Object(o.a)(t,[{key:"componentWillUnmount",value:function(){this.controller.abort()}},{key:"componentDidUpdate",value:function(e){e.validEmail!==this.props.validEmail&&this.setState({bgColor:this.props.validEmail?"bg-blue":"bg-red",validate:this.props.validEmail?"":" border border-danger"})}},{key:"render",value:function(){var e=this.props,a=e.email,t=e.validEmail,n=this.state,r=n.bgColor,o=n.validate,l=n.text,s=n.emailContact,c=n.contacts;return a||(a=""),i.a.createElement(i.a.Fragment,null,a?i.a.createElement("div",{className:"ml-2 mt-1"},i.a.createElement("small",null,i.a.createElement("label",null,"Correo electronico"))):i.a.createElement("br",null),i.a.createElement("div",{className:"input-group mt-1"},i.a.createElement("div",{className:"input-group-prepend"},i.a.createElement("span",{className:"input-group-text "+r},s?i.a.createElement("i",{className:"fas fa-spinner"}):i.a.createElement("i",{className:"fas fa-at"}))),i.a.createElement("input",{type:"email",className:"form-control"+o,placeholder:"Correo electronico",name:"email",value:a,onChange:this.handleChange,autoComplete:"off",minLength:"8",list:"email_db"}),c.length?i.a.createElement("datalist",{id:"email_db"},c.map((function(e){return i.a.createElement("option",{key:e.id,value:e.email})}))):null),t?null:i.a.createElement("div",{className:"p-0"},i.a.createElement("small",{className:"text-danger"},l)))}}]),t}(c.Component),V=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(){var e;Object(r.a)(this,t);for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return(e=a.call.apply(a,[this].concat(o))).catchInputs=function(a){e.props.onChange(a)},e}return Object(o.a)(t,[{key:"render",value:function(){var e=this.props,a=e.type,t=e.business,n=e.name,r=e.rfc,o=e.email,l=e.birthday,s=e.validName,c=e.validEmail;return i.a.createElement("div",{className:"col "},i.a.createElement("small",null,i.a.createElement("label",null,"Tipo de cliente")),i.a.createElement("div",{className:"input-group mb-1"},i.a.createElement("div",{className:"input-group-prepend"},i.a.createElement("span",{className:"input-group-text"},i.a.createElement("i",{className:"fas fa-clipboard-check"}))),i.a.createElement("select",{className:"custom-select",name:"type",value:a,onChange:this.catchInputs},i.a.createElement("option",{value:"0"},"Cliente"),i.a.createElement("option",{value:"1"},"Proveedor"))),i.a.createElement("div",{className:"input-group mb-1"},i.a.createElement("div",{className:"input-group-prepend"},i.a.createElement("input",{type:"checkbox",name:"business",className:"mr-2",checked:t,onChange:this.catchInputs}),i.a.createElement("small",null,i.a.createElement("label",null,"\xbfEs una empresa?")))),i.a.createElement(q,{name:n,validName:s,onChange:this.catchInputs}),r?i.a.createElement("div",{className:"ml-2 mt-1"},i.a.createElement("small",null,i.a.createElement("label",null,"RFC"))):i.a.createElement("br",null),i.a.createElement("div",{className:"input-group mb-1"},i.a.createElement("div",{className:"input-group-prepend"},i.a.createElement("span",{className:"input-group-text"},i.a.createElement("i",{className:"fas fa-file-invoice-dollar"}))),i.a.createElement("input",{type:"text",className:"form-control text-uppercase",placeholder:"RFC",name:"rfc",value:r||"",onChange:this.catchInputs,required:!1,minLength:"10"})),i.a.createElement(J,{email:o,validEmail:c,onChange:this.catchInputs}),t||a?null:i.a.createElement(i.a.Fragment,null,l?i.a.createElement("div",{className:"ml-2 mt-1"},i.a.createElement("small",null,i.a.createElement("label",null,"Fecha de nacimiento"))):i.a.createElement("br",null),i.a.createElement("div",{className:"input-group mb-1"},i.a.createElement("div",{className:"input-group-prepend"},i.a.createElement("span",{className:"input-group-text"},i.a.createElement("i",{className:"fas fa-calendar-check"}))),i.a.createElement("input",{type:"date",className:"form-control",placeholder:"Fecha de nacimiento",name:"birthday",value:l||"",onChange:this.catchInputs}))))}}]),t}(c.Component),G=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(){var e;Object(r.a)(this,t);for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return(e=a.call.apply(a,[this].concat(o))).catchInputs=function(a){e.props.onChange(a)},e}return Object(o.a)(t,[{key:"render",value:function(){var e=this.props,a=e.calle,t=e.colonia,n=e.municipio,r=e.estado,o=e.cp;return i.a.createElement("div",{className:"col"},a?i.a.createElement("small",null,i.a.createElement("label",null,"Calle y numero")):i.a.createElement("br",null),i.a.createElement("div",{className:"input-group mb-1"},i.a.createElement("div",{className:"input-group-prepend"},i.a.createElement("span",{className:"input-group-text"},i.a.createElement("i",{className:"fas fa-road"}))),i.a.createElement("input",{type:"text",className:"form-control text-capitalize",placeholder:"Calle y numero",name:"calle",value:a,onChange:this.catchInputs})),t?i.a.createElement("small",null,i.a.createElement("label",null,"Colonia")):i.a.createElement("br",null),i.a.createElement("div",{className:"input-group mb-1"},i.a.createElement("div",{className:"input-group-prepend"},i.a.createElement("span",{className:"input-group-text"},i.a.createElement("i",{className:"fas fa-location-arrow"}))),i.a.createElement("input",{type:"text",className:"form-control text-capitalize",placeholder:"Colonia",name:"colonia",value:t,onChange:this.catchInputs})),n?i.a.createElement("small",null,i.a.createElement("label",null,"Municipio")):i.a.createElement("br",null),i.a.createElement("div",{className:"input-group mb-1"},i.a.createElement("div",{className:"input-group-prepend"},i.a.createElement("span",{className:"input-group-text"},i.a.createElement("i",{className:"fas fa-location-arrow"}))),i.a.createElement("input",{type:"text",className:"form-control text-capitalize",placeholder:"Municipio",name:"municipio",value:n,onChange:this.catchInputs})),r?i.a.createElement("small",null,i.a.createElement("label",null,"Estado")):i.a.createElement("br",null),i.a.createElement("div",{className:"input-group mb-1"},i.a.createElement("div",{className:"input-group-prepend"},i.a.createElement("span",{className:"input-group-text"},i.a.createElement("i",{className:"fas fa-map-marker"}))),i.a.createElement("input",{type:"text",className:"form-control text-capitalize",placeholder:"Estado",name:"estado",value:r,onChange:this.catchInputs})),o?i.a.createElement("small",null,i.a.createElement("label",null,"Codigo postal")):i.a.createElement("br",null),i.a.createElement("div",{className:"input-group mb-1"},i.a.createElement("div",{className:"input-group-prepend"},i.a.createElement("span",{className:"input-group-text"},i.a.createElement("i",{className:"fas fa-map-marker"}))),i.a.createElement("input",{type:"text",className:"form-control",placeholder:"Codigo Postal",name:"cp",value:o,onChange:this.catchInputs})))}}]),t}(c.Component),R=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(){var e;Object(r.a)(this,t);for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return(e=a.call.apply(a,[this].concat(o))).catchInputs=function(a){e.props.onChange(a)},e}return Object(o.a)(t,[{key:"render",value:function(){var e=this.props,a=e.t_casa,t=e.t_oficina,n=e.t_movil,r=10===a.length||10===n.length||10===t.length;return i.a.createElement("div",{className:"col"},a?i.a.createElement("div",{className:"ml-1 mt-1"},i.a.createElement("small",null,i.a.createElement("label",null,"Telefono de casa"))):i.a.createElement("br",null),i.a.createElement("div",{className:"input-group mb-1"},i.a.createElement("div",{className:"input-group-prepend"},i.a.createElement("span",{className:"input-group-text"},i.a.createElement("i",{className:"fas fa-phone"}))),i.a.createElement("input",{type:"tel",className:"form-control",placeholder:"Telefono de casa",name:"t_casa",value:a,onChange:this.catchInputs,pattern:"^[\\d]{10}$",maxLength:"10"})),t?i.a.createElement("div",{className:"ml-1 mt-1"},i.a.createElement("small",null,i.a.createElement("label",null,"Telefono de oficina"))):i.a.createElement("br",null),i.a.createElement("div",{className:"input-group mb-1"},i.a.createElement("div",{className:"input-group-prepend"},i.a.createElement("span",{className:"input-group-text"},i.a.createElement("i",{className:"fas fa-phone-alt"}))),i.a.createElement("input",{type:"tel",className:"form-control",placeholder:"Telefono de oficina",name:"t_oficina",value:t,onChange:this.catchInputs,pattern:"^[\\d]{10}$",maxLength:"10"})),n?i.a.createElement("div",{className:"ml-1 mt-1"},i.a.createElement("small",null,i.a.createElement("label",null,"Telefono celular"))):i.a.createElement("br",null),i.a.createElement("div",{className:"input-group mb-1"},i.a.createElement("div",{className:"input-group-prepend"},i.a.createElement("span",{className:"input-group-text"},i.a.createElement("i",{className:"fas fa-mobile-alt"}))),i.a.createElement("input",{type:"tel",className:"form-control",placeholder:"Telefono celular",name:"t_movil",value:n,onChange:this.catchInputs,pattern:"^[\\d]{10}$",required:10!==a.length&&10!==t.length,maxLength:"10"})),r?null:i.a.createElement("div",{className:"mt-2 p-0 text-danger"},i.a.createElement("small",null,"Por lo menos capture un telefono")))}}]),t}(c.Component),$=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(e){var o;Object(r.a)(this,t),(o=a.call(this,e)).changeAddress=function(e){o.setState(e)},o.changePage=function(e){o.props.page(e)},o.catchInputs=function(e){var a=e.target.name,t="checkbox"===e.target.type?e.target.checked:e.target.value;o.setState(Object(n.a)({},a,t))},o.handleSave=function(e){e.preventDefault();var a=o.state,t=a.validName,n=a.validEmail,r=a.id;return t?n?void window.Swal.fire({title:"Almacenamiento",text:r?"\xbfEsta seguro de actualizar al contacto?":"\xbfEsta seguro de crear un nuevo contacto?",icon:"question",showCancelButton:!0,confirmButtonText:r?"Actualizar":"Crear",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,preConfirm:function(e){if(e){var a=o.state,t=a.name,n=a.rfc,l=a.email,s=a.type,c=a.birthday,i=a.calle,m=a.colonia,d=a.municipio,u=a.estado,p=a.cp,h=a.t_casa,g=a.t_oficina,f=a.t_movil,E=a.business,v=a.host,b=a.token,N={name:t,rfc:n,email:l,type:s,birthday:E?"":c,business:E,domicilio:JSON.stringify({calle:i,colonia:m,municipio:d,estado:u,cp:p}),telnumbers:JSON.stringify({t_casa:h,t_oficina:g,t_movil:f})},y=r?"http://"+v+"/api/contacts/"+r:"http://"+v+"/api/contacts",w=r?"PUT":"POST";return console.log("Enviando datos del pedido a la API"),fetch(y,{method:w,body:JSON.stringify(N),signal:o.signal,headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+b}}).then((function(e){if(!e.ok)throw new Error(e.statusText);return e.json()})).catch((function(e){console.error("Orus fetch: ",e),window.Swal.fire("Fallo de conexion","Verifique la conexion al servidor","error")}))}}}).then((function(e){if(e&&!e.dismiss&&e.value){var a=e.value;a.data?(console.log("Contacto almacenado"),localStorage.setItem("OrusContactNew",JSON.stringify({})),localStorage.setItem("OrusContactInUse",JSON.stringify({id:a.data.id})),window.Swal.fire({icon:"success",title:r?"Contacto actualizado con exito":"Contacto almacenado con exito",showConfirmButton:!1,timer:1500}).then((function(e){o.props.history.goBack()}))):(window.Swal.fire("Error","al almacenar el contacto","error"),console.error("Orus res: ",a.message))}})):(window.Swal.fire("Base de datos","El email ya esta registrado","warning"),!1):(window.Swal.fire("Base de datos","El contacto ya esta registrado","warning"),!1)},o.getUser=function(e){if(e>0){var a=o.state,t=a.load,n=a.host,r=a.token;t||o.setState({load:!0}),console.log("Descargando datos del contacto del API"),fetch("http://"+n+"/api/contacts/"+e,{method:"GET",signal:o.signal,headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+r}}).then((function(e){if(!e.ok)throw new Error(e.statusText);return e.json()})).then((function(e){if(e.data){var a=e.data,t=a.domicilio,n=a.telefonos;console.log("Almacenando datos del contacto"),o.setState({id:e.data.id,name:e.data.nombre,rfc:e.data.rfc,email:e.data.email,type:e.data.tipo,business:e.data.empresa,birthday:e.data.f_nacimiento,calle:t&&t.calle?t.calle:"",colonia:t&&t.colonia?t.colonia:"",municipio:t&&t.municipio?t.municipio:"",estado:t&&t.estado?t.estado:"",cp:t&&t.cp?t.cp:"",t_casa:n&&n.t_casa?n.t_casa:"",t_oficina:n&&n.t_oficina?n.t_oficina:"",t_movil:n&&n.t_movil?n.t_movil:"",validName:!0,validEmail:!0,load:!1})}else console.error("Orus: ",e.message),window.Swal.fire("Error","Al descargar el contacto","error"),o.setState({load:!1})})).catch((function(e){console.error(e),window.Swal.fire("Fallo de conexion","Verifique la conexion al servidor","error"),o.setState({load:!1})}))}};var l=JSON.parse(localStorage.getItem("OrusContactInUse"));return o.state={id:0,name:l&&l.name?l.name:"",validName:!1,rfc:"",email:"",validEmail:!1,type:0,birthday:"",calle:"",colonia:"",municipio:"",estado:"",cp:"",t_casa:"",t_oficina:"",t_movil:"",business:!1,load:!1,host:e.data.host,token:e.data.token},o.controller=new AbortController,o.signal=o.controller.signal,o.timeSave=null,o}return Object(o.a)(t,[{key:"componentWillUnmount",value:function(){this.controller.abort()}},{key:"componentDidMount",value:function(){var e=this.props.match.params.id,a=JSON.parse(localStorage.getItem("OrusContactNew"));e?this.getUser(e):(a&&a.name&&a.name.length>4&&window.confirm("Existe un registro previo de "+a.name.toUpperCase()+", \n \xbfDesea Cargar los datos?")&&this.setState({name:a.name,validName:!0,rfc:a.rfc,email:a.email,validEmail:!0,type:a.type,birthday:a.birthday,calle:a.calle,colonia:a.colonia,municipio:a.municipio,estado:a.estado,cp:a.cp,t_casa:a.t_casa,t_oficina:a.t_oficina,t_movil:a.t_movil}),localStorage.setItem("OrusContactNew",JSON.stringify({})))}},{key:"componentDidUpdate",value:function(e,a){var t=this;!this.state.id&&!this.state.load&&this.state.validName&&this.state.validEmail?(this.timeSave&&clearTimeout(this.timeSave),this.timeSave=setTimeout((function(){localStorage.setItem("OrusContactNew",JSON.stringify({name:t.state.name,rfc:t.state.rfc,email:t.state.email,type:t.state.type,birthday:t.state.birthday,calle:t.state.calle,colonia:t.state.colonia,municipio:t.state.municipio,estado:t.state.estado,cp:t.state.cp,t_casa:t.state.t_casa,t_oficina:t.state.t_oficina,t_movil:t.state.t_movil}))}),1500)):localStorage.setItem("OrusContactNew",JSON.stringify({}))}},{key:"render",value:function(){var e=this,a=this.state,t=a.id,n=a.name,r=a.rfc,o=a.email,l=a.type,s=a.birthday,c=a.calle,m=a.colonia,u=a.municipio,p=a.estado,h=a.cp,g=a.t_casa,E=a.t_oficina,v=a.t_movil,b=a.business,N=a.load,y=a.validName,w=a.validEmail;return i.a.createElement("form",{onSubmit:this.handleSave},i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-md-12"},i.a.createElement("div",{className:"card card-danger card-outline"},i.a.createElement("div",{className:"card-header"},i.a.createElement("h3",{className:"card-title text-danger"},i.a.createElement("i",{className:"fas fa-address-book mr-2"}),t?"Editar contacto":"Registrar nuevo contacto",y&&w?i.a.createElement("span",{className:"ml-2 text-muted"},i.a.createElement("small",null,"(Almacenado automatico)")):null)),i.a.createElement("div",{className:"card-body"},i.a.createElement("div",{className:"row was-validated"},i.a.createElement(V,{id:t,name:n,rfc:r,email:o,type:l,birthday:s,business:b,validName:y,validEmail:w,onChange:this.catchInputs}),i.a.createElement(G,{calle:c,colonia:m,municipio:u,estado:p,cp:h,onChange:this.catchInputs}),i.a.createElement(R,{t_casa:g,t_movil:v,t_oficina:E,onChange:this.catchInputs}))),i.a.createElement("div",{className:"card-footer"},i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-md-12"},N?i.a.createElement("div",{className:"text-center"},i.a.createElement("div",{className:"spinner-border text-primary",role:"status"},i.a.createElement("span",{className:"sr-only"},"Loading..."))):i.a.createElement("div",{className:"btn-group float-right",role:"group"},i.a.createElement(d.b,{to:"/contactos",className:"btn btn-dark",onClick:function(a){e.changePage("/contactos")}},i.a.createElement("i",{className:t?"fas fa-arrow-left mr-2":"fas fa-ban mr-2"}),i.a.createElement("strong",null,t?"Regresar":"Cancelar")),i.a.createElement("button",{type:"submit",className:y&&w&&(g||E||v)?"btn btn-danger":"btn btn-danger disabled",disabled:y&&w&&(g||E||v)?"":"disabled"},i.a.createElement("i",{className:"fas fa-save mr-1"}),"Guardar")))))))),i.a.createElement("div",{className:"row"},this.state.calle&&!this.state.type?i.a.createElement("div",{className:"col"},i.a.createElement(L,{calle:this.state.calle,colonia:this.state.colonia,municipio:this.state.municipio,estado:this.state.estado,cp:this.state.cp,changeAddress:this.changeAddress})):"",this.state.id&&!this.state.type?i.a.createElement("div",{className:"col"},i.a.createElement(M,{paciente:this.state.id,exam:{},page:this.changePage,edad:1*f()(this.state.birthday).fromNow(!0).replace(/[a-zA-Z\xf1\xd1]/gi,"")})):null))}}]),t}(c.Component),Z=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(e){var n;return Object(r.a)(this,t),(n=a.call(this,e)).state={name:"",validName:!1,rfc:"",email:"",validEmail:!1,type:0,birthday:"",t_casa:"",t_oficina:"",t_movil:"",business:!1,load:!1,host:e.data.host,token:e.data.token},n.controller=new AbortController,n.signal=n.controller.signal,n.timeSave=null,n}return Object(o.a)(t,[{key:"componentWillUnmount",value:function(){this.controller.abort()}},{key:"render",value:function(){var e=this.state,a=e.name,t=e.email,n=e.birthday,r=e.t_casa,o=e.t_oficina,l=e.t_movil,s=e.load,c=e.validName,m=e.validEmail;return i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-md-12"},i.a.createElement("div",{className:"card card-danger card-outline"},i.a.createElement("div",{className:"card-header"},i.a.createElement("h3",{className:"card-title text-danger"},i.a.createElement("i",{className:"fas fa-address-book mr-2"}),"Pacientes")),i.a.createElement("div",{className:"card-body"},i.a.createElement("div",{className:"row was-validated"},i.a.createElement("div",{className:"input-group mb-1"},i.a.createElement("div",{className:"input-group-prepend"},i.a.createElement("span",{className:"input-group-text "},i.a.createElement("i",{className:"fas fa-id-card-alt"}))),i.a.createElement("input",{type:"text",className:"form-control text-capitalize",placeholder:"Nombre completo",name:"name",value:a,onChange:this.handleChange,autoFocus:!a.length,autoComplete:"off",required:"required",pattern:"^[a-zA-Z.]{2,20}[\\s]{1}[a-zA-Z.]{2,20}.*",minLength:"8",list:"contactos_db"})),i.a.createElement("div",{className:"input-group mb-1"},i.a.createElement("div",{className:"input-group-prepend"},i.a.createElement("span",{className:"input-group-text "},i.a.createElement("i",{className:"fas fa-at"}))),i.a.createElement("input",{type:"email",className:"form-control",placeholder:"Correo electronico",name:"email",value:t,onChange:this.handleChange,autoComplete:"off",minLength:"8",list:"email_db"})),i.a.createElement("div",{className:"input-group mb-1"},i.a.createElement("div",{className:"input-group-prepend"},i.a.createElement("span",{className:"input-group-text"},i.a.createElement("i",{className:"fas fa-phone"}))),i.a.createElement("input",{type:"tel",className:"form-control",placeholder:"Telefono",name:"t_movil",value:l,onChange:this.catchInputs,pattern:"^[\\d]{10}$",maxLength:"10"}))),i.a.createElement("div",{className:"input-group mb-1"},i.a.createElement("div",{className:"input-group-prepend"},i.a.createElement("span",{className:"input-group-text"},i.a.createElement("i",{className:"fas fa-calendar-check"}))),i.a.createElement("input",{type:"date",className:"form-control",placeholder:"Fecha de nacimiento",name:"birthday",value:n||"",onChange:this.catchInputs}))),i.a.createElement("div",{className:"card-footer"},i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-md-12"},s?i.a.createElement("div",{className:"text-center"},i.a.createElement("div",{className:"spinner-border text-primary",role:"status"},i.a.createElement("span",{className:"sr-only"},"Loading..."))):i.a.createElement("div",{className:"btn-group float-right",role:"group"},i.a.createElement("button",{type:"submit",className:c&&m&&(r||o||l)?"btn btn-danger":"btn btn-danger disabled",disabled:c&&m&&(r||o||l)?"":"disabled"},i.a.createElement("i",{className:"fas fa-save mr-1"}),"Guardar"))))))))}}]),t}(c.Component),W=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(e){var o;return Object(r.a)(this,t),(o=a.call(this,e)).handleCategoryChange=function(e){var a=e.target,t=a.name,r=a.value;"category_id"===t&&r&&o.state.category_select.map((function(e){return e.id===1*r&&o.setState({category_hijos:e.hijos}),null})),"category_id_2"===t&&r&&o.state.category_hijos.map((function(e){return e.id===1*r&&o.setState({category_hijos_3:e.hijos}),null})),o.setState(Object(n.a)({},t,r))},o.handleChangePage=function(e){o.setState({page:e})},o.handleClickDelete=function(e,a){window.Swal.fire({title:"Eliminar",text:"\xbfEsta seguro de eliminar la categoria "+a.toUpperCase()+"?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Eliminar",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,preConfirm:function(a){if(a&&e){var t=o.state,n=t.host,r=t.token;return console.log("Solicitud de eliminaci\xf3n de categoria por API"),fetch("http://"+n+"/api/categories/"+e,{method:"DELETE",signal:o.signal,headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+r}}).then(function(){var e=Object(y.a)(N.a.mark((function e(a){var t;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t={},204===a.status){e.next=5;break}return e.next=4,a.json();case 4:t=e.sent;case 5:if(a.ok){e.next=7;break}throw new Error(t.message);case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}()).catch((function(e){console.error("Orus fetch",e),window.Swal.fire("Fallo de conexion","Verifique la conexion al servidor","error")}))}}}).then((function(e){e&&!e.dismiss&&e.value?(console.log("Categoria eliminado"),window.Swal.fire({icon:"success",title:"Categoria eliminada con exito",showConfirmButton:!1,timer:1500}).then((function(e){return o.getCategories()}))):e&&!e.dismiss&&(console.log("Orus res: ",e),window.Swal.fire("Error","Se perdio la conexion con el servidor","error"))}))},o.handleClickSave=function(){if(o.state.name.length<4)return window.Swal.fire("Verificaci\xf3n","Debe de escribir el nombre de la categoria","warning"),o.nameInput.focus(),!1;window.Swal.fire({title:"Almacenamiento",text:"\xbfEsta seguro de crear una nueva categoria?",icon:"question",showCancelButton:!0,confirmButtonColor:"#007bff",confirmButtonText:"Crear",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,preConfirm:function(e){if(e){var a=o.state,t=a.host,n=a.token,r={name:o.state.name,category_id:o.state.category_id_3?o.state.category_id_3:o.state.category_id_2?o.state.category_id_2:o.state.category_id};return console.log("Enviando datos a API para almacenar"),fetch("http://"+t+"/api/categories",{method:"POST",body:JSON.stringify(r),headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+n}}).then(function(){var e=Object(y.a)(N.a.mark((function e(a){var t;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t={},204===a.status){e.next=5;break}return e.next=4,a.json();case 4:t=e.sent;case 5:if(a.ok){e.next=7;break}throw new Error(t.message);case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}()).catch((function(e){console.error("Orus fetch",e),window.Swal.fire("Fallo de conexion","Verifique la conexion al servidor","error")}))}}}).then((function(e){if(e&&!e.dismiss&&e.value){var a=e.value;a.data?(console.log("Categoria almacenada"),window.Swal.fire({icon:"success",title:"Categoria almacenada con exito",showConfirmButton:!1,timer:1500}).then((function(e){o.setState({newItem:a.data.id}),o.getCategories()}))):(window.Swal.fire("Error","al almacenar la categoria","error"),console.error("Orus res: ",a.message))}}))},o.getCategories=function(){var e=o.state,a=e.host,t=e.token,n=e.load,r="http://"+a+"/api/categories",l=o.state.page>0?"?page="+o.state.page:"?page=1";n||o.setState({load:!0}),console.log("Descargando lista de categorias"),fetch(r+l,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+t}}).then((function(e){if(!e.ok)throw new Error(e.statusText);return e.json()})).then((function(e){e.data&&(console.log("Lista de categorias descargadas"),o.setState({category_list:e.data,meta:e.meta,newItem:0,add:!1,category_id:0,name:"",load:!1}))})).catch((function(e){console.error("Orus: "+e),window.Swal.fire("Fallo de conexion","Verifique la conexion al servidor","error")})),fetch(r+l+"&categoryid=raiz",{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+t}}).then((function(e){if(!e.ok)throw new Error(e.statusText);return e.json()})).then((function(e){e.data&&o.setState({category_select:e.data})})).catch((function(e){console.error("Orus: "+e),window.Swal.fire("Fallo de conexion","Verifique la conexion al servidor","error")}))},o.handleClickAdd=function(){o.setState({add:!o.state.add,name:"",category_id:0,category_id_2:0,category_id_3:0,category_hijos:[],category_hijos_3:[]})},o.catchInputs=function(e){var a=e.target,t=a.name,r=a.value;o.setState(Object(n.a)({},t,r.toLowerCase()))},o.state={category_list:[],category_select:[],category_hijos:[],category_hijos_3:[],meta:{},add:!1,name:"",category_id:0,category_id_2:0,category_id_3:0,newItem:0,page:1,host:e.data.host,token:e.data.token,load:!0},o.controller=new AbortController,o.signal=o.controller.signal,o}return Object(o.a)(t,[{key:"componentWillUnmount",value:function(){this.controller.abort()}},{key:"componentDidMount",value:function(){this.getCategories()}},{key:"componentDidUpdate",value:function(e,a){a.page!==this.state.page&&(console.log("Recargando categorias"),this.getCategories())}},{key:"render",value:function(){var e=this,a=this.state,t=a.category_list,n=a.meta,r=a.load,o=this.state.category_hijos,l=this.state.category_hijos_3;return i.a.createElement("div",{className:"card card-primary card-outline"},i.a.createElement("div",{className:"card-body"},i.a.createElement("h5",{className:"card-title"},"Categorias"),i.a.createElement("table",{className:"table"},i.a.createElement("thead",null,i.a.createElement("tr",null,i.a.createElement("th",null,"Nombre"),i.a.createElement("th",null,"Padre"),i.a.createElement("th",null,"Eliminar"))),i.a.createElement("tbody",null,r?i.a.createElement("tr",null,i.a.createElement("td",{colSpan:"8",className:"text-center"},i.a.createElement("div",{className:"spinner-border text-primary",role:"status"},i.a.createElement("span",{className:"sr-only"},"Loading...")))):t.map((function(a){var t="";return null!=a.depende_de&&(null!=a.depende_de.depende_de&&(t=a.depende_de.depende_de.categoria),t=t?t+"/"+a.depende_de.categoria:a.depende_de.categoria),t=t||"--",i.a.createElement("tr",{key:a.id,className:a.id===e.state.newItem?"table-success":""},i.a.createElement("td",{className:"text-capitalize"},a.categoria),i.a.createElement("td",{className:"text-capitalize"},t),i.a.createElement("td",null,i.a.createElement("button",{className:"btn btn-outline-light btn-sm",onClick:function(t){e.handleClickDelete(a.id,a.categoria)}},i.a.createElement("i",{className:"fas fa-trash"}))))}))),this.state.add&&!r?i.a.createElement("tfoot",null,i.a.createElement("tr",null,i.a.createElement("td",null,i.a.createElement("input",{type:"text",name:"name",className:"form-control",autoComplete:"off",value:this.state.name,onChange:this.catchInputs,ref:function(a){e.nameInput=a}})),i.a.createElement("td",null,i.a.createElement("select",{name:"category_id",className:"form-control",value:this.state.category_id,onChange:this.handleCategoryChange},i.a.createElement("option",{value:"0"},"Inicial"),this.state.category_select.map((function(e){return i.a.createElement("option",{key:e.id,value:e.id},e.categoria)}))),o.length?i.a.createElement("select",{name:"category_id_2",className:"form-control mt-2",value:this.state.category_id_2,onChange:this.handleCategoryChange},i.a.createElement("option",{value:"0"},"Raiz"),this.state.category_hijos.map((function(e){return i.a.createElement("option",{key:e.id,value:e.id},e.categoria)}))):"",l.length?i.a.createElement("select",{name:"category_id_3",className:"form-control mt-2",value:this.state.category_id_3,onChange:this.handleCategoryChange},i.a.createElement("option",{value:"0"},"Raiz"),this.state.category_hijos_3.map((function(e){return i.a.createElement("option",{key:e.id,value:e.id},e.categoria)}))):""),i.a.createElement("td",null,i.a.createElement("button",{className:"btn btn-dark btn-sm",onClick:this.handleClickSave},i.a.createElement("i",{className:"fas fa-save"}))))):i.a.createElement("tfoot",null,i.a.createElement("tr",null,i.a.createElement("td",{colSpan:"3"},i.a.createElement(x,{meta:n,handleChangePage:this.handleChangePage})))))),i.a.createElement("div",{className:"card-footer text-right"},i.a.createElement("button",{className:"btn btn-primary btn-sm",onClick:this.handleClickAdd},this.state.add?i.a.createElement("i",{className:"fas fa-undo"}):i.a.createElement("i",{className:"fas fa-plus"}))))}}]),t}(c.Component),K=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(e){var o;return Object(r.a)(this,t),(o=a.call(this,e)).clickSave=function(){var e=JSON.parse(localStorage.getItem("OrusSystem"));e.company=o.state.company,e.host=o.state.server,localStorage.setItem("OrusSystem",JSON.stringify(e))},o.clickSaveUser=function(){var e=JSON.parse(localStorage.getItem("OrusSystem"));e.email=o.state.email,e.name=o.state.name,e.username=o.state.username,localStorage.setItem("OrusSystem",JSON.stringify(e))},o.catchInputs=function(e){var a=e.target,t=a.name,r=a.value;o.setState(Object(n.a)({},t,r.toLowerCase()))},o.state={server:"",company:"",email:"",name:"",username:"",password:"",category_list:[]},o}return Object(o.a)(t,[{key:"componentDidMount",value:function(){var e=JSON.parse(localStorage.getItem("OrusSystem"));this.setState({server:e.host?e.host:window.location.host.split(":")[0],company:e.company?e.company:"",email:e.email?e.email:"",name:e.name?e.name:"",username:e.username?e.username:""})}},{key:"render",value:function(){var e=this.props.data;return i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-6"},i.a.createElement("div",{className:"card card-primary card-outline"},i.a.createElement("div",{className:"card-body"},i.a.createElement("h5",{className:"card-title"},"Generales"),i.a.createElement("p",null,"\xa0"),i.a.createElement("div",{className:"input-group mb-3"},i.a.createElement("div",{className:"input-group-prepend"},i.a.createElement("span",{className:"input-group-text"},i.a.createElement("i",{className:"fas fa-server"}))),i.a.createElement("input",{type:"text",className:"form-control",placeholder:"Servidor",name:"server",value:this.state.server,onChange:this.catchInputs})),i.a.createElement("div",{className:"input-group mb-3"},i.a.createElement("div",{className:"input-group-prepend"},i.a.createElement("span",{className:"input-group-text"},i.a.createElement("i",{className:"fas fa-building"}))),i.a.createElement("input",{type:"text",className:"form-control text-capitalize",placeholder:"Nombre de la empresa",name:"company",value:this.state.company,onChange:this.catchInputs}))),i.a.createElement("div",{className:"card-footer text-right"},i.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:this.clickSave},"Guardar"))),i.a.createElement(W,{data:e})),i.a.createElement("div",{className:"col-6"},i.a.createElement("div",{className:"card card-primary card-outline"},i.a.createElement("div",{className:"card-body"},i.a.createElement("h5",{className:"card-title"},"Usuario"),i.a.createElement("p",null,"\xa0"),i.a.createElement("div",{className:"input-group mb-3"},i.a.createElement("div",{className:"input-group-prepend"},i.a.createElement("span",{className:"input-group-text"},i.a.createElement("i",{className:"fas fa-at"}))),i.a.createElement("input",{type:"text",className:"form-control",placeholder:"Email",name:"email",value:this.state.email,onChange:this.catchInputs})),i.a.createElement("div",{className:"input-group mb-3"},i.a.createElement("div",{className:"input-group-prepend"},i.a.createElement("span",{className:"input-group-text"},i.a.createElement("i",{className:"fas fa-user-tag"}))),i.a.createElement("input",{type:"text",className:"form-control text-capitalize",placeholder:"Nombre completo",name:"name",value:this.state.name,onChange:this.catchInputs})),i.a.createElement("hr",null),i.a.createElement("div",{className:"input-group mb-3"},i.a.createElement("div",{className:"input-group-prepend"},i.a.createElement("span",{className:"input-group-text"},i.a.createElement("i",{className:"fas fa-user-check"}))),i.a.createElement("input",{type:"text",className:"form-control",placeholder:"Usuario",name:"username",value:this.state.username,onChange:this.catchInputs})),i.a.createElement("div",{className:"input-group mb-3"},i.a.createElement("div",{className:"input-group-prepend"},i.a.createElement("span",{className:"input-group-text"},i.a.createElement("i",{className:"fas fa-lock"}))),i.a.createElement("input",{type:"text",className:"form-control",placeholder:"Contrase\xf1a",name:"password",value:this.state.password,onChange:this.catchInputs}))),i.a.createElement("div",{className:"card-footer text-right"},i.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:this.clickSaveUser},"Guardar")))))}}]),t}(c.Component),H=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(){var e;Object(r.a)(this,t);for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return(e=a.call.apply(a,[this].concat(o))).onKeyPressSearch=function(a){"Enter"===a.key&&(a.preventDefault(),e.setFilters())},e.onClickClean=function(){e.props.changeFilters("search",""),e.props.changeFilters("status",0),e.props.changeFilters("date",f()(new Date).format("YYYY-MM-DD")),e.setFilters()},e.setFilters=function(){e.props.handleChangePage(1),window.$("#filters").modal("hide")},e.changeFilters=function(a){var t=a.target,n=t.name,r=t.value;e.props.changeFilters(n,r)},e}return Object(o.a)(t,[{key:"render",value:function(){var e=this.props,a=e.search,t=e.status,n=e.date;return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"btn-group"},i.a.createElement("a",{href:"#Filters",className:"btn btn-tool text-dark","data-toggle":"modal","data-target":"#filters"},i.a.createElement("i",{className:"fas fa-filter"}))),i.a.createElement("div",{className:"modal",tabIndex:"-1",role:"dialog",id:"filters"},i.a.createElement("div",{className:"modal-dialog"},i.a.createElement("div",{className:"modal-content"},i.a.createElement("div",{className:"modal-header"},i.a.createElement("h5",{className:"modal-title"},"Busquedas"),i.a.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-label":"Close"},i.a.createElement("span",{"aria-hidden":"true"},"\xd7"))),i.a.createElement("form",{className:"modal-body"},i.a.createElement("div",{className:"input-group mb-3"},i.a.createElement("div",{className:"input-group-prepend"},i.a.createElement("span",{className:"input-group-text"},i.a.createElement("i",{className:"fas fa-search"}))),i.a.createElement("input",{type:"text",name:"search",className:"form-control",placeholder:"Por: paciente",value:a||"",onChange:this.changeFilters,onKeyPress:this.onKeyPressSearch})),i.a.createElement("div",{className:"input-group mb-3"},i.a.createElement("label",null,"Estado"),i.a.createElement("div",{className:"input-group-prepend ml-4"},i.a.createElement("span",{className:"input-group-text"},i.a.createElement("i",{className:"fas fa-toggle-on"}))),i.a.createElement("select",{className:"form-control",name:"status",value:t,onChange:this.changeFilters},i.a.createElement("option",{value:""},"Todos"),i.a.createElement("option",{value:"0"},"Activo"),i.a.createElement("option",{value:"1"},"Terminado"))),i.a.createElement("div",{className:"input-group mb-3"},i.a.createElement("label",null,"Fecha"),i.a.createElement("div",{className:"input-group-prepend ml-4"},i.a.createElement("span",{className:"input-group-text"},i.a.createElement("i",{className:"fas fa-calendar-alt"}))),i.a.createElement("input",{type:"date",className:"form-control",name:"date",value:n,onChange:this.changeFilters}))),i.a.createElement("div",{className:"modal-footer"},i.a.createElement("div",{className:"btn-group btn-group-lg",role:"group"},i.a.createElement("button",{type:"button",className:"btn btn-outline-dark","data-dismiss":"modal"},i.a.createElement("i",{className:"fas fa-window-close mr-2"}),"Cancelar"),i.a.createElement("button",{type:"button",className:a||n||t?"btn btn-outline-dark":"btn btn-outline-dark disabled",onClick:this.onClickClean},i.a.createElement("i",{className:"fas fa-eraser mr-2"}),"Limpiar"),i.a.createElement("button",{type:"button",className:"btn btn-outline-dark",onClick:this.setFilters,"data-dismiss":"modal"},i.a.createElement("i",{className:"fas fa-search mr-2"}),"Buscar")))))))}}]),t}(c.Component),Y=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(e){var o;Object(r.a)(this,t),(o=a.call(this,e)).handleFilter=function(){o.setState({load:!0,page:1})},o.onchangeSearch=function(e,a){o.setState(Object(n.a)({},e,a))},o.handleOrder=function(e){o.setState({orderby:e,order:"desc"===o.state.order?"asc":"desc",load:!0})},o.handleChangePage=function(e){o.setState({page:e,load:!0})},o.changePage=function(e){o.props.page(e.target.id)},o.handleDelete=function(e,a){window.Swal.fire({title:"Eliminar",text:"\xbfEsta seguro de eliminar el examen del paciente "+a.toUpperCase()+"?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Eliminar",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,preConfirm:function(a){if(a){var t=o.state,n=t.host,r=t.token;return fetch("http://"+n+"/api/exams/"+e,{method:"DELETE",signal:o.signal,headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+r}}).then(function(){var e=Object(y.a)(N.a.mark((function e(a){var t;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t={},204===a.status){e.next=5;break}return e.next=4,a.json();case 4:t=e.sent;case 5:if(a.ok){e.next=7;break}throw new Error(t.message);case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}()).catch((function(e){console.error(e),window.Swal.fire("Fallo de conexion","Verifique la conexion al servidor","error")}))}}}).then((function(e){e&&!e.dismiss&&e.value?(console.log("Examen eliminado"),window.Swal.fire({icon:"success",title:"Examen eliminado con exito",showConfirmButton:!1,timer:1500}).then((function(e){return o.getExams()}))):e&&!e.dismiss&&(console.log("Orus: ",e),window.Swal.fire("Error","Se perdio la conexion con el servidor","error"))}))};var l=JSON.parse(localStorage.getItem("OrusExam"));return o.state={exams:{data:[],meta:{}},load:!0,page:l?l.page:1,orderby:l&&l.orderby?l.orderby:"created_at",order:l&&l.order?l.order:"desc",search:l&&l.search?l.search:"",status:l&&l.status>=0?l.status:"",date:l&&l.date?l.date:"",host:e.data.host,token:e.data.token},o.controller=new AbortController,o.signal=o.controller.signal,o}return Object(o.a)(t,[{key:"componentWillUnmount",value:function(){this.controller.abort()}},{key:"componentDidMount",value:function(){this.getExams(),localStorage.setItem("OrusExam",JSON.stringify({page:this.state.page,orderby:this.state.orderby,order:this.state.order,search:this.state.search,status:this.state.status,date:this.state.date})),localStorage.setItem("OrusContactInUse",JSON.stringify({}))}},{key:"componentDidUpdate",value:function(e,a){!1===a.load&&!0===this.state.load&&(console.log("Recargando examenes"),this.getExams(),localStorage.setItem("OrusExam",JSON.stringify({page:this.state.page,orderby:this.state.orderby,order:this.state.order,search:this.state.search,status:this.state.status,date:this.state.date})))}},{key:"render",value:function(){var e=this,a=this.state,t=a.exams,n=a.load;return i.a.createElement("div",{className:"card card-info card-outline"},i.a.createElement("div",{className:"card-header"},i.a.createElement("h3",{className:"card-title text-info"},i.a.createElement("i",{className:"fas fa-notes-medical mr-2"}),"Examanes de la vista"),i.a.createElement("div",{className:"card-tools"},i.a.createElement(H,{search:this.state.search,status:this.state.status,date:this.state.date,changeFilters:this.onchangeSearch,handleChangePage:this.handleChangePage}),i.a.createElement(x,{meta:t.meta,handleChangePage:this.handleChangePage}))),i.a.createElement("div",{className:"card-body table-responsive p-0"},i.a.createElement("table",{className:"table table-bordered table-hover table-nowrap"},i.a.createElement(w,{orderby:this.state.orderby,order:this.state.order,data:[{name:"Paciente",type:"name",filter:!0},{name:"Edad"},{name:"Estado"},{name:"Esfera"},{name:"Cilindro"},{name:"Eje"},{name:"Adicion"},{name:"D/P"},{name:"Altura"},{name:"Actualizado",type:"updated_at",filter:!0},{name:"Registrado",type:"created_at",filter:!0}],actions:!0,handleOrder:this.handleOrder}),i.a.createElement("tbody",null,n?i.a.createElement("tr",null,i.a.createElement("td",{colSpan:"12",className:"text-center"},i.a.createElement("div",{className:"spinner-border text-primary",role:"status"},i.a.createElement("span",{className:"sr-only"},"Loading...")))):Object.keys(t.data).length?t.data.map((function(a){return i.a.createElement("tr",{key:a.id,className:a.estado?"table-secondary":f.a.utc(new Date).isSame(f.a.utc(a.created_at),"hour")?"table-success":""},i.a.createElement("td",null,i.a.createElement(d.b,{to:"/consultorio/registro/"+a.id},i.a.createElement("span",{className:"badge badge-danger text-capitalize p-1"},a.paciente.nombre,i.a.createElement("i",{className:"fas fa-pencil-alt ml-1"})))),i.a.createElement("td",null,a.edad?a.edad:"--"),i.a.createElement("td",{className:"text-uppercase"},a.estado?i.a.createElement("span",{className:"text-secondary"},"Terminado"):i.a.createElement("span",{className:"text-success"},"Activo")),i.a.createElement("td",null,a.esferaod,"/",a.esferaoi),i.a.createElement("td",null,a.cilindrod,"/",a.cilindroi),i.a.createElement("td",null,a.ejeod,"/",a.ejeoi),i.a.createElement("td",null,a.adiciond,"/",a.adicioni),i.a.createElement("td",null,a.dpod,"/",a.dpoi),i.a.createElement("td",null,a.alturaod,"/",a.alturaoi),i.a.createElement("td",null,f()(a.created_at).fromNow()),i.a.createElement("td",null,f()(a.updated_at).format("ll")),i.a.createElement(k,{id:a.id,item:a.paciente.nombre,delete:a.estado||a.order_id?null:e.handleDelete,edit:"/consultorio/registro/"}))})):i.a.createElement("tr",null,i.a.createElement("th",{colSpan:"12",className:"text-center"},"No hay datos para mostrar"))))),i.a.createElement("div",{className:"card-footer text-right"},i.a.createElement(d.b,{to:"/consultorio/registro",className:"btn btn-outline-info",onClick:this.changePage,id:"/consultorio/registro"},i.a.createElement("i",{className:"fas fa-plus",id:"/consultorio/registro"}),"\xa0 Nuevo examen")))}},{key:"getExams",value:function(){var e=this,a=this.state,t=a.host,n=a.token,r=a.order,o=a.orderby,l=a.search,s=a.page,c=a.status,i=a.load,m=a.date,d="http://"+t+"/api/exams",u="&orderby=".concat(o,"&order=").concat(r),p=l?"&search=".concat(l):"",h=s>0?"?page="+s:"?page=1",g=""===m?"":"&date="+m,f=""===c?"":"&status="+c;i||this.setState({load:!0}),fetch(d+h+u+f+g+p,{method:"GET",signal:this.signal,headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+n}}).then((function(e){if(!e.ok)throw new Error(e.statusText);return e.json()})).then((function(a){a.data?(console.log("Examenes descargados"),e.setState({exams:a,load:!1})):(console.error("Orus: ",a.message),window.Swal.fire("Error","Al descargar examenes","error"),e.setState({load:!1}))})).catch((function(a){console.error(a),window.Swal.fire("Fallo de conexion","Verifique la conexion al servidor","error"),e.setState({load:!1})}))}}]),t}(c.Component),X=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(e){var o;return Object(r.a)(this,t),(o=a.call(this,e)).sendAge=function(e){var a=e.target.value,t=o.state.dataContact.id;a>0&&a<110&&t&&o.props.getIdContact(t,1*a)},o.getContact=function(e){var a=JSON.parse(localStorage.getItem("OrusSystem"));fetch("http://"+a.host+"/api/contacts/"+e,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+a.token}}).then(function(){var e=Object(y.a)(N.a.mark((function e(a){var t;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t={},204===a.status){e.next=5;break}return e.next=4,a.json();case 4:t=e.sent;case 5:if(a.ok){e.next=7;break}throw new Error(t.message);case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}()).then((function(e){console.log("Descargando contacto"),o.setState({dataContact:e.data,load:!1})})).catch((function(e){console.log(e)}))},o.handleChangePage=function(e){o.props.changePage(e)},o.handleClickChange=function(e){e.preventDefault(),window.confirm("\xbfEsta seguro?")&&(o.setState({contacto:"",data:[],dataContact:{}}),localStorage.setItem("OrusContactInUse",JSON.stringify({})),o.props.getIdContact(0))},o.handleClickContact=function(e,a){e.preventDefault(),o.state.data.map((function(e){if(e.id===a){o.setState({contacto:"",data:[],dataContact:e});var t=1*f()(e.f_nacimiento).fromNow(!0).replace(/[a-zA-Z\xf1\xd1]/gi,"");return o.props.getIdContact(a,t),localStorage.setItem("OrusContactInUse",JSON.stringify({id:a})),!1}return!0}))},o.getContacts=function(e){o.state.load||o.setState({load:!0}),o.timeSave&&clearTimeout(o.timeSave),o.timeSave=setTimeout((function(){var a=JSON.parse(localStorage.getItem("OrusSystem")),t="http://"+a.host+"/api/contacts",n=e?"&search=".concat(e):"";console.log("Descargando contactos de la API"),fetch(t+"?page=1"+n+"&type=0",{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+a.token}}).then(function(){var e=Object(y.a)(N.a.mark((function e(a){var t;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t={},204===a.status){e.next=5;break}return e.next=4,a.json();case 4:t=e.sent;case 5:if(a.ok){e.next=7;break}throw new Error(t.message);case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}()).then((function(a){a.data&&a.data.length?(console.log("Mostrando informaci\xf3n del contacto"),o.setState({data:a.data,load:!1})):(o.setState({data:[{id:0,nombre:"No hay contactos para: "+e}],load:!1}),localStorage.setItem("OrusContactInUse",JSON.stringify({name:e.toLowerCase()})))})).catch((function(e){console.error("Orus fetch",e),window.Swal.fire("Fallo de conexion","Verifique la conexion al servidor","error")}))}),1500)},o.handleSearcContact=function(e){var a=e.target,t=a.name,r=a.value;o.setState(Object(n.a)({},t,r))},o.state={contacto:"",data:[],dataContact:{},load:!1,edad:30},o}return Object(o.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.contact;e?this.getContact(e):this.contactInput.focus()}},{key:"componentDidUpdate",value:function(e,a){a.contacto!==this.state.contacto&&(this.state.contacto.length>2?this.getContacts(this.state.contacto):this.setState({data:[]})),e.contact!==this.props.contact&&this.props.contact&&(this.setState({load:!0}),this.getContact(this.props.contact))}},{key:"render",value:function(){var e=this,a=this.state.load;if(this.props.contact){if(a)return i.a.createElement("div",{className:"card card-danger card-outline d-print-none"},i.a.createElement("div",{className:"card-body box-profile"},i.a.createElement("div",{className:"text-center"},i.a.createElement("div",{className:"spinner-border text-primary",role:"status"},i.a.createElement("span",{className:"sr-only"},"Loading...")))));if(Object.keys(this.state.dataContact).length){var t=this.state.dataContact,n=t.nombre,r=t.telefonos,o=t.domicilio,l=t.id,s=t.f_nacimiento,c="number"===typeof this.props.edad&&this.props.edad?this.props.edad+" a\xf1os":s?f()(s).fromNow(!0):0;return i.a.createElement("div",{className:"card card-danger card-outline"},i.a.createElement("div",{className:"card-body box-profile"},i.a.createElement("div",{className:"text-center"},i.a.createElement("img",{className:"profile-user-img img-fluid img-circle",src:"/img/avatars/no-avatar.png",alt:"User Avatar"})),i.a.createElement("h3",{className:"profile-username text-center text-capitalize"},n),i.a.createElement("h6",{className:"text-muted text-center"},r.t_movil?i.a.createElement("span",null,"Movil: ",r.t_movil):r.t_casa?i.a.createElement("span",null,"Casa: ",r.t_casa):r.t_oficina?i.a.createElement("span",null,"Oficina: ",r.t_oficina):i.a.createElement("span",{className:"text-danger"},"Capture el telefono")),i.a.createElement("p",{className:"text-muted text-center"},o&&o.calle.length>6?o.calle:null),i.a.createElement("ul",{className:"list-group list-group-unbordered mb-3"},i.a.createElement("li",{className:"list-group-item d-flex justify-content-between align-items-center"},i.a.createElement("b",null,"Edad:"),c?i.a.createElement("span",{className:"badge badge-primary badge-pill"},c):i.a.createElement("input",{type:"number",name:"edad",className:"form-control",value:this.state.edad,onChange:this.handleSearcContact,onBlur:this.sendAge,onKeyPress:function(a){"Enter"===a.key&&e.sendAge(a)}})),i.a.createElement("li",{className:"list-group-item d-flex justify-content-between align-items-center"},i.a.createElement("b",null,"#Contacto:"),i.a.createElement("span",{className:"badge badge-primary badge-pill"},l))),this.props.status?"":i.a.createElement("div",{className:"btn-group btn-block",role:"group"},i.a.createElement("button",{type:"button",className:"btn btn-dark",onClick:this.handleClickChange},i.a.createElement("i",{className:"fas fa-exchange-alt mr-1"}),i.a.createElement("b",null,"Cambiar")),i.a.createElement(d.b,{to:"/contactos/registro/"+l,className:"btn btn-danger",onClick:function(a){e.handleChangePage("/contactos/registro/")}},i.a.createElement("i",{className:"fas fa-edit mr-1"}),i.a.createElement("b",null,"Editar")))))}return null}return i.a.createElement("div",{className:"card card-danger card-outline d-print-none"},i.a.createElement("div",{className:"card-body"},i.a.createElement("label",null,"Buscar paciente"),i.a.createElement("div",{className:"input-group mb-3"},i.a.createElement("div",{className:"input-group-prepend"},i.a.createElement("span",{className:"input-group-text"},i.a.createElement("i",{className:"fas fa-user"}))),i.a.createElement("input",{type:"text",className:"form-control text-capitalize",placeholder:"Nombre del paciente",name:"contacto",autoComplete:"off",value:this.state.contacto,onChange:this.handleSearcContact,ref:function(a){e.contactInput=a}})),this.state.data.length?i.a.createElement("ul",{className:"list-group"},this.state.data.map((function(a){return i.a.createElement("li",{key:a.id,className:"list-group-item"},i.a.createElement("a",{href:"#contact",className:"text-muted text-capitalize",onClick:function(t){e.handleClickContact(t,a.id)}},i.a.createElement("i",{className:"fas fa-user mr-1"}),a.nombre),a.id?"":i.a.createElement("p",null,i.a.createElement(d.b,{to:"/contactos/registro/",className:"btn btn-primary",onClick:function(a){e.handleChangePage("/contactos/registro/")}},i.a.createElement("i",{className:"fas fa-user mr-1"}),i.a.createElement("b",null,"Agregar nuevo paciente"))))}))):a?i.a.createElement("div",{className:"text-center"},i.a.createElement("div",{className:"spinner-border text-primary",role:"status"},i.a.createElement("span",{className:"sr-only"},"Loading..."))):null))}}]),t}(c.Component),Q=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(){var e;Object(r.a)(this,t);for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return(e=a.call.apply(a,[this].concat(o))).catchInputs=function(a){var t=a.target.name,n="checkbox"===a.target.type?a.target.checked:a.target.value.toLowerCase();e.props.onChangeInput(t,n)},e}return Object(o.a)(t,[{key:"render",value:function(){return i.a.createElement("div",{className:"card"},i.a.createElement("div",{className:"card-header",id:"headingOne"},i.a.createElement("h2",{className:"mb-0"},i.a.createElement("button",{className:"btn btn-link btn-block text-left text-info collapsed",type:"button","data-toggle":"collapse","data-target":"#collapseOne","aria-expanded":"true","aria-controls":"collapseOne"},"Generales"))),i.a.createElement("div",{id:"collapseOne",className:"collapse","aria-labelledby":"headingOne","data-parent":"#accordionExample"},i.a.createElement("div",{className:"card-body"},i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-md-3"},i.a.createElement("div",{className:"custom-control custom-switch"},i.a.createElement("input",{name:"pc",type:"checkbox",className:"custom-control-input",id:"pc",checked:this.props.pc,onChange:this.catchInputs}),i.a.createElement("label",{className:"custom-control-label",htmlFor:"pc"},i.a.createElement("i",{className:"fas fa-desktop"})," PC")),i.a.createElement("input",{type:"text",name:"pc_time",className:"form-control input-xs",value:this.props.pc_time,onChange:this.catchInputs,readOnly:this.props.pc?"":"readonly"})),i.a.createElement("div",{className:"col-md-3"},i.a.createElement("div",{className:"custom-control custom-switch"},i.a.createElement("input",{name:"tablet",type:"checkbox",className:"custom-control-input",id:"tablet",checked:this.props.tablet,onChange:this.catchInputs}),i.a.createElement("label",{className:"custom-control-label",htmlFor:"tablet"},i.a.createElement("i",{className:"fas fa-tablet-alt"})," Tablet")),i.a.createElement("input",{type:"text",name:"tablet_time",className:"form-control input-xs",value:this.props.tablet_time,onChange:this.catchInputs,readOnly:this.props.tablet?"":"readonly"})),i.a.createElement("div",{className:"col-md-3"},i.a.createElement("div",{className:"custom-control custom-switch"},i.a.createElement("input",{name:"movil",type:"checkbox",className:"custom-control-input",id:"movil",checked:this.props.movil,onChange:this.catchInputs}),i.a.createElement("label",{className:"custom-control-label",htmlFor:"movil"},i.a.createElement("i",{className:"fas fa-mobile-alt"})," Telefono")),i.a.createElement("input",{type:"text",name:"movil_time",className:"form-control input-xs",value:this.props.movil_time,onChange:this.catchInputs,readOnly:this.props.movil?"":"readonly"})),i.a.createElement("div",{className:"col-md-3"},i.a.createElement("div",{className:"custom-control custom-switch"},i.a.createElement("input",{name:"lap",type:"checkbox",className:"custom-control-input",id:"lap",checked:this.props.lap,onChange:this.catchInputs}),i.a.createElement("label",{className:"custom-control-label",htmlFor:"lap"},i.a.createElement("i",{className:"fas fa-laptop"})," Laptop")),i.a.createElement("input",{type:"text",name:"lap_time",className:"form-control input-xs",value:this.props.lap_time,onChange:this.catchInputs,readOnly:this.props.lap?"":"readonly"}))),i.a.createElement("div",{className:"row mt-1"},i.a.createElement("div",{className:"col-md-6"},i.a.createElement("ul",{className:"list-group"},i.a.createElement("li",{className:"list-group-item d-flex justify-content-between align-items-center"},i.a.createElement("div",{className:"custom-control custom-switch"},i.a.createElement("input",{name:"frontal",type:"checkbox",className:"custom-control-input",id:"frontal",checked:this.props.frontal,onChange:this.catchInputs}),i.a.createElement("label",{className:"custom-control-label",htmlFor:"frontal"},"Frontal"))),i.a.createElement("li",{className:"list-group-item d-flex justify-content-between align-items-center"},i.a.createElement("div",{className:"custom-control custom-switch"},i.a.createElement("input",{name:"occipital",type:"checkbox",className:"custom-control-input",id:"occipital",checked:this.props.occipital,onChange:this.catchInputs}),i.a.createElement("label",{className:"custom-control-label",htmlFor:"occipital"},"Occipital"))),i.a.createElement("li",{className:"list-group-item d-flex justify-content-between align-items-center"},i.a.createElement("div",{className:"custom-control custom-switch"},i.a.createElement("input",{name:"generality",type:"checkbox",className:"custom-control-input",id:"generality",checked:this.props.generality,onChange:this.catchInputs}),i.a.createElement("label",{className:"custom-control-label",htmlFor:"generality"},"General"))),i.a.createElement("li",{className:"list-group-item d-flex justify-content-between align-items-center"},i.a.createElement("div",{className:"custom-control custom-switch"},i.a.createElement("input",{name:"cefalea",type:"checkbox",className:"custom-control-input",id:"cefalea",checked:this.props.cefalea,onChange:this.catchInputs}),i.a.createElement("label",{className:"custom-control-label",htmlFor:"cefalea"},"Cefalea"))))),i.a.createElement("div",{className:"col-md-6"},i.a.createElement("ul",{className:"list-group"},i.a.createElement("li",{className:"list-group-item"},"Temporal",i.a.createElement("br",null),i.a.createElement("div",{className:"row mt-2"},i.a.createElement("div",{className:"col"},i.a.createElement("div",{className:"custom-control custom-switch"},i.a.createElement("input",{name:"temporaod",type:"checkbox",className:"custom-control-input",id:"temporaod",checked:this.props.temporaod,onChange:this.catchInputs}),i.a.createElement("label",{className:"custom-control-label",htmlFor:"temporaod"},i.a.createElement("i",{className:"fa fa-eye"})," Derecho"))),i.a.createElement("div",{className:"col"},i.a.createElement("div",{className:"custom-control custom-switch"},i.a.createElement("input",{name:"temporaoi",type:"checkbox",className:"custom-control-input",id:"temporaoi",checked:this.props.temporaoi,onChange:this.catchInputs}),i.a.createElement("label",{className:"custom-control-label",htmlFor:"temporaoi"},i.a.createElement("i",{className:"fa fa-eye"})," Izquierdo"))))),i.a.createElement("li",{className:"list-group-item"},"Frecuencia",i.a.createElement("span",{className:"badge badge-pill"},i.a.createElement("input",{type:"text",name:"c_frecuencia",maxLength:"60",className:"form-control input-xs",value:this.props.c_frecuencia,onChange:this.catchInputs}))),i.a.createElement("li",{className:"list-group-item"},i.a.createElement("label",{htmlFor:"c_intensidad"},"Intensidad"),i.a.createElement("input",{type:"range",name:"c_intensidad",className:"custom-range custom-range-info",id:"c_intensidad",min:"0",max:"4",value:this.props.c_intensidad,onChange:this.catchInputs}))))))))}}]),t}(c.Component),ee=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(){var e;Object(r.a)(this,t);for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return(e=a.call.apply(a,[this].concat(o))).catchInputs=function(a){var t=a.target.name,n="checkbox"===a.target.type?a.target.checked:a.target.value.toLowerCase();e.props.onChangeInput(t,n)},e}return Object(o.a)(t,[{key:"render",value:function(){return i.a.createElement("div",{className:"card"},i.a.createElement("div",{className:"card-header",id:"headingThree"},i.a.createElement("h2",{className:"mb-0"},i.a.createElement("button",{className:"btn btn-link btn-block text-left text-info collapsed",type:"button","data-toggle":"collapse","data-target":"#collapseThree","aria-expanded":"false","aria-controls":"collapseThree"},"Interrogatorios"))),i.a.createElement("div",{id:"collapseThree",className:"collapse","aria-labelledby":"headingThree","data-parent":"#accordionExample"},i.a.createElement("div",{className:"card-body"},i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-12"},i.a.createElement("label",null,"Interrogatorio inicial"),i.a.createElement("textarea",{name:"interrogatorio",className:"form-control",value:this.props.interrogatorio,onChange:this.catchInputs}))),i.a.createElement("div",{className:"row mt-2"},i.a.createElement("div",{className:"col-12"},i.a.createElement("label",null,"Cirugias oculares"),i.a.createElement("textarea",{name:"coa",className:"form-control",value:this.props.coa,onChange:this.catchInputs}))),i.a.createElement("div",{className:"row mt-2"},i.a.createElement("div",{className:"col-12"},i.a.createElement("label",null,"Antecedentes oculares patologicas personales"),i.a.createElement("textarea",{name:"aopp",className:"form-control",rows:"2",value:this.props.aopp,onChange:this.catchInputs}))),i.a.createElement("div",{className:"row mt-2"},i.a.createElement("div",{className:"col-12"},i.a.createElement("label",null,"Antecedentes oculares patologicas familiares"),i.a.createElement("textarea",{name:"aopf",className:"form-control",rows:"2",value:this.props.aopf,onChange:this.catchInputs}))))))}}]),t}(c.Component),ae=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(){var e;Object(r.a)(this,t);for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return(e=a.call.apply(a,[this].concat(o))).catchInputs=function(a){var t=a.target.name,n="checkbox"===a.target.type?a.target.checked:a.target.value.toLowerCase();e.props.onChangeInput(t,n)},e}return Object(o.a)(t,[{key:"render",value:function(){return i.a.createElement("div",{className:"card"},i.a.createElement("div",{className:"card-header",id:"heading"},i.a.createElement("h2",{className:"mb-0"},i.a.createElement("button",{className:"btn btn-link btn-block text-left text-info collapsed",type:"button","data-toggle":"collapse","data-target":"#panel_100","aria-expanded":"true","aria-controls":"panel_100"},"Keratrometria y Retinoscopia"))),i.a.createElement("div",{id:"panel_100",className:"collapse","aria-labelledby":"headingOne","data-parent":"#accordionExample"},i.a.createElement("div",{className:"card-body"},i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-6"},"Keratometria"),i.a.createElement("div",{className:"col-6"},"Retinoscopia")),i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-md-3"},i.a.createElement("i",{className:"fas fa-eye"})," ",i.a.createElement("label",null,"Derecho"),i.a.createElement("input",{type:"text",name:"keratometriaod",maxLength:"12",className:"form-control input-xs",value:this.props.keratometriaod,onChange:this.catchInputs})),i.a.createElement("div",{className:"col-3"},i.a.createElement("i",{className:"fas fa-eye"})," ",i.a.createElement("label",null,"Izquierdo"),i.a.createElement("input",{type:"text",name:"keratometriaoi",maxLength:"12",className:"form-control input-xs",value:this.props.keratometriaoi,onChange:this.catchInputs})),i.a.createElement("div",{className:"col-md-3"},i.a.createElement("i",{className:"fa fa-eye"})," ",i.a.createElement("label",null,"Derecho"),i.a.createElement("input",{type:"text",name:"rsod",maxLength:"16",className:"form-control",value:this.props.rsod,onChange:this.catchInputs})),i.a.createElement("div",{className:"col-md-3"},i.a.createElement("i",{className:"fa fa-eye"})," ",i.a.createElement("label",null,"Izquierdo"),i.a.createElement("input",{type:"text",name:"rsoi",maxLength:"16",className:"form-control",value:this.props.rsoi,onChange:this.catchInputs}))))))}}]),t}(c.Component),te=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(){var e;Object(r.a)(this,t);for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return(e=a.call.apply(a,[this].concat(o))).catchInputs=function(a){var t=a.target.name,n="checkbox"===a.target.type?a.target.checked:a.target.value.toLowerCase();e.props.onChangeInput(t,n)},e}return Object(o.a)(t,[{key:"render",value:function(){return i.a.createElement("div",{className:"card"},i.a.createElement("div",{className:"card-header",id:"heading4"},i.a.createElement("h2",{className:"mb-0"},i.a.createElement("button",{className:"btn btn-link btn-block text-left text-info collapsed",type:"button","data-toggle":"collapse","data-target":"#caja4","aria-expanded":"false","aria-controls":"caja4"},"Diabetes"))),i.a.createElement("div",{id:"caja4",className:"collapse","aria-labelledby":"headingThree","data-parent":"#accordionExample"},i.a.createElement("div",{className:"card-body"},i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-md-8"},i.a.createElement("label",null,"Diab\xe9tico")),i.a.createElement("div",{className:"col-md-4"},i.a.createElement("label",null,"Fotocoagulaci\xf3n laser"))),i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-3"},"Fecha"),i.a.createElement("div",{className:"col-2"},"Rango de glucosa"),i.a.createElement("div",{className:"col-3"},"Ultimo examen"),i.a.createElement("div",{className:"col-2"},i.a.createElement("div",{className:"custom-control custom-switch"},i.a.createElement("input",{name:"d_fclod",type:"checkbox",className:"custom-control-input",id:"d_fclod",checked:this.props.d_fclod,onChange:this.catchInputs}),i.a.createElement("label",{className:"custom-control-label",htmlFor:"d_fclod"},i.a.createElement("i",{className:"fa fa-eye"})," Derecho"))),i.a.createElement("div",{className:"col-2"},i.a.createElement("div",{className:"custom-control custom-switch"},i.a.createElement("input",{name:"d_fcloi",type:"checkbox",className:"custom-control-input",id:"d_fcloi",checked:this.props.d_fcloi,onChange:this.catchInputs}),i.a.createElement("label",{className:"custom-control-label",htmlFor:"d_fcloi"},i.a.createElement("i",{className:"fa fa-eye"})," Izquierdo")))),i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-md-3"},i.a.createElement("input",{type:"date",name:"d_time",className:"form-control",value:this.props.d_time,onChange:this.catchInputs})),i.a.createElement("div",{className:"col-md-2"},i.a.createElement("input",{type:"text",name:"d_media",className:"form-control",value:this.props.d_media,onChange:this.catchInputs})),i.a.createElement("div",{className:"col-md-3"},i.a.createElement("input",{type:"date",name:"d_test",className:"form-control",value:this.props.d_test,onChange:this.catchInputs})),i.a.createElement("div",{className:"col-md-2"},i.a.createElement("input",{type:"text",name:"d_fclod_time",className:"form-control",value:this.props.d_fclod_time,onChange:this.catchInputs,readOnly:this.props.d_fclod?"":"readonly"})),i.a.createElement("div",{className:"col-md-2"},i.a.createElement("input",{type:"text",name:"d_fcloi_time",className:"form-control",value:this.props.d_fcloi_time,onChange:this.catchInputs,readOnly:this.props.d_fcloi?"":"readonly"}))),i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-12"},i.a.createElement("label",null,"Oftalmoscopia"),i.a.createElement("textarea",{name:"oftalmoscopia",className:"form-control",value:this.props.oftalmoscopia,onChange:this.catchInputs}))))))}}]),t}(c.Component),ne=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(){var e;Object(r.a)(this,t);for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return(e=a.call.apply(a,[this].concat(o))).catchInputs=function(a){var t=a.target.name,n="checkbox"===a.target.type?a.target.checked:a.target.value.toLowerCase();e.props.onChangeInput(t,n)},e}return Object(o.a)(t,[{key:"render",value:function(){return i.a.createElement("div",{className:"card"},i.a.createElement("div",{className:"card-header",id:"heading5"},i.a.createElement("h2",{className:"mb-0"},i.a.createElement("button",{className:"btn btn-link btn-block text-left text-info collapsed",type:"button","data-toggle":"collapse","data-target":"#caja5","aria-expanded":"false","aria-controls":"caja5"},"Capacidad y agudeza visual"))),i.a.createElement("div",{id:"caja5",className:"collapse","aria-labelledby":"headingThree","data-parent":"#accordionExample"},i.a.createElement("div",{className:"card-body"},i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-md-6"},"Capacidad visual")),i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-3"},i.a.createElement("i",{className:"fa fa-eye"})," ",i.a.createElement("label",null,"Derecho"),i.a.createElement("input",{type:"text",name:"cvod",maxLength:"12",className:"form-control",value:this.props.cvod,onChange:this.catchInputs})),i.a.createElement("div",{className:"col-3"},i.a.createElement("i",{className:"fa fa-eye"})," ",i.a.createElement("label",null,"Izquierdo"),i.a.createElement("input",{type:"text",name:"cvoi",maxLength:"12",className:"form-control",value:this.props.cvoi,onChange:this.catchInputs}))),i.a.createElement("div",{className:"row mt-2"},i.a.createElement("div",{className:"col-md-6"},"Agudeza visual (Sin lentes)"),i.a.createElement("div",{className:"col-md-6"},"Agudeza visual (con la graduaci\xf3n anterior)")),i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-3"},i.a.createElement("i",{className:"fa fa-eye"})," ",i.a.createElement("label",null,"Derecho"),i.a.createElement("input",{type:"text",name:"avslod",maxLength:"12",className:"form-control",value:this.props.avslod,onChange:this.catchInputs})),i.a.createElement("div",{className:"col-3"},i.a.createElement("i",{className:"fa fa-eye"})," ",i.a.createElement("label",null,"Izquierdo"),i.a.createElement("input",{type:"text",name:"avsloi",maxLength:"12",className:"form-control",value:this.props.avsloi,onChange:this.catchInputs})),i.a.createElement("div",{className:"col-md-3"},i.a.createElement("i",{className:"fa fa-eye"})," ",i.a.createElement("label",null,"Derecho"),i.a.createElement("input",{type:"text",name:"avcgaod",maxLength:"12",className:"form-control input-xs",value:this.props.avcgaod,onChange:this.catchInputs})),i.a.createElement("div",{className:"col-md-3"},i.a.createElement("i",{className:"fa fa-eye"})," ",i.a.createElement("label",null,"Izquierdo"),i.a.createElement("input",{type:"text",name:"avcgaoi",maxLength:"12",className:"form-control input-xs",value:this.props.avcgaoi,onChange:this.catchInputs}))),i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-md-6"},"Agudeza visual final")),i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-md-3"},i.a.createElement("i",{className:"fa fa-eye"})," ",i.a.createElement("label",null,"Derecho"),i.a.createElement("br",null),i.a.createElement("input",{type:"text",name:"avfod",maxLength:"12",className:"form-control",value:this.props.avfod,onChange:this.catchInputs})),i.a.createElement("div",{className:"col-md-3"},i.a.createElement("i",{className:"fa fa-eye"})," ",i.a.createElement("label",null,"Izquierdo"),i.a.createElement("br",null),i.a.createElement("input",{type:"text",name:"avfoi",maxLength:"12",className:"form-control",value:this.props.avfoi,onChange:this.catchInputs})),i.a.createElement("div",{className:"col-md-4"},i.a.createElement("i",{className:"fa fa-eye"}),i.a.createElement("i",{className:"fa fa-eye"})," ",i.a.createElement("label",null,"Ambos"),i.a.createElement("br",null),i.a.createElement("input",{type:"text",name:"avf2o",maxLength:"25",className:"form-control",value:this.props.avf2o,onChange:this.catchInputs}))))))}}]),t}(c.Component),re=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(){var e;Object(r.a)(this,t);for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return(e=a.call.apply(a,[this].concat(o))).catchInputs=function(a){var t=a.target.name,n="checkbox"===a.target.type?a.target.checked:a.target.value.toLowerCase();e.props.onChangeInput(t,n)},e}return Object(o.a)(t,[{key:"render",value:function(){return i.a.createElement("div",{className:"card"},i.a.createElement("div",{className:"card-header",id:"heading6"},i.a.createElement("h2",{className:"mb-0"},i.a.createElement("button",{className:"btn btn-link btn-block text-left text-info collapsed",type:"button","data-toggle":"collapse","data-target":"#caja6","aria-expanded":"false","aria-controls":"caja6"},"Diagnostico"))),i.a.createElement("div",{id:"caja6",className:"collapse","aria-labelledby":"headingThree","data-parent":"#accordionExample"},i.a.createElement("div",{className:"card-body"},i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-md-6"}),i.a.createElement("div",{className:"col-md-6"},"Tensi\xf3n ocular")),i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-md-3"},"Diagnostico",i.a.createElement("select",{name:"diagnostico",className:"form-control",value:this.props.diagnostico,onChange:this.catchInputs},i.a.createElement("option",{value:"Emetrope"},"Em\xe9trope"),i.a.createElement("option",{value:"hipermetropia"},"Hipermetrop\xeda"),i.a.createElement("option",{value:"hipermetropia-astigmatismo"},"Hipermetrop\xeda y astigmatismo"),i.a.createElement("option",{value:"hipermetropia-miopia"},"Hipermetrop\xeda y miop\xeda"),i.a.createElement("option",{value:"astigmatismo-regla"},"Astigmatismo con la regla"),i.a.createElement("option",{value:"astigmatismo-contra-regla"},"Astigmatismo contra la regla"),i.a.createElement("option",{value:"astigmatismo-oblicuo"},"Astigmatismo oblicuo"),i.a.createElement("option",{value:"astigmatismo-miopia"},"Astigmatismo/m\xedopico"),i.a.createElement("option",{value:"miopia"},"Miop\xeda"))),i.a.createElement("div",{className:"col-md-3"},i.a.createElement("div",{className:"custom-control custom-switch"},i.a.createElement("input",{name:"presbicie",type:"checkbox",className:"custom-control-input",id:"presbicie",checked:this.props.presbicie,onChange:this.catchInputs}),i.a.createElement("label",{className:"custom-control-label",htmlFor:"presbicie"},"Presbicie"))),i.a.createElement("div",{className:"col-md-3"},i.a.createElement("i",{className:"fa fa-eye"})," ",i.a.createElement("label",null,"Derecho"),i.a.createElement("input",{type:"number",name:"piod",min:"0",max:"40",step:"1",className:"form-control",value:this.props.piod,onChange:this.catchInputs})),i.a.createElement("div",{className:"col-md-3"},i.a.createElement("i",{className:"fa fa-eye"})," ",i.a.createElement("label",null,"Izquierdo"),i.a.createElement("input",{type:"number",name:"pioi",min:"0",max:"40",step:"1",className:"form-control",value:this.props.pioi,onChange:this.catchInputs}))),i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-12"},i.a.createElement("label",null,"Tratamiento oftalmico"),i.a.createElement("textarea",{name:"txoftalmico",className:"form-control",value:this.props.txoftalmico,onChange:this.catchInputs}))))))}}]),t}(c.Component),oe=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(){var e;Object(r.a)(this,t);for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return(e=a.call.apply(a,[this].concat(o))).catchInputs=function(a){var t=a.target.name,n="checkbox"===a.target.type?a.target.checked:a.target.value.toLowerCase();e.props.onChangeInput(t,n)},e}return Object(o.a)(t,[{key:"render",value:function(){return i.a.createElement("div",{className:"card"},i.a.createElement("div",{className:"card-header",id:"heading8"},i.a.createElement("h2",{className:"mb-0"},i.a.createElement("button",{className:"btn btn-link btn-block text-left text-info collapsed",type:"button","data-toggle":"collapse","data-target":"#caja8","aria-expanded":"false","aria-controls":"caja8"},"Observaciones"))),i.a.createElement("div",{id:"caja8",className:"collapse","aria-labelledby":"headingThree","data-parent":"#accordionExample"},i.a.createElement("div",{className:"card-body"},i.a.createElement("textarea",{name:"observaciones",className:"form-control",value:this.props.observaciones,onChange:this.catchInputs}))))}}]),t}(c.Component),le=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(e){var o;return Object(r.a)(this,t),(o=a.call(this,e)).handleMessege=function(e){var a=e.target,t=a.value,r=a.name;o.setState(Object(n.a)({},r,t.toLowerCase()))},o.sendMessenger=function(){var e=o.state,a=e.message,t=e.load,n=e.host,r=e.token,l=o.props,s="http://"+n+"/api/messengers",c={table:l.table,idRow:l.idRow,user:"",message:a};t||o.setState({load:!0}),console.log("Enviando mensajes a la API"),fetch(s,{method:"POST",body:JSON.stringify(c),headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+r}}).then((function(e){return e.ok||window.alert("Ups!\n Algo salio mal, intentelo mas tarde."),e.json()})).then((function(e){e.data?(console.log("Almacenado mensajes"),o.getMessengers()):(console.error(e.message),o.setState({load:!1}))})).catch((function(e){console.error(e),window.alert("Ups!\n Algo salio mal, intentelo mas tarde."),o.setState({load:!1})}))},o.getMessengers=function(){var e=o.state,a=e.load,t=e.host,n=e.token,r=o.props,l="http://"+t+"/api/messengers",s="&table="+r.table+"&idRow="+r.idRow;a||o.setState({load:!0}),console.log("Solicitando mensajes de la API"),fetch(l+"?page=1"+s,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+n}}).then((function(e){return e.ok||window.alert("Ups!\n Algo salio mal, intentelo mas tarde."),e.json()})).then((function(e){e.data?(console.log("Almacenado mensajes"),o.setState({messages:e.data,message:"",load:!1})):(console.error(e.message),o.setState({load:!1}))})).catch((function(e){console.error(e),window.alert("Ups!\n Algo salio mal, intentelo mas tarde."),o.setState({load:!1})}))},o.state={messages:[],message:"",load:!0,host:e.data.host,token:e.data.token},o}return Object(o.a)(t,[{key:"componentDidMount",value:function(){this.getMessengers()}},{key:"componentDidUpdate",value:function(e,a){e.pagado!==this.props.pagado&&(console.log("Recargando chat"),this.getMessengers())}},{key:"render",value:function(){var e=this.props.data,a=this.state,t=a.messages,n=a.load,r=a.message,o=e.idUser;return i.a.createElement("div",{className:"card direct-chat direct-chat-primary"},i.a.createElement("div",{className:"card-header"},i.a.createElement("h3",{className:"card-title"},i.a.createElement("i",{className:"fas fa-comments mr-1"}),"Chat")),n?i.a.createElement("div",{className:"card-body"},i.a.createElement("div",{className:"card-text text-center p-4"},i.a.createElement("div",{className:"spinner-border text-primary",role:"status"},i.a.createElement("span",{className:"sr-only"},"Loading...")))):t.length?i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"card-body"},i.a.createElement("div",{className:"direct-chat-messages",id:"boxchat"},t.map((function(e){var a="/img/avatars/avatar5.png";return 1===e.created_user.rol&&(a="/img/avatars/avatar2.png"),e.created_user.rol||(a="/img/avatars/avatar3.png"),2===e.created_user.id&&(a="/img/avatars/avatar4.png"),i.a.createElement("div",{className:e.created_user.id===o?"direct-chat-msg right":"direct-chat-msg",key:e.id},i.a.createElement("div",{className:"direct-chat-infos clearfix"},i.a.createElement("span",{className:e.created_user.id===o?"direct-chat-name float-right":"direct-chat-name float-left"},e.created_user.name),i.a.createElement("span",{className:e.created_user.id===o?"direct-chat-timestamp float-left":"direct-chat-timestamp float-right"},f()(e.updated_at).format("lll"))),i.a.createElement("img",{className:"direct-chat-img",src:1===e.created_user.id?"/img/avatars/OrusBot.png":a,alt:"message user image1"}),i.a.createElement("div",{className:"direct-chat-text"},e.mensaje))}))))):i.a.createElement("div",{className:"card-body"},i.a.createElement("div",{className:"card-text text-center p-4"},i.a.createElement("h5",null,i.a.createElement("i",{className:"fas fa-comment-slash mr-1"}),"No hay mensajes aun"))),i.a.createElement("div",{className:"card-footer"},i.a.createElement("div",{className:"input-group"},i.a.createElement("input",{type:"text",name:"message",placeholder:"Escriba un mensaje ...",className:"form-control",value:r,onChange:this.handleMessege}),i.a.createElement("span",{className:"input-group-append"},i.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:this.sendMessenger,disabled:!(r.length>5)},"Enviar")))))}}]),t}(c.Component),se=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(e){var o;Object(r.a)(this,t),(o=a.call(this,e)).handleChangeInput=function(e,a){o.setState(Object(n.a)({},e,a))},o.handleStatus=function(){o.setState({status:!o.state.status})},o.getIdContact=function(e,a){o.setState({contact_id:e,edad:a})},o.changePage=function(e){o.props.page(e)},o.catchInputs=function(e){var a=e.target.name,t="checkbox"===e.target.type?e.target.checked:e.target.value.toLowerCase();o.setState(Object(n.a)({},a,t))},o.handleSave=function(e){e.preventDefault();var a=o.state,t=a.host,n=a.token,r=a.id;window.Swal.fire({title:"Almacenamiento",text:r?"\xbfEsta seguro de actualizar el examen?":"\xbfEsta seguro de crear un nuevo examen?",icon:"question",showCancelButton:!0,confirmButtonText:r?"Actualizar":"Crear",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,preConfirm:function(e){if(e){var a=o.state,l=r?"http://"+t+"/api/exams/"+r:"http://"+t+"/api/exams",s=r?"PUT":"POST";return a.category_id||delete a.category_id,a.category_ii||delete a.category_ii,console.log("Enviando datos del examen a la API"),fetch(l,{method:s,signal:o.signal,body:JSON.stringify(a),headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+n}}).then((function(e){if(!e.ok)throw new Error(e.statusText);return e.json()})).catch((function(e){console.error("Orus fetch: ",e),window.Swal.fire("Fallo de conexion","Verifique la conexion al servidor","error")}))}}}).then((function(e){if(e&&!e.dismiss&&e.value){var a=e.value;a.data?(console.log("Examen almacenado"),window.Swal.fire({icon:"success",title:r?"Examen actualizado con exito":"Examen almacenado con exito",showConfirmButton:!1,timer:1500}).then((function(e){return o.props.history.goBack()}))):(window.Swal.fire("Error","al almacenar el examen","error"),console.error("Orus res: ",a.message))}}))},o.getExam=function(e){if(e){var a=o.state,t=a.host,n=a.token;a.load||o.setState({load:!0}),console.log("Descargando datos del examen"),fetch("http://"+t+"/api/exams/"+e,{method:"GET",signal:o.signal,headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+n}}).then((function(e){if(!e.ok)throw new Error(e.statusText);return e.json()})).then((function(e){e.data?(console.log("Mostrando examenes"),o.setState({contact_id:e.data.paciente.id,edad:e.data.edad,id:e.data.id,keratometriaoi:e.data.keratometriaoi,keratometriaod:e.data.keratometriaod,pantalleooi:e.data.pantalleooi,pantalleood:e.data.pantalleood,interrogatorio:e.data.interrogatorio,cefalea:e.data.cefalea,c_frecuencia:e.data.c_frecuencia,c_intensidad:e.data.c_intensidad,frontal:e.data.frontal,temporal:e.data.temporal,occipital:e.data.occipital,generality:e.data.generality,temporaoi:e.data.temporaoi,temporaod:e.data.temporaod,coa:e.data.coa,aopp:e.data.aopp,aopf:e.data.aopf,avsloi:e.data.avsloi,avslod:e.data.avslod,avcgaoi:e.data.avcgaoi,avcgaod:e.data.avcgaod,cvoi:e.data.cvoi,cvod:e.data.cvod,oftalmoscopia:e.data.oftalmoscopia,rsoi:e.data.rsoi,rsod:e.data.rsod,diagnostico:e.data.diagnostico,presbicie:e.data.presbicie,txoftalmico:e.data.txoftalmico,esferaoi:e.data.esferaoi,esferaod:e.data.esferaod,cilindroi:e.data.cilindroi,cilindrod:e.data.cilindrod,ejeoi:e.data.ejeoi,ejeod:e.data.ejeod,adicioni:e.data.adicioni,adiciond:e.data.adiciond,dpoi:e.data.dpoi,dpod:e.data.dpod,avfoi:e.data.avfoi,avfod:e.data.avfod,avf2o:e.data.avf2o,lcmarca:e.data.lcmarca,lcgoi:e.data.lcgoi,lcgod:e.data.lcgod,txoptico:e.data.txoptico,alturaoi:e.data.alturaoi,alturaod:e.data.alturaod,pioi:e.data.pioi,piod:e.data.piod,observaciones:e.data.observaciones,pc:e.data.pc,tablet:e.data.tablet,movil:e.data.movil,lap:e.data.lap,lap_time:e.data.lap_time,pc_time:e.data.pc_time,tablet_time:e.data.tablet_time,movil_time:e.data.movil_time,d_time:e.data.d_time,d_media:e.data.d_media,d_test:e.data.d_test,d_fclod:e.data.d_fclod,d_fcloi:e.data.d_fcloi,d_fclod_time:e.data.d_fclod_time,d_fcloi_time:e.data.d_fcloi_time,category_id:e.data.category_id,category_ii:e.data.category_ii,order_id:e.data.order_id?e.data.order_id:0,status:e.data.estado,created_at:e.data.created_at})):(console.error("Orus: ",e.message),window.Swal.fire("Error","Al descargar el examen","error"),o.setState({load:!1}))})).catch((function(e){console.error(e),window.Swal.fire("Fallo de conexion","Verifique la conexion al servidor","error"),o.setState({load:!1})}))}};var l=JSON.parse(localStorage.getItem("OrusContactInUse"));return o.state={id:0,edad:0,keratometriaoi:"",keratometriaod:"",pantalleooi:"",pantalleood:"",interrogatorio:"",cefalea:!1,c_frecuencia:"",c_intensidad:0,frontal:!1,temporal:!1,occipital:!1,generality:!1,temporaoi:!1,temporaod:!1,coa:"",aopp:"",aopf:"",avsloi:"",avslod:"",avcgaoi:"",avcgaod:"",cvoi:"",cvod:"",oftalmoscopia:"",rsoi:"",rsod:"",diagnostico:"Hemetrope",presbicie:!0,txoftalmico:"",esferaoi:0,esferaod:0,cilindroi:0,cilindrod:0,ejeoi:0,ejeod:0,adicioni:0,adiciond:0,dpoi:0,dpod:0,avfoi:"",avfod:"",avf2o:"",lcmarca:"",lcgoi:"",lcgod:"",txoptico:"",alturaoi:0,alturaod:0,pioi:0,piod:0,observaciones:"",pc:!1,tablet:!1,movil:!1,lap:!1,lap_time:"00:00",pc_time:"00:00",tablet_time:"00:00",movil_time:"00:00",d_time:"00:00",d_media:"",d_test:"",d_fclod:!1,d_fcloi:!1,d_fclod_time:"00:00",d_fcloi_time:"00:00",category_id:0,category_ii:0,contact_id:l&&l.id?l.id:0,order_id:0,status:0,created_at:"",load:!1,host:e.data.host,token:e.data.token},o.controller=new AbortController,o.signal=o.controller.signal,o}return Object(o.a)(t,[{key:"componentWillUnmount",value:function(){this.controller.abort()}},{key:"componentDidMount",value:function(){var e=this.props.match.params.id;e&&this.getExam(e)}},{key:"render",value:function(){var e=this,a=this.state,t=a.contact_id,n=a.id,r=a.order_id,o=a.edad,l=a.status,s=a.created_at,c=a.category_id,m=a.category_ii,u=this.props.data,p=f()(Date.now()),h=f()(s),g=f()(p).isSame(h,"day");return i.a.createElement("form",{className:"row"},i.a.createElement("div",{className:"col-3"},i.a.createElement(X,{contact:t,edad:o,status:!(!l&&!n)&&!g,getIdContact:this.getIdContact,changePage:this.changePage}),t?i.a.createElement(i.a.Fragment,null,i.a.createElement(U,{category_id:c,nameCategory:"category_id",title:"Recomendacion principal",data:u,onChangeInput:this.handleChangeInput,update:!0}),c?i.a.createElement(U,{category_id:m,nameCategory:"category_ii",title:"Recomendacion adicional",data:u,onChangeInput:this.handleChangeInput,update:!0}):null):null),i.a.createElement("div",{className:"col"},i.a.createElement("div",{className:"card card-info card-outline"},i.a.createElement("div",{className:"card-header"},i.a.createElement("h3",{className:"card-title"},i.a.createElement("i",{className:"fas fa-notes-medical mr-1"}),this.state.id?"Examen":"Nuevo examen")),i.a.createElement("div",{className:"card-body"},i.a.createElement("div",{className:"accordion",id:"accordionExample"},t?i.a.createElement(i.a.Fragment,null,i.a.createElement(Q,{pc:this.state.pc,tablet:this.state.tablet,movil:this.state.movil,lap:this.state.lap,lap_time:this.state.lap_time,pc_time:this.state.pc_time,tablet_time:this.state.tablet_time,movil_time:this.state.movil_time,cefalea:this.state.cefalea,c_frecuencia:this.state.c_frecuencia,c_intensidad:this.state.c_intensidad,frontal:this.state.frontal,temporal:this.state.temporal,occipital:this.state.occipital,generality:this.state.generality,temporaoi:this.state.temporaoi,temporaod:this.state.temporaod,onChangeInput:this.handleChangeInput}),i.a.createElement(ee,{interrogatorio:this.state.interrogatorio,coa:this.state.coa,aopp:this.state.aopp,aopf:this.state.aopf,onChangeInput:this.handleChangeInput}),i.a.createElement(ae,{keratometriaoi:this.state.keratometriaoi,keratometriaod:this.state.keratometriaod,rsoi:this.state.rsoi,rsod:this.state.rsod,onChangeInput:this.handleChangeInput}),i.a.createElement(te,{d_time:this.state.d_time,d_media:this.state.d_media,d_test:this.state.d_test,d_fclod:this.state.d_fclod,d_fclod_time:this.state.d_fclod_time,d_fcloi:this.state.d_fcloi,d_fcloi_time:this.state.d_fcloi_time,oftalmoscopia:this.state.oftalmoscopia,onChangeInput:this.handleChangeInput}),i.a.createElement(ne,{cvod:this.state.cvod,cvoi:this.state.cvoi,avslod:this.state.avslod,avsloi:this.state.avsloi,avcgaod:this.state.avcgaod,avcgaoi:this.state.avcgaoi,avfod:this.state.avfod,avfoi:this.state.avfoi,avf2o:this.state.avf2o,onChangeInput:this.handleChangeInput}),i.a.createElement(re,{diagnostico:this.state.diagnostico,presbicie:this.state.presbicie,piod:this.state.piod,pioi:this.state.pioi,txoftalmico:this.state.txoftalmico,onChangeInput:this.handleChangeInput}),i.a.createElement("div",{className:"card"},i.a.createElement("div",{className:"card-header",id:"heading7"},i.a.createElement("h2",{className:"mb-0"},i.a.createElement("button",{className:"btn btn-link btn-block text-left text-info collapsed",type:"button","data-toggle":"collapse","data-target":"#caja7","aria-expanded":"false","aria-controls":"caja7"},"Graduaci\xf3n"))),i.a.createElement("div",{id:"caja7",className:"collapse","aria-labelledby":"headingThree","data-parent":"#accordionExample"},i.a.createElement("div",{className:"card-body"},i.a.createElement(z,{esferaod:this.state.esferaod,esferaoi:this.state.esferaoi,cilindrod:this.state.cilindrod,cilindroi:this.state.cilindroi,ejeod:this.state.ejeod,ejeoi:this.state.ejeoi,adiciond:this.state.adiciond,adicioni:this.state.adicioni,dpod:this.state.dpod,dpoi:this.state.dpoi,alturaod:this.state.alturaod,alturaoi:this.state.alturaoi,lcmarca:this.state.lcmarca,lcgod:this.state.lcgod,lcgoi:this.state.lcgoi,onChangeInput:this.handleChangeInput})))),i.a.createElement(oe,{observaciones:this.state.observaciones,onChangeInput:this.handleChangeInput})):i.a.createElement("div",{className:"card"},i.a.createElement("div",{className:"card-body text-info"},i.a.createElement("i",{className:"fas fa-exclamation-triangle mr-2"}),i.a.createElement("label",null,"Elija primero un paciente"))))),i.a.createElement("div",{className:"card-footer text-right"},i.a.createElement("div",{className:"btn-group",role:"group"},i.a.createElement(d.b,{to:"/consultorio",className:"btn btn-dark",onClick:function(a){e.changePage("/consultorio")}},i.a.createElement("i",{className:n?"fas fa-arrow-left mr-2":"fas fa-ban mr-2"}),i.a.createElement("strong",null,n?"Regresar":"Cancelar")),i.a.createElement("button",{type:"button",className:"btn btn-dark",onClick:this.handleStatus},i.a.createElement("i",{className:this.state.status?"fas fa-lock-open mr-1":"fas fa-lock mr-1"}),i.a.createElement("strong",null,this.state.status?"Activar":"Terminar")),i.a.createElement("button",{type:"button",className:t?"btn btn-info":"btn btn-info disabled",onClick:this.handleSave,disabled:t?"":"disabled"},i.a.createElement("i",{className:"fas fa-save mr-1"}),i.a.createElement("strong",null,"Guardar")))))),t&&r?i.a.createElement("div",{className:"col-3"},i.a.createElement(le,{data:u,table:"orders",idRow:r})):null)}}]),t}(c.Component),ce=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(){var e;Object(r.a)(this,t);for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return(e=a.call.apply(a,[this].concat(o))).onKeyPressSearch=function(a){"Enter"===a.key&&(a.preventDefault(),e.setFilters())},e.onClickClean=function(){e.props.changeFilters("search",""),e.props.changeFilters("status",""),e.setFilters()},e.setFilters=function(){e.props.handleChangePage(1),window.$("#filters").modal("hide")},e.changeFilters=function(a){var t=a.target,n=t.name,r=t.value;e.props.changeFilters(n,r)},e}return Object(o.a)(t,[{key:"render",value:function(){var e=this.props,a=e.search,t=e.status;return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"btn-group"},i.a.createElement("a",{href:"#Filters",className:"btn btn-tool text-dark","data-toggle":"modal","data-target":"#filters"},i.a.createElement("i",{className:"fas fa-filter"}))),i.a.createElement("div",{className:"modal",tabIndex:"-1",role:"dialog",id:"filters"},i.a.createElement("div",{className:"modal-dialog"},i.a.createElement("div",{className:"modal-content"},i.a.createElement("div",{className:"modal-header"},i.a.createElement("h5",{className:"modal-title"},"Busquedas"),i.a.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-label":"Close"},i.a.createElement("span",{"aria-hidden":"true"},"\xd7"))),i.a.createElement("form",{className:"modal-body"},i.a.createElement("div",{className:"input-group mb-3"},i.a.createElement("div",{className:"input-group-prepend"},i.a.createElement("span",{className:"input-group-text"},i.a.createElement("i",{className:"fas fa-search"}))),i.a.createElement("input",{type:"text",name:"search",className:"form-control",placeholder:"Por: paciente o # de orden",value:a,onChange:this.changeFilters,onKeyPress:this.onKeyPressSearch})),i.a.createElement("div",{className:"input-group mb-3"},i.a.createElement("label",null,"Estado"),i.a.createElement("div",{className:"input-group-prepend ml-4"},i.a.createElement("span",{className:"input-group-text"},i.a.createElement("i",{className:"fas fa-address-book"}))),i.a.createElement("select",{className:"form-control",name:"status",value:t,onChange:this.changeFilters},i.a.createElement("option",{value:""},"Todos"),i.a.createElement("option",{value:"0"},"En proceso"),i.a.createElement("option",{value:"1"},"Laboratorio"),i.a.createElement("option",{value:"2"},"Bicelaci\xf3n"),i.a.createElement("option",{value:"3"},"Terminado"),i.a.createElement("option",{value:"4"},"Garantia"),i.a.createElement("option",{value:"5"},"Baja")))),i.a.createElement("div",{className:"modal-footer"},i.a.createElement("div",{className:"btn-group btn-group-lg",role:"group"},i.a.createElement("button",{type:"button",className:"btn btn-outline-dark","data-dismiss":"modal"},i.a.createElement("i",{className:"fas fa-window-close mr-2"}),"Cancelar"),i.a.createElement("button",{type:"button",className:a?"btn btn-outline-dark":"btn btn-outline-dark disabled",onClick:this.onClickClean},i.a.createElement("i",{className:"fas fa-eraser mr-2"}),"Limpiar"),i.a.createElement("button",{type:"button",className:"btn btn-outline-dark",onClick:this.setFilters,"data-dismiss":"modal"},i.a.createElement("i",{className:"fas fa-search mr-2"}),"Buscar")))))))}}]),t}(c.Component),ie=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(e){var o;Object(r.a)(this,t),(o=a.call(this,e)).setStatusString=function(e){switch(e){case 0:return i.a.createElement("span",{className:"text-warning text-uppercase"},"En proceso");case 1:return i.a.createElement("span",{className:"text-info text-uppercase"},"En laboratorio");case 2:return i.a.createElement("span",{className:"text-primary text-uppercase"},"Bicelaci\xf3n");case 3:return i.a.createElement("span",{className:"text-success text-uppercase"},"Terminado");case 4:return i.a.createElement("span",{className:"text-info text-uppercase"},"Garantia");default:return i.a.createElement("span",{className:"text-secondary text-uppercase"},"Baja")}},o.handleFilter=function(){o.setState({load:!0,page:1})},o.onchangeSearch=function(e,a){o.setState(Object(n.a)({},e,a))},o.handleOrder=function(e){o.setState({orderby:e,order:"desc"===o.state.order?"asc":"desc",load:!0})},o.handleChangePage=function(e){o.setState({page:e,load:!0})},o.changePage=function(e){o.props.page(e)},o.handleDelete=function(e,a){window.Swal.fire({title:"Eliminar",text:"\xbfEsta seguro de eliminar el pedido de "+a.toUpperCase()+"?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Eliminar",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,preConfirm:function(a){if(a){var t=o.state,n=t.host,r=t.token;return console.log("Solicitud de eliminaci\xf3n de order por API"),fetch("http://"+n+"/api/orders/"+e,{method:"DELETE",signal:o.signal,headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+r}}).then(function(){var e=Object(y.a)(N.a.mark((function e(a){var t;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t={},204===a.status){e.next=5;break}return e.next=4,a.json();case 4:t=e.sent;case 5:if(a.ok){e.next=7;break}throw new Error(t.message);case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}()).catch((function(e){console.error("Orus fetch",e),window.Swal.fire("Fallo de conexion","Verifique la conexion al servidor","error")}))}}}).then((function(e){e&&!e.dismiss&&e.value?(console.log("Pedido eliminado"),window.Swal.fire({icon:"success",title:"Pedido eliminado con exito",showConfirmButton:!1,timer:1500}).then((function(e){return o.getPedidos()}))):e&&!e.dismiss&&(console.log("Orus res: ",e),window.Swal.fire("Error","Se perdio la conexion con el servidor","error"))}))};var l=JSON.parse(localStorage.getItem("OrusOrder"));return o.state={pedidos:{data:[],meta:{}},load:!0,page:l?l.page:1,orderby:l?l.orderby:"created_at",order:l?l.order:"desc",search:l?l.search:"",status:l?l.status:"",host:e.data.host,token:e.data.token},o.controller=new AbortController,o.signal=o.controller.signal,o}return Object(o.a)(t,[{key:"componentWillUnmount",value:function(){this.controller.abort()}},{key:"componentDidMount",value:function(){this.getPedidos(),localStorage.setItem("OrusContactInUse",JSON.stringify({})),localStorage.setItem("OrusOrder",JSON.stringify({page:this.state.page,orderby:this.state.orderby,order:this.state.order,search:this.state.search,status:this.state.status}))}},{key:"componentDidUpdate",value:function(e,a){!1===a.load&&!0===this.state.load&&(console.log("Recargando pedidos"),this.getPedidos(),localStorage.setItem("OrusOrder",JSON.stringify({page:this.state.page,orderby:this.state.orderby,order:this.state.order,search:this.state.search,status:this.state.status})))}},{key:"render",value:function(){var e=this,a=this.state,t=a.pedidos,n=a.load;return i.a.createElement("div",{className:"card card-warning card-outline"},i.a.createElement("div",{className:"card-header"},i.a.createElement("h3",{className:"card-title text-warning"},i.a.createElement("i",{className:"fas fa-clipboard-list mr-1"}),"Listado de pedidos"),i.a.createElement("div",{className:"card-tools"},i.a.createElement(ce,{search:this.state.search,status:this.state.status,changeFilters:this.onchangeSearch,handleChangePage:this.handleChangePage}),i.a.createElement(x,{meta:t.meta,handleChangePage:this.handleChangePage}))),i.a.createElement("div",{className:"card-body table-responsive p-0"},i.a.createElement("table",{className:"table table-bordered table-hover table-nowrap"},i.a.createElement(w,{orderby:this.state.orderby,order:this.state.order,data:[{name:"Folio",type:"id",filter:!0},{name:"Caja"},{name:"Paciente",type:"contact_id",filter:!0},{name:"Detalles"},{name:"Estado"},{name:"Nota"},{name:"Actualizado",type:"updated_at",filter:!0},{name:"Registrado",type:"created_at",filter:!0}],actions:!0,handleOrder:this.handleOrder}),i.a.createElement("tbody",null,n?i.a.createElement("tr",null,i.a.createElement("td",{colSpan:"10",className:"text-center"},i.a.createElement("div",{className:"spinner-border text-primary",role:"status"},i.a.createElement("span",{className:"sr-only"},"Loading...")))):Object.keys(t.data).length?t.data.map((function(a){return i.a.createElement("tr",{key:a.id},i.a.createElement("td",null,i.a.createElement("span",{className:"badge badge-warning text-capitalize"},a.id)),i.a.createElement("td",{className:"text-uppercase"},2===a.estado?i.a.createElement("span",null,a.caja?a.caja:"Sin asignar"):"--"),i.a.createElement("td",null,i.a.createElement(d.b,{to:"/pedidos/registro/"+a.id},i.a.createElement("span",{className:"badge badge-danger text-capitalize p-1"},a.paciente.nombre,i.a.createElement("i",{className:"fas fa-pencil-alt ml-1"})))),i.a.createElement("td",{className:"text-uppercase"},1===a.estado?i.a.createElement("div",null,i.a.createElement("span",{className:"text-danger mr-1"},a.laboratorio?a.laboratorio.nombre:"Sin asignar"),a.laboratorio?"/ "+a.folio_lab:""):2===a.estado?i.a.createElement("small",null,a.observaciones?a.observaciones:"sin observaciones"):a.estado?"--":i.a.createElement("small",null,a.examen?"Terminado"===a.examen.estado?"Examen completado":"Examen no realizado":"Examen no asignado")),i.a.createElement("td",null,e.setStatusString(a.estado)),i.a.createElement("td",{className:"text-right"},a.nota?i.a.createElement(d.b,{to:"/notas/registro/"+a.nota.id},i.a.createElement("span",{className:"badge badge-success"},a.nota.id)):"--"),i.a.createElement("td",null,f()(a.updated_at).fromNow()),i.a.createElement("td",null,f()(a.created_at).format("ll")),i.a.createElement(k,{id:a.id,item:a.paciente.nombre,delete:a.estado||a.nota?null:e.handleDelete,edit:"/pedidos/registro/"}))})):i.a.createElement("tr",null,i.a.createElement("th",{colSpan:"10",className:"text-center"},"No hay datos para mostrar"))))),i.a.createElement("div",{className:"card-footer text-right"},i.a.createElement(d.b,{to:"/pedidos/registro",className:"btn btn-outline-warning",onClick:function(a){e.changePage("/pedidos/registro")}},i.a.createElement("i",{className:"fas fa-plus mr-2"}),i.a.createElement("strong",null,"Nuevo pedido"))))}},{key:"getPedidos",value:function(){var e=this,a=this.state,t=a.search,n=a.status,r=a.page,o=a.order,l=a.orderby,s=a.host,c=a.token,i=a.load,m="http://"+s+"/api/orders",d="&orderby=".concat(l,"&order=").concat(o),u=t?"&search=".concat(t):"",p=n?"&status="+n:"",h=r>0?"?page="+r:"?page=1";i||this.setState({load:!0}),console.log("Descargando ventas de API"),fetch(m+h+d+u+p,{method:"GET",signal:this.signal,headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+c}}).then((function(e){if(!e.ok)throw new Error(e.statusText);return e.json()})).then((function(a){a.data?(console.log("Mostrando lista de pedidos"),e.setState({pedidos:a,load:!1})):(console.error("Orus: ",a.message),window.Swal.fire("Error","Al descargar pedidos","error"),e.setState({load:!1}))})).catch((function(a){console.error("Orus: "+a),window.Swal.fire("Fallo de conexion","Verifique la conexion al servidor","error"),e.setState({load:!1})}))}}]),t}(c.Component),me=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(e){var o;return Object(r.a)(this,t),(o=a.call(this,e)).handelClickItemDb=function(e,a,t,n){e&&o.setState({id:0,store_items_id:e,producto:a,precio:t,subtotal:o.state.cantidad*t,inStorage:n>=o.state.cantidad?1:0,out:n,itemsDb:[]})},o.deleteItem=function(e){var a=o.props.items;a.splice(e,1),o.props.ChangeInput("items",a)},o.catchInputs=function(e){var a,t=e.target,r=t.name,l=t.value,s=t.type,c=0;("cantidad"===r?(l*=1,c=o.state.precio*l):"precio"===r?(l*=1,c=o.state.cantidad*l):"descripcion"===r&&(c=o.state.subtotal),"number"===s&&(l*=1),"producto"===r&&l.length>3&&!o.state.store_items_id)&&(o.state.load||o.setState({load:!0}),o.timeSave&&clearTimeout(o.timeSave),o.timeSave=setTimeout((function(){var e=JSON.parse(localStorage.getItem("OrusSystem")),a="http://"+e.host+"/api/store",t="?search="+l;console.log("Descargando datos del item"),fetch(a+t+"&npages=6",{method:"GET",headers:{Accept:"application/json",Authorization:"Bearer "+e.token}}).then((function(e){if(!e.ok)throw new Error(e.statusText);return e.json()})).then((function(e){console.log("DAta finish",e),e.data&&e.data.length?(console.log("Almacenando datos del item del DB"),o.setState({itemsDb:e.data})):e.message&&console.log("No hay articulos en la buscada de items",e.message),o.setState({load:!1})})).catch((function(e){console.error(e),window.Swal.fire("Fallo de conexion","Verifique la conexion al servidor","error"),o.setState({load:!1})}))}),1500));o.setState((a={},Object(n.a)(a,r,l),Object(n.a)(a,"subtotal",c),a))},o.addItem=function(e){e.preventDefault();var a=o.props.items,t=o.state;t.inStorage=t.out>=t.cantidad?1:0,t.out=t.out>=t.cantidad?0:t.cantidad-t.out,t.producto=t.descripcion?t.producto+"  ("+t.descripcion+")":t.producto,delete t.itemNew,delete t.itemsDb,delete t.items,a.push(t),o.setState({id:0,store_items_id:0,cantidad:1,producto:"",precio:0,total:0,inStorage:0,out:0,itemNew:!1}),o.props.ChangeInput("items",a)},o.handleNewItem=function(e){e.preventDefault(),o.setState({itemNew:!o.state.itemNew,store_items_id:0,cantidad:1,producto:"",precio:0,subtotal:0,inStorage:0,out:0,itemsDb:[]})},o.state={id:0,store_items_id:0,session:"",cantidad:1,precio:0,subtotal:0,inStorage:0,producto:"",out:0,descripcion:"",itemNew:!1,itemsDb:[],load:!1},o.total=0,o}return Object(o.a)(t,[{key:"componentDidMount",value:function(){this.setState({session:this.props.session})}},{key:"componentDidUpdate",value:function(e,a){this.state.itemNew&&0===this.state.producto.length&&this.inputItem.focus()}},{key:"render",value:function(){var e=this,a=this.state,t=a.itemNew,n=a.itemsDb,r=a.load,o=this.props.items;return this.total=0,i.a.createElement("table",{className:"table table-sm table-striped  mt-2"},i.a.createElement("thead",null,i.a.createElement("tr",null,i.a.createElement("th",{scope:"col",style:{width:64}},"Cantidad"),i.a.createElement("th",{scope:"col"},"Descripcion"),i.a.createElement("th",{scope:"col",className:"text-center",style:{width:120}},"Precio"),i.a.createElement("th",{scope:"col",className:"text-center",style:{width:120}},"Subtotal"),i.a.createElement("th",{scope:"col",style:{width:60}}))),i.a.createElement("tbody",null,t?i.a.createElement(i.a.Fragment,null,i.a.createElement("tr",null,i.a.createElement("td",null,i.a.createElement("input",{className:this.state.store_items_id?"form-control":"form-control disabled",disabled:!this.state.store_items_id,type:"number",name:"cantidad",ref:function(a){e.inputCant=a},value:this.state.cantidad,onChange:this.catchInputs})),i.a.createElement("td",null,i.a.createElement("input",{className:this.state.store_items_id?"form-control disabled":"form-control",disabled:!!this.state.store_items_id,type:"text",name:"producto",autoComplete:"off",ref:function(a){e.inputItem=a},value:this.state.producto,onChange:this.catchInputs}),this.state.store_items_id?i.a.createElement("input",{className:"form-control",type:"text",name:"descripcion",placeholder:"Detalles",value:this.state.descripcion,onChange:this.catchInputs}):null),i.a.createElement("td",null,i.a.createElement("input",{className:this.state.store_items_id?"form-control":"form-control disabled",disabled:!this.state.store_items_id,type:"number",name:"precio",value:this.state.precio,onChange:this.catchInputs})),i.a.createElement("td",null,i.a.createElement("input",{className:"form-control disabled",type:"number",name:"subtotal",value:this.state.subtotal,readOnly:!0})),i.a.createElement("td",null,i.a.createElement("button",{className:"btn btn-outline-dark btn-sm",onClick:this.addItem},i.a.createElement("i",{className:"fas fa-plus"})))),r?i.a.createElement("tr",null,i.a.createElement("td",{colSpan:"5"},i.a.createElement("div",{className:"text-center"},i.a.createElement("div",{className:"spinner-border text-primary",role:"status"},i.a.createElement("span",{className:"sr-only"},"Loading..."))))):n.length?i.a.createElement("tr",null,i.a.createElement("td",{colSpan:"5"},i.a.createElement("div",{className:"list-group"},n.map((function(a){return i.a.createElement("a",{className:"list-group-item list-group-item-action",href:"#"+a.codigo,key:a.id,onClick:function(t){t.preventDefault(),e.handelClickItemDb(a.id,a.producto,a.precio,a.cantidades)}},i.a.createElement("span",{className:"text-primary"},"(",a.codigo,")")," ",a.producto," ",a.marca?i.a.createElement("span",{className:"text-muted"},"/ ",a.marca):null)}))))):null):null,o.length?o.map((function(a,t){return e.total+=1*a.subtotal,i.a.createElement("tr",{key:t},i.a.createElement("td",{className:"text-right"},a.cantidad),i.a.createElement("td",null,i.a.createElement("span",{className:a.inStorage?"badge badge-primary":"badge badge-warning"},a.producto,a.descripcion?" ("+a.descripcion+")":null)),i.a.createElement("td",{className:"text-right"},"$ ",a.precio.toFixed(2)),i.a.createElement("td",{className:"text-right"},"$ ",a.subtotal.toFixed(2)),i.a.createElement("td",{className:"d-print-none"},i.a.createElement("button",{className:e.props.status?"btn btn-outline-light btn-sm disabled":"btn btn-outline-light btn-sm",disabled:!!e.props.status,onClick:function(a){e.props.status||e.deleteItem(t)}},i.a.createElement("i",{className:"fas fa-trash"}))))})):i.a.createElement("tr",null,i.a.createElement("td",{className:"text-center",colSpan:"5"},"No hay articulos cargados"))),i.a.createElement("tfoot",null,i.a.createElement("tr",null,i.a.createElement("td",{className:"text-right",colSpan:"2"},this.props.status?"":i.a.createElement("button",{className:this.props.status?"btn btn-outline-success btn-sm disabled":"btn btn-outline-success btn-sm",disabled:!!this.props.status,onClick:this.handleNewItem},i.a.createElement("i",{className:t?"fas fa-times-circle":"fas fa-plus"}))),i.a.createElement("th",{scope:"row",className:"text-right"},"Subtotal"),i.a.createElement("td",{className:"text-right"},"$ ",this.total.toFixed(2)),i.a.createElement("td",null))))}}]),t}(c.Component),de=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(e){var n;return Object(r.a)(this,t),(n=a.call(this,e)).changeInput=function(e){e.preventDefault();var a=e.target,t=a.name,r=a.value;n.props.ChangeInput(t,r)},n.getContacts=function(){var e=JSON.parse(localStorage.getItem("OrusSystem")),a="http://"+e.host+"/api/contacts";console.log("Descargando proveedores de la API"),fetch(a+"?page=1&type=1&business=1",{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+e.token}}).then((function(e){return e.ok||window.alert("Ups!\n Algo salio mal, intentelo mas tarde."),e.json()})).then((function(e){e.data&&(console.log("Almacenado proveedores"),n.setState({supplies:e.data}))}))},n.state={supplies:[]},n}return Object(o.a)(t,[{key:"componentDidMount",value:function(){this.getContacts()}},{key:"render",value:function(){return i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col"},i.a.createElement("div",{className:"border border-warning rounded p-2"},i.a.createElement("label",null,"Laboratorio"),i.a.createElement("select",{className:this.props.status>1?"form-control disabled":"form-control",disabled:this.props.status>1,name:"lab_id",value:this.props.lab_id,onChange:this.changeInput},i.a.createElement("option",{value:"0"},"Seleccione un proveedor"),this.state.supplies.length?this.state.supplies.map((function(e){return i.a.createElement("option",{key:e.id,value:e.id},e.nombre)})):""))),i.a.createElement("div",{className:"col"},i.a.createElement("div",{className:"border border-warning rounded p-2"},i.a.createElement("label",null,"Folio"),i.a.createElement("input",{type:"text",className:this.props.status>1?"form-control disabled":"form-control",disabled:this.props.status>1,name:"npedidolab",value:this.props.npedidolab,onChange:this.changeInput}))))}}]),t}(c.Component),ue=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(){var e;Object(r.a)(this,t);for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return(e=a.call.apply(a,[this].concat(o))).changeInput=function(a){a.preventDefault();var t=a.target,n=t.name,r=t.value;r*=1,e.props.ChangeInput(n,r)},e}return Object(o.a)(t,[{key:"render",value:function(){return i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col"},i.a.createElement("div",{className:"border border-warning rounded p-2"},i.a.createElement("label",{htmlFor:"lab"},"Estado"),i.a.createElement("select",{className:"form-control",name:"status",value:this.props.status,onChange:this.changeInput},i.a.createElement("option",{value:"0"},"En proceso"),i.a.createElement("option",{value:"1"},"Laboratorio"),i.a.createElement("option",{value:"2"},"Bicelaci\xf3n"),i.a.createElement("option",{value:"3"},"Terminado"),i.a.createElement("option",{value:"4"},"Garantia")))))}}]),t}(c.Component),pe=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(){var e;Object(r.a)(this,t);for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return(e=a.call.apply(a,[this].concat(o))).changeInput=function(a){a.preventDefault();var t=a.target,n=t.name,r=t.value;"caja"===n&&(r*=1),e.props.ChangeInput(n,r)},e}return Object(o.a)(t,[{key:"render",value:function(){return i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col"},i.a.createElement("div",{className:"border border-warning rounded p-2"},i.a.createElement("label",{htmlFor:"lab"},"Caja"),i.a.createElement("input",{type:"text",className:this.props.status>2?"form-control disabled":"form-control",disabled:this.props.status>2,name:"ncaja",value:this.props.ncaja?this.props.ncaja:"",onChange:this.changeInput}))),i.a.createElement("div",{className:"col"},i.a.createElement("div",{className:"border border-warning rounded p-2"},i.a.createElement("label",null,"Observaciones"),i.a.createElement("textarea",{name:"observaciones",className:this.props.status>2?"form-control disabled":"form-control",disabled:this.props.status>2,value:this.props.observaciones?this.props.observaciones:"",onChange:this.changeInput}))))}}]),t}(c.Component),he=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(){var e;Object(r.a)(this,t);for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return(e=a.call.apply(a,[this].concat(o))).changeInput=function(a){a.preventDefault();var t=a.target,n=t.name,r=t.value;r*=1,e.props.ChangeInput(n,r)},e}return Object(o.a)(t,[{key:"render",value:function(){return i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col"},i.a.createElement("div",{className:"border border-warning rounded p-2"},i.a.createElement("label",{htmlFor:"lab"},"Garantia"))))}}]),t}(c.Component),ge=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(e){var o;Object(r.a)(this,t),(o=a.call(this,e)).handleChangeInput=function(e,a){o.setState(Object(n.a)({},e,a))},o.getIdContact=function(e,a){o.setState({contact_id:e,edad:a})},o.changePage=function(e){o.props.page(e)},o.handleSave=function(e){e.preventDefault();var a=o.state.id;window.Swal.fire({title:"Almacenamiento",text:a?"\xbfEsta seguro de actualizar el pedido?":"\xbfEsta seguro de crear un nuevo pedido?",icon:"question",showCancelButton:!0,confirmButtonColor:"#007bff",confirmButtonText:a?"Actualizar":"Crear",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,preConfirm:function(e){if(e){var t=o.state,n=t.host,r=t.token,l=a?"http://"+n+"/api/orders/"+a:"http://"+n+"/api/orders",s=a?"PUT":"POST",c={},i=[];return o.state.items.map((function(e){return i.push({cant:e.cantidad,price:e.precio,subtotal:e.subtotal,inStorage:e.inStorage,session:e.session,out:e.out,descripcion:e.descripcion,store_items_id:e.store_items_id}),!1})),c={session:o.state.session,observaciones:o.state.observaciones,npedidolab:o.state.npedidolab,ncaja:o.state.ncaja,contact_id:o.state.contact_id,status:o.state.status,items:JSON.stringify(i)},o.state.exam_id&&(c.exam_id=o.state.exam_id),o.state.lab_id&&(c.lab_id=o.state.lab_id),console.log("Enviando datos a API para almacenar"),fetch(l,{method:s,body:JSON.stringify(c),headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+r}}).then(function(){var e=Object(y.a)(N.a.mark((function e(a){var t;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t={},204===a.status){e.next=5;break}return e.next=4,a.json();case 4:t=e.sent;case 5:if(a.ok){e.next=7;break}throw new Error(t.message);case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}()).catch((function(e){console.error("Orus fetch",e),window.Swal.fire("Fallo de conexion","Verifique la conexion al servidor","error")}))}}}).then((function(e){if(e&&!e.dismiss&&e.value){var t=e.value;t.data?(console.log("Pedido almacenada"),window.Swal.fire({icon:"success",title:a?"Pedido actualizado con exito":"Pedido almacenado con exito",showConfirmButton:!1,timer:1500}).then((function(e){o.setState({id:t.data.id,nota:t.data.nota.id}),o.props.history.push("/pedidos/registro/".concat(t.data.id))}))):(window.Swal.fire("Error","al almacenar el pedido","error"),console.error("Orus res: ",t.message))}}))},o.getOrder=function(e){if(e>0){var a=o.state,t=a.host,n=a.token;console.log("Solicitando datos de pedido a la API"),fetch("http://"+t+"/api/orders/"+e,{method:"GET",signal:o.signal,headers:{Accept:"application/json",Authorization:"Bearer "+n}}).then((function(e){if(!e.ok)throw new Error(e.statusText);return e.json()})).then((function(a){a.message?(console.error("Orus: ",a.message),window.Swal.fire("Error","Error al descargar los pedidos","error"),o.setState({load:!1})):(console.log("Mostrando datos del pedido"),o.setState({id:e,session:a.data.session,observaciones:a.data.observaciones,lab_id:a.data.laboratorio?a.data.laboratorio.id:0,npedidolab:a.data.folio_lab,ncaja:a.data.caja,items:a.data.productos,contact_id:a.data.paciente.id,status:a.data.estado,usuario:a.data.created,exam_id:null!==a.data.examen?a.data.examen.id:0,exam:null!==a.data.examen?a.data.examen:{},date:a.data.created_at,nota:a.data.nota?a.data.nota.id:0,load:!1}))})).catch((function(e){console.log("Orus:",e),window.Swal.fire("Fallo de conexion","Verifique la conexion al servidor","error"),o.setState({load:!1})}))}else o.setState({load:!1})};var l=JSON.parse(localStorage.getItem("OrusContactInUse"));return o.state={id:0,session:Math.random().toString(36).substring(2,16)+Math.random().toString(36).substring(2,16)+Math.random().toString(36).substring(2,16)+Math.random().toString(36).substring(2,16)+Math.random().toString(36).substring(2,16)+Math.random().toString(36).substring(2,16)+Math.random().toString(10),observaciones:"",lab_id:0,npedidolab:"",ncaja:0,items:[],contact_id:l&&l.id?l.id:0,usuario:"",edad:0,exam_id:0,exam:{},status:0,date:Date.now(),load:!0,nota:0,host:e.data.host,token:e.data.token},o.controller=new AbortController,o.signal=o.controller.signal,o}return Object(o.a)(t,[{key:"componentWillUnmount",value:function(){this.controller.abort()}},{key:"componentDidMount",value:function(){var e=this.props.match.params.id;e?(f.a.locale("es"),this.getOrder(e)):this.setState({load:!1})}},{key:"componentDidUpdate",value:function(e,a){a.load!==this.state.load&&this.state.load}},{key:"render",value:function(){var e=this,a=this.state,t=a.contact_id,n=a.id,r=a.load,o=a.items,l=a.nota,s=a.status,c=a.edad,m=this.props.data,u=!0;return console.log("Estado: ",s),i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-3"},i.a.createElement(X,{contact:t,edad:this.state.edad,status:!!l||s,getIdContact:this.getIdContact,changePage:this.changePage}),t?i.a.createElement("div",{className:"card card-warning card-outline d-print-none mt-4"},i.a.createElement("div",{className:"card-body"},i.a.createElement(ue,{status:s,ChangeInput:this.handleChangeInput}))):null),i.a.createElement("div",{className:"col"},i.a.createElement("div",{className:"card card-warning card-outline"},i.a.createElement("div",{className:"card-body"},t&&!r?i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-2"},i.a.createElement("div",{className:"border border-warning rounded p-2 d-flex justify-content-between align-items-center"},i.a.createElement("span",{className:"badge badge-pill badge-warning mx-2"},"Folio"),i.a.createElement("strong",null,this.state.id?this.state.id:"Nuevo"))),i.a.createElement("div",{className:"col-4"},i.a.createElement("div",{className:"border border-warning rounded p-2 d-flex justify-content-between align-items-center"},i.a.createElement("span",{className:"badge badge-pill badge-warning mx-2"},"Creador"),i.a.createElement("strong",null,this.state.usuario?this.state.usuario:this.props.data.name))),i.a.createElement("div",{className:"col-2"},i.a.createElement("div",{className:"border border-warning rounded p-2 d-flex justify-content-between align-items-center"},i.a.createElement("span",{className:"badge badge-pill badge-success mx-2"},"Nota"),i.a.createElement("strong",null,this.state.nota?i.a.createElement(d.b,{to:"/notas/registro/"+this.state.nota,onClick:function(a){e.changePage("/notas/registro")}},this.state.nota):"--"))),i.a.createElement("div",{className:"col"},i.a.createElement("div",{className:"border border-warning rounded p-2 d-flex justify-content-between align-items-center"},i.a.createElement("span",{className:"badge badge-pill badge-warning mx-2"},"Fecha"),i.a.createElement("strong",null,f()(this.state.date).format("ll"))))),i.a.createElement("ul",{className:"nav nav-tabs mt-4",id:"myTab",role:"tablist"},i.a.createElement("li",{className:"nav-item"},i.a.createElement("a",{className:s&&3!==s||!u?"nav-link":"nav-link active",href:"#pedido","data-toggle":"tab"},"Nota"),u=!(!s||3===s)),i.a.createElement("li",{className:"nav-item"},i.a.createElement("a",{className:"nav-link","data-toggle":"tab",href:"#exam"},"Examen")),i.a.createElement("li",{className:"nav-item"},i.a.createElement("a",{className:1===s&&u?"nav-link active":s?"nav-link":"nav-link disabled","data-toggle":"tab",href:"#lab"},"Laboratorio"),u=1!==s),i.a.createElement("li",{className:"nav-item"},i.a.createElement("a",{className:2===s?"nav-link active":s&&1!==s?"nav-link":"nav-link disabled","data-toggle":"tab",href:"#bicelacion"},"Bicelaci\xf3n"),u=2!==s),i.a.createElement("li",{className:"nav-item"},i.a.createElement("a",{className:4===s?"nav-link active":"nav-link disabled","data-toggle":"tab",href:"#garantia"},"Garantia"),u=4!==s)),i.a.createElement("div",{className:"tab-content",id:"myTabContent"},i.a.createElement("div",{className:s&&3!==s?"tab-pane fade pt-4":"tab-pane fade pt-4 show active",id:"pedido"},i.a.createElement(me,{items:this.state.items,status:s,session:this.state.session,ChangeInput:this.handleChangeInput})),i.a.createElement("div",{className:"tab-pane fade pt-4",id:"exam"},i.a.createElement(M,{paciente:t,edad:c,exam:this.state.exam,page:this.changePage,datos:m,select:!0,status:this.state.status,ChangeInput:this.handleChangeInput})),i.a.createElement("div",{className:1===s?"tab-pane fade pt-4 show active":"tab-pane fade pt-4",id:"lab"},i.a.createElement(de,{lab_id:this.state.lab_id?this.state.lab_id:0,npedidolab:this.state.npedidolab?this.state.npedidolab:"",status:s,ChangeInput:this.handleChangeInput})),i.a.createElement("div",{className:2===s?"tab-pane fade pt-4 show active":"tab-pane fade pt-4",id:"bicelacion"},i.a.createElement(pe,{ncaja:this.state.ncaja,observaciones:this.state.observaciones,status:this.state.status,ChangeInput:this.handleChangeInput})),i.a.createElement("div",{className:4===s?"tab-pane fade pt-4 show active":"tab-pane fade pt-4",id:"garantia"},i.a.createElement(he,{status:s,ChangeInput:this.handleChangeInput})))):this.state.load?i.a.createElement("div",{className:"text-center"},i.a.createElement("div",{className:"spinner-border text-primary",role:"status"},i.a.createElement("span",{className:"sr-only"},"Loading..."))):i.a.createElement("div",{className:"alert alert-light"},i.a.createElement("h4",{className:"alert-heading"},"Nuevo pedido"),i.a.createElement("p",null,i.a.createElement("i",{className:"fas fa-user mr-1"})," Primero seleccione al paciente!"))),i.a.createElement("div",{className:"card-footer d-print-none text-right"},i.a.createElement("div",{className:"btn-group",role:"group"},i.a.createElement(d.b,{to:"/pedidos",className:"btn btn-dark",onClick:function(a){e.changePage("/pedidos")}},i.a.createElement("i",{className:"fas fa-ban mr-1"}),i.a.createElement("strong",null,"Cancelar")),i.a.createElement("button",{className:t&&o.length?"btn btn-warning":"btn btn-warning disabled",onClick:this.handleSave,disabled:!t||!o.length},i.a.createElement("i",{className:"fas fa-save mr-1"}),i.a.createElement("strong",null,"Guardar")))))),t&&n?i.a.createElement("div",{className:"col-3 d-print-none"},i.a.createElement(le,{data:m,table:"orders",idRow:n})):null)}}]),t}(c.Component),fe=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(){var e;Object(r.a)(this,t);for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return(e=a.call.apply(a,[this].concat(o))).onKeyPressSearch=function(a){"Enter"===a.key&&(a.preventDefault(),e.setFilters())},e.onClickClean=function(){e.props.changeFilters("search",""),e.props.changeFilters("type",""),e.props.changeFilters("date",""),e.setFilters()},e.setFilters=function(){e.props.handleChangePage(1),window.$("#filters").modal("hide")},e.changeFilters=function(a){var t=a.target,n=t.name,r=t.value;e.props.changeFilters(n,r)},e}return Object(o.a)(t,[{key:"render",value:function(){var e=this.props,a=e.search,t=e.type,n=e.date;return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"btn-group"},i.a.createElement("a",{href:"#Filters",className:"btn btn-tool text-dark","data-toggle":"modal","data-target":"#filters"},i.a.createElement("i",{className:"fas fa-filter"}))),i.a.createElement("div",{className:"modal",tabIndex:"-1",role:"dialog",id:"filters"},i.a.createElement("div",{className:"modal-dialog"},i.a.createElement("div",{className:"modal-content"},i.a.createElement("div",{className:"modal-header"},i.a.createElement("h5",{className:"modal-title"},"Busquedas"),i.a.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-label":"Close"},i.a.createElement("span",{"aria-hidden":"true"},"\xd7"))),i.a.createElement("form",{className:"modal-body"},i.a.createElement("div",{className:"input-group mb-3"},i.a.createElement("div",{className:"input-group-prepend"},i.a.createElement("span",{className:"input-group-text"},i.a.createElement("i",{className:"fas fa-search"}))),i.a.createElement("input",{type:"text",name:"search",className:"form-control",placeholder:"Por: paciente o # de venta",value:a,onChange:this.changeFilters,onKeyPress:this.onKeyPressSearch})),i.a.createElement("div",{className:"input-group mb-3"},i.a.createElement("label",null,"Estado"),i.a.createElement("div",{className:"input-group-prepend ml-4"},i.a.createElement("span",{className:"input-group-text"},i.a.createElement("i",{className:"fas fa-address-book"}))),i.a.createElement("select",{className:"form-control",name:"type",value:t,onChange:this.changeFilters},i.a.createElement("option",{value:""},"Todos"),i.a.createElement("option",{value:"0"},"Adeudos"),i.a.createElement("option",{value:"1"},"Pagados"))),i.a.createElement("div",{className:"input-group mb-3"},i.a.createElement("label",null,"Fecha"),i.a.createElement("div",{className:"input-group-prepend"},i.a.createElement("span",{className:"input-group-text"},i.a.createElement("i",{className:"fas fa-search"}))),i.a.createElement("input",{type:"date",name:"date",className:"form-control",value:n,onChange:this.changeFilters,onKeyPress:this.onKeyPressSearch}))),i.a.createElement("div",{className:"modal-footer"},i.a.createElement("div",{className:"btn-group btn-group-lg",role:"group"},i.a.createElement("button",{type:"button",className:"btn btn-outline-dark","data-dismiss":"modal"},i.a.createElement("i",{className:"fas fa-window-close mr-2"}),"Cancelar"),i.a.createElement("button",{type:"button",className:a||t?"btn btn-outline-dark":"btn btn-outline-dark disabled",onClick:this.onClickClean},i.a.createElement("i",{className:"fas fa-eraser mr-2"}),"Limpiar"),i.a.createElement("button",{type:"button",className:"btn btn-outline-dark",onClick:this.setFilters,"data-dismiss":"modal"},i.a.createElement("i",{className:"fas fa-search mr-2"}),"Buscar")))))))}}]),t}(c.Component),Ee=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(e){var o;Object(r.a)(this,t),(o=a.call(this,e)).handleFilter=function(){o.setState({load:!0,page:1})},o.onchangeSearch=function(e,a){o.setState(Object(n.a)({},e,a))},o.handleOrder=function(e){o.setState({orderby:e,order:"desc"===o.state.order?"asc":"desc",load:!0})},o.handleChangePage=function(e){o.setState({page:e,load:!0})},o.changePage=function(e){o.props.page(e)},o.handleDelete=function(e,a){window.Swal.fire({title:"Eliminar",text:"\xbfEsta seguro de eliminar la venta de "+a.toUpperCase()+"?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Eliminar",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,preConfirm:function(a){if(a){var t=o.state,n=t.host,r=t.token;return console.log("Solicitud de eliminaci\xf3n de venta por API"),fetch("http://"+n+"/api/sales/"+e,{method:"DELETE",signal:o.signal,headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+r}}).then(function(){var e=Object(y.a)(N.a.mark((function e(a){var t;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t={},204===a.status){e.next=5;break}return e.next=4,a.json();case 4:t=e.sent;case 5:if(a.ok){e.next=7;break}throw new Error(t.message);case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}()).catch((function(e){console.error("Orus fetch",e),window.Swal.fire("Fallo de conexion","Verifique la conexion al servidor","error")}))}}}).then((function(e){e&&!e.dismiss&&e.value?(console.log("Venta eliminada"),window.Swal.fire({icon:"success",title:"Venta eliminada con exito",showConfirmButton:!1,timer:1500}).then((function(e){return o.getPedidos()}))):e&&!e.dismiss&&(console.log("Orus res: ",e),window.Swal.fire("Error","Se perdio la conexion con el servidor","error"))}))},o.getPedidos=function(){var e=o.state,a=e.host,t=e.token,n=e.order,r=e.orderby,l=e.search,s=e.page,c=e.type,i=e.date,m=e.load,d="http://"+a+"/api/sales",u="&orderby=".concat(r,"&order=").concat(n),p=l?"&search=".concat(l):"",h=s>0?"?page="+s:"?page=1",g=""===c?"":"&type="+c,f=""===i?"":"&date="+i;m||o.setState({load:!0}),console.log("Descargando ventas de API"),fetch(d+h+u+p+g+f,{method:"GET",signal:o.signal,headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+t}}).then((function(e){return e.ok||(window.alert("Ups!\n Hubo un error, intentelo mas tarde"),console.log(e)),e.json()})).then((function(e){console.log("Descargando ventas"),o.setState({pedidos:e,load:!1})}))};var l=JSON.parse(localStorage.getItem("OrusSales"));return o.state={pedidos:{data:[],meta:{}},load:!0,page:l?l.page:1,orderby:l?l.orderby:"created_at",order:l?l.order:"desc",search:l?l.search:"",type:l?l.type:"",date:l?l.date:"",host:e.data.host,token:e.data.token},o.controller=new AbortController,o.signal=o.controller.signal,o}return Object(o.a)(t,[{key:"componentWillUnmount",value:function(){this.controller.abort()}},{key:"componentDidMount",value:function(){this.getPedidos(),localStorage.setItem("OrusContactInUse",JSON.stringify({})),localStorage.setItem("OrusSales",JSON.stringify({page:this.state.page,orderby:this.state.orderby,order:this.state.order,search:this.state.search,type:this.state.type,date:this.state.date}))}},{key:"componentDidUpdate",value:function(e,a){!1===a.load&&!0===this.state.load&&(console.log("Recargando pedidos"),this.getPedidos(),localStorage.setItem("OrusSales",JSON.stringify({page:this.state.page,orderby:this.state.orderby,order:this.state.order,search:this.state.search,type:this.state.type,date:this.state.date})))}},{key:"render",value:function(){var e=this,a=this.state,t=a.pedidos,n=a.load,r=a.search,o=a.type,l=a.date;return i.a.createElement("div",{className:"card card-success card-outline"},i.a.createElement("div",{className:"card-header"},i.a.createElement("h3",{className:"card-title text-success"},i.a.createElement("i",{className:"fas fa-cash-register mr-1"}),"Listado de notas"),i.a.createElement("div",{className:"card-tools"},i.a.createElement(fe,{search:r,type:o,date:l,changeFilters:this.onchangeSearch,handleChangePage:this.handleChangePage}),i.a.createElement(x,{meta:t.meta,handleChangePage:this.handleChangePage}))),i.a.createElement("div",{className:"card-body table-responsive p-0"},i.a.createElement("table",{className:"table table-bordered table-hover table-nowrap"},i.a.createElement(w,{orderby:this.state.orderby,order:this.state.order,data:[{name:"Folio",type:"id",filter:!0},{name:"Cliente"},{name:"Sub-total"},{name:"Descuento"},{name:"Total",type:"total",filter:!0},{name:"Abonos"},{name:"Por pagar"},{name:"Actualizado",type:"updated_at",filter:!0},{name:"Registrado",type:"created_at",filter:!0}],actions:!0,handleOrder:this.handleOrder}),i.a.createElement("tbody",null,n?i.a.createElement("tr",null,i.a.createElement("td",{colSpan:"10",className:"text-center p-4"},i.a.createElement("div",{className:"spinner-border text-primary mr-4",role:"status"},i.a.createElement("span",{className:"sr-only"},"Loading...")),i.a.createElement("span",{className:"font-weight-light font-italic"},"Espere cargando datos de la venta"))):Object.keys(t.data).length?t.data.map((function(a){return i.a.createElement("tr",{key:a.id},i.a.createElement("td",null,i.a.createElement("span",{className:"badge badge-success text-capitalize"},a.id)),i.a.createElement("td",{className:"text-uppercase"},i.a.createElement(d.b,{to:"/notas/registro/"+a.id},i.a.createElement("span",{className:"badge badge-danger text-capitalize p-1"},a.cliente.nombre,i.a.createElement("i",{className:"fas fa-pencil-alt ml-1"})))),i.a.createElement("td",{className:"text-right"},"$ ",a.subtotal.toFixed(2)),i.a.createElement("td",{className:"text-right"},"$ ",a.descuento.toFixed(2)),i.a.createElement("td",{className:"text-right"},"$ ",a.total.toFixed(2)),i.a.createElement("td",{className:"text-right"},"$ ",a.pagado.toFixed(2)),i.a.createElement("td",{className:"text-right"},a.total-a.pagado<=0?i.a.createElement("label",{className:"text-success"},i.a.createElement("i",{className:"fas fa-check"})):"$ "+(a.total-a.pagado).toFixed(2)),i.a.createElement("td",null,f()(a.updated_at).fromNow()),i.a.createElement("td",null,f()(a.created_at).format("ll")),i.a.createElement(k,{id:a.id,item:a.cliente.nombre,delete:a.pagado?null:e.handleDelete,edit:"/notas/registro/"}))})):i.a.createElement("tr",null,i.a.createElement("th",{colSpan:"10",className:"text-center"},"No hay datos para mostrar"))))),i.a.createElement("div",{className:"card-footer text-right"},i.a.createElement(d.b,{to:"/notas/registro",className:"btn btn-outline-success",onClick:function(a){e.changePage("/notas/registro")}},i.a.createElement("i",{className:"fas fa-plus mr-2"}),i.a.createElement("strong",null,"Nueva nota"))))}}]),t}(c.Component),ve=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(e){var o;return Object(r.a)(this,t),(o=a.call(this,e)).handlePay=function(e){e.preventDefault(),window.Swal.fire({title:"Almacenamiento",text:"\xbfEsta seguro de realizar el abono?",icon:"question",showCancelButton:!0,confirmButtonColor:"#007bff",confirmButtonText:"Guardar",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,preConfirm:function(e){if(e){var a=o.state,t=JSON.parse(localStorage.getItem("OrusSystem")),n="http://"+t.host+"/api/payments";return a.sale_id=o.props.saleId,a.contact_id=o.props.contactId,a.order_id=o.props.order,console.log("Enviando datos del pago a API para almacenar"),fetch(n,{method:"POST",body:JSON.stringify(a),headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+t.token}}).then(function(){var e=Object(y.a)(N.a.mark((function e(a){var t;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t={},204===a.status){e.next=5;break}return e.next=4,a.json();case 4:t=e.sent;case 5:if(a.ok){e.next=7;break}throw new Error(a.statusText+"("+t.message+")");case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}()).catch((function(e){console.error("Orus fetch",e),window.Swal.fire("Fallo de conexion","Verifique la conexion al servidor","error")}))}}}).then((function(e){if(e&&!e.dismiss&&e.value){var a=e.value;a.data?(console.log("Abono almacenado"),o.props.handleChange(o.state.total),o.setState({metodopago:1,total:0,banco:"",auth:""}),window.Swal.fire({icon:"success",title:"Abono almacenado con exito",showConfirmButton:!1,timer:1500})):(window.Swal.fire("Error","al almacenar el abono","error"),console.error("Orus res: ",a.message))}}))},o.onChangeValue=function(e){var a=e.target,t=a.name,r=a.value,l=a.type;"total"===t&&((r*=1)>o.props.pay?r=o.props.pay:r<0&&(r=0)),"metodopago"!==t&&"number"!==l||(r*=1),o.setState(Object(n.a)({},t,r))},o.state={metodopago:1,total:0,banco:"",auth:""},o}return Object(o.a)(t,[{key:"render",value:function(){return i.a.createElement("div",{className:"modal",tabIndex:"-1",role:"dialog",id:"abonos"},i.a.createElement("div",{className:"modal-dialog"},i.a.createElement("div",{className:"modal-content"},i.a.createElement("div",{className:"modal-header"},i.a.createElement("h5",{className:"modal-title"},"Abono"),i.a.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-label":"Close"},i.a.createElement("span",{"aria-hidden":"true"},"\xd7"))),i.a.createElement("form",{className:"modal-body"},i.a.createElement("div",{className:"row mb-2"},i.a.createElement("div",{className:"col"},i.a.createElement("label",null,"Fecha"),i.a.createElement("input",{type:"text",className:"form-control-plaintext",readOnly:!0,value:f()().format("L")})),i.a.createElement("div",{className:"col"},i.a.createElement("label",null,"Usuario"),i.a.createElement("input",{type:"text",className:"form-control-plaintext",readOnly:!0,value:this.props.user}))),i.a.createElement("div",{className:"row mb-2"},i.a.createElement("div",{className:"col"},i.a.createElement("label",null,"Metodo de pago"),i.a.createElement("select",{name:"metodopago",className:"custom-select",value:this.state.metodopago,onChange:this.onChangeValue},i.a.createElement("option",{value:"1"},"Efectivo"),i.a.createElement("option",{value:"2"},"Tarjeta de debito"),i.a.createElement("option",{value:"3"},"Tarjeta de credito"),i.a.createElement("option",{value:"4"},"La marina"),i.a.createElement("option",{value:"5"},"Cheque"),i.a.createElement("option",{value:"6"},"Transferencia"),i.a.createElement("option",{value:"0"},"Otro"))),i.a.createElement("div",{className:"col"},i.a.createElement("label",null,"Cantidad"),i.a.createElement("input",{type:"number",min:"0",max:this.props.pay,className:"form-control text-right",name:"total",value:this.state.total?this.state.total:"",onChange:this.onChangeValue}))),1!==this.state.metodopago?i.a.createElement("div",{className:"row mb-2"},i.a.createElement("div",{className:"col"},i.a.createElement("label",null,"Banco"),i.a.createElement("input",{type:"text",name:"banco",className:"form-control",value:4===this.state.metodopago?"La marina":this.state.banco,disabled:4===this.state.metodopago,onChange:this.onChangeValue})),i.a.createElement("div",{className:"col"},i.a.createElement("label",null,"N. Autorizaci\xf3n"),i.a.createElement("input",{type:"text",name:"auth",className:"form-control",value:this.state.auth,onChange:this.onChangeValue}))):null),i.a.createElement("div",{className:"modal-footer"},i.a.createElement("button",{type:"button",className:"btn btn-dark","data-dismiss":"modal"},"Cancelar"),i.a.createElement("button",{type:"button",className:"btn btn-success",onClick:this.handlePay,"data-dismiss":"modal"},"Abonar")))))}}]),t}(c.Component),be=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(e){var n;return Object(r.a)(this,t),(n=a.call(this,e)).getContact=function(e){if(e){var a=JSON.parse(localStorage.getItem("OrusSystem"));fetch("http://"+a.host+"/api/contacts/"+e,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+a.token}}).then((function(e){return e.json()})).then((function(e){console.log("Descargando contacto"),n.setState({dataContact:e.data})})).catch((function(e){console.log(e)}))}},n.state={dataContact:[]},n}return Object(o.a)(t,[{key:"componentDidMount",value:function(){this.getContact(this.props.contact)}},{key:"componentDidUpdate",value:function(e,a){e.contact!==this.props.contact&&this.getContact(this.props.contact)}},{key:"render",value:function(){var e=this.props.id,a=this.state.dataContact;return i.a.createElement("div",{className:"d-none d-print-block",style:{width:340},id:e},i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col"},i.a.createElement("div",{className:"card m-0"},i.a.createElement("div",{className:"card-body"},i.a.createElement("h2",{className:"text-center"},i.a.createElement("center",null,i.a.createElement("strong",null,"\xd3ptica Madero"))),i.a.createElement("h4",null,i.a.createElement("em",null,"Julio Cesar Cardenas Martinez",i.a.createElement("br",null),"Tel: 312 312 5353",i.a.createElement("br",null),"Av. Tecnologico 38-A, Vistahermosa, Colima, Col.")),i.a.createElement("hr",null),i.a.createElement("h4",{className:"text-capitalize"},a.nombre,i.a.createElement("br",null),a.telefonos?a.telefonos[0]?a.telefonos[0]:a.telefonos[2]:"--"))))),i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col"},i.a.createElement("center",null,i.a.createElement("h2",{className:"text-center"},"Abono")))))}}]),t}(c.Component),Ne=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(e){var n;return Object(r.a)(this,t),(n=a.call(this,e)).delete=function(e){window.Swal.fire({title:"Eliminar",text:"\xbfEsta seguro de eliminar el abono?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Eliminar",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,preConfirm:function(a){if(a&&e){var t=JSON.parse(localStorage.getItem("OrusSystem"));return console.log("Solicitud de eliminaci\xf3n de venta por API"),fetch("http://"+t.host+"/api/payments/"+e,{method:"DELETE",signal:n.signal,headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+t.token}}).then(function(){var e=Object(y.a)(N.a.mark((function e(a){var t;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t={},204===a.status){e.next=5;break}return e.next=4,a.json();case 4:t=e.sent;case 5:if(a.ok){e.next=7;break}throw new Error(t.message);case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}()).catch((function(e){console.error("Orus fetch",e),window.Swal.fire("Fallo de conexion","Verifique la conexion al servidor","error")}))}}}).then((function(e){e&&!e.dismiss&&e.value?(console.log("Abono eliminado"),window.Swal.fire({icon:"success",title:"Abono eliminado con exito",showConfirmButton:!1,timer:1500}).then((function(e){return n.getPayments()}))):e&&!e.dismiss&&(console.log("Orus res: ",e),window.Swal.fire("Error","Se perdio la conexion con el servidor","error"))}))},n.print=function(e,a,t){var n=document.getElementById("print_pay"),r=document.getElementById("ifmcontentstoprint").contentWindow;r.document.open(),r.document.write(n.innerHTML),r.document.write("<fieldset><h3>"),r.document.write("Fecha: "+a),r.document.write("<br/>Folio: "+t),r.document.write("<br/>Monto: $ "+e.toFixed(2)),r.document.write("</h3></fieldset>"),r.document.close(),r.focus(),r.print()},n.handleLoad=function(e){n.setState({load:e})},n.handleChange=function(e){n.setState({total:n.state.total+e}),n.getPayments()},n.SetMethodPayment=function(e){switch(e){case 1:return i.a.createElement("span",{className:"badge badge-success text-uppercase"},"Efectivo");case 2:return i.a.createElement("span",{className:"badge badge-success text-uppercase"},"Tarjeta debito");case 3:return i.a.createElement("span",{className:"badge badge-success text-uppercase"},"Tarjeta Credito");case 4:return i.a.createElement("span",{className:"badge badge-success text-uppercase"},"La marina");case 5:return i.a.createElement("span",{className:"badge badge-success text-uppercase"},"Cheque");case 6:return i.a.createElement("span",{className:"badge badge-success text-uppercase"},"Transferencia");default:return i.a.createElement("span",{className:"badge badge-success text-uppercase"},"Otro")}},n.getPayments=function(){var e=JSON.parse(localStorage.getItem("OrusSystem")),a="?sale="+n.props.sale;n.state.load||n.setState({load:!0}),console.log("Descargando datos de los pagos"),fetch("http://"+e.host+"/api/payments"+a+"&order=desc",{method:"GET",signal:n.signal,headers:{Accept:"application/json",Authorization:"Bearer "+e.token}}).then((function(e){return e.ok||(window.alert("Ups!\n Hubo un error, intentelo mas tarde"),console.log(e)),e.json()})).then((function(e){if(e.meta&&e.meta.total){console.log("Almacenando abonos");for(var a=0,t=0;t<e.data.length;t++)a+=e.data[t].total;n.props.handleChange("pagado",1*a),n.setState({abonos:e.data,total:a,load:!1})}else n.setState({load:!1})}))},n.state={abonos:[],total:0,load:!0},n.controller=new AbortController,n.signal=n.controller.signal,n}return Object(o.a)(t,[{key:"componentDidMount",value:function(){this.getPayments()}},{key:"componentWillUnmount",value:function(){this.controller.abort()}},{key:"render",value:function(){var e=this,a=this.state,t=a.abonos,n=a.total,r=a.load,o=this.props,l=o.id,s=o.date,c=o.contact,m=o.order,d=o.pay,u=o.user,p=o.sale;return i.a.createElement(i.a.Fragment,null,i.a.createElement("table",{className:"table"},i.a.createElement("thead",null,i.a.createElement("tr",null,i.a.createElement("th",{scope:"col"},"Fecha"),i.a.createElement("th",{scope:"col"},"Metodo de pago"),i.a.createElement("th",{scope:"col"},"Cantidad"),i.a.createElement("th",{scope:"col"},"Recibio"),i.a.createElement("th",{scope:"col"},"Acciones"))),i.a.createElement("tbody",null,t.length&&!r?i.a.createElement(i.a.Fragment,null,t.map((function(a){return i.a.createElement("tr",{key:a.id},i.a.createElement("td",null,f()(a.created_at).format("L")),i.a.createElement("td",null,e.SetMethodPayment(a.metodo),1!==a.metodo?i.a.createElement("span",{className:"ml-4"},a.banco?a.banco:"--"," /"," ",a.Autorizacion?a.Autorizacion:"--"):null),i.a.createElement("td",{className:"text-right"},"$ ",a.total.toFixed(2)),i.a.createElement("td",null,a.created_user),i.a.createElement("td",{className:"text-right"},f()(new Date).isSame(a.created_at,"day")?i.a.createElement("button",{className:"btn btn-black btn-sm",onClick:function(){e.delete(a.id)}},i.a.createElement("i",{className:"fas fa-trash"})):null,i.a.createElement("button",{className:"btn btn-outline-light btn-sm",onClick:function(){e.print(a.total,f()(a.created_at).format("L"),a.id)}},i.a.createElement("i",{className:"fas fa-print"}))))}))):r?i.a.createElement("tr",null,i.a.createElement("td",{colSpan:"5",className:"text-center p-4"},i.a.createElement("div",{className:"spinner-border text-primary mr-4",role:"status"},i.a.createElement("span",{className:"sr-only"},"Loading...")),i.a.createElement("span",{className:"font-weight-light font-italic"},"Espere cargando datos de la venta"))):i.a.createElement("tr",null,i.a.createElement("td",{colSpan:"5",className:"text-center"},"No hay abonos registrados"))),i.a.createElement("tfoot",null,i.a.createElement("tr",null,i.a.createElement("th",{scope:"row",colSpan:"3",className:"text-right"},this.props.pay?i.a.createElement("a",{href:"#abonos",className:this.props.pay?"btn btn-outline-success btn-sm mr-2":"btn btn-outline-success btn-sm mr-2 disabled","data-toggle":"modal","data-target":"#abonos","aria-disabled":!this.props.pay},i.a.createElement("i",{className:"fas fa-money-bill-wave-alt"})):null,"Total: $ ",n.toFixed(2)),i.a.createElement("td",{colSpan:"2"})))),i.a.createElement(ve,{pay:d,user:u,saleId:p,contactId:c,order:m,handleChange:this.handleChange,handleLoad:this.handleLoad}),i.a.createElement(be,{folio:l,date:s,contact:c,id:"print_pay"}))}}]),t}(c.Component),ye=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(e){var n;return Object(r.a)(this,t),(n=a.call(this,e)).getContact=function(e){var a=JSON.parse(localStorage.getItem("OrusSystem"));fetch("http://"+a.host+"/api/contacts/"+e,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+a.token}}).then((function(e){return e.json()})).then((function(e){console.log("Descargando contacto: data",e),n.setState({dataContact:e.data})})).catch((function(e){console.log(e)}))},n.state={dataContact:[]},n}return Object(o.a)(t,[{key:"componentDidUpdate",value:function(e,a){e.contact!==this.props.contact&&this.getContact(this.props.contact)}},{key:"componentDidMount",value:function(){this.getContact(this.props.contact)}},{key:"render",value:function(){var e=this.props,a=e.items,t=e.descuento,n=e.total,r=e.saldo,o=e.abonado,l=e.folio,s=e.date,c=e.id,m=0,d=this.state.dataContact;return i.a.createElement("div",{className:"d-none d-print-block",style:{width:340},id:c},i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col"},i.a.createElement("div",{className:"card m-0"},i.a.createElement("div",{className:"card-body"},i.a.createElement("h2",{className:"text-center"},i.a.createElement("center",null,i.a.createElement("strong",null,"\xd3ptica Madero"))),i.a.createElement("h4",null,i.a.createElement("em",null,"Julio Cesar Cardenas Martinez",i.a.createElement("br",null),"Tel: 312 312 5353",i.a.createElement("br",null),"Av. Tecnologico 38-A, Vistahermosa, Colima, Col.")),i.a.createElement("h4",null,i.a.createElement("i",null,"Folio: ",l),i.a.createElement("br",null),i.a.createElement("i",null,"Fecha: ",s)),i.a.createElement("hr",null),i.a.createElement("h4",{className:"text-capitalize"},d&&d.nombre?d.nombre:"Venta de mostrador",i.a.createElement("br",null),d&&d.telefonos?d.telefonos.t_movil?d.telefonos.t_movil:d.telefonos.t_casa?d.telefonos.t_casa:d.telefonos.t_oficina:"--"))))),i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col"},i.a.createElement("center",null,i.a.createElement("h2",{className:"text-center"},"Pedido")))),i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col"},i.a.createElement("table",{className:"table"},i.a.createElement("thead",null,i.a.createElement("tr",null,i.a.createElement("th",null,i.a.createElement("h4",null,"Cant")),i.a.createElement("th",null,i.a.createElement("h4",null,"Descripcion")),i.a.createElement("th",null,i.a.createElement("h4",null,"Precio")))),i.a.createElement("tbody",null,a.map((function(e,a){return m+=e.cantidad*e.precio,i.a.createElement("tr",{key:a},i.a.createElement("td",null,i.a.createElement("h5",null,e.cantidad)),i.a.createElement("td",null,i.a.createElement("h4",null,e.producto)),i.a.createElement("td",{className:"text-right"},i.a.createElement("h5",null,e.precio.toFixed(2))))}))),i.a.createElement("tfoot",null,i.a.createElement("tr",null,i.a.createElement("td",{className:"text-right",colSpan:"3",style:{textAlign:"right"}},i.a.createElement("h4",null,"Subtotal: ",i.a.createElement("label",null,"$ ",m.toFixed(2))),i.a.createElement("h4",null,"Descuento: ",i.a.createElement("label",null,"$ ",t.toFixed(2))),i.a.createElement("h4",null,"Total: ",i.a.createElement("label",null,"$ ",n.toFixed(2))),i.a.createElement("h4",null,"Abonado: ",i.a.createElement("label",null,"$ ",o.toFixed(2))),i.a.createElement("h4",null,"Saldo: ",i.a.createElement("label",null,"$ ",r.toFixed(2))))))))),i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col"},i.a.createElement("hr",null),i.a.createElement("div",{className:"card"},i.a.createElement("div",{className:"card-body text-center"},i.a.createElement("h4",null,"Armazones usados, viejos y/o resecos son responsabilidad del cliente"))))))}}]),t}(c.Component),we=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(){var e;Object(r.a)(this,t);for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return(e=a.call.apply(a,[this].concat(o))).catchInputs=function(a){e.props.catchInputs(a)},e}return Object(o.a)(t,[{key:"render",value:function(){var e=this.props,a=e.pay,t=e.descuento,n=e.subtotal,r=e.total,o=e.pagado;return i.a.createElement("div",{className:"card card-success card-outline"},i.a.createElement("div",{className:"card-body"},i.a.createElement("h5",{className:"card-title mb-4"},i.a.createElement("i",{className:"fas fa-shield-alt mr-2"}),"Estado de cuenta",a?"":i.a.createElement("span",{className:"badge badge-success ml-2"},"Cuenta liquidada")),i.a.createElement("div",{className:"card-text form-group row"},i.a.createElement("label",{className:"col-6"},"Descuento"),i.a.createElement("div",{className:"col"},i.a.createElement("input",{className:o?"form-control text-right text-success disabled":"form-control text-right text-success",type:"number",name:"descuento",min:"0",max:n-t,readOnly:!(a&&!o),value:t?t.toFixed(2):"",onChange:this.catchInputs}))),i.a.createElement("div",{className:"card-text form-group row"},i.a.createElement("label",{className:"col-6"},"Total"),i.a.createElement("div",{className:"col"},i.a.createElement("input",{className:"form-control text-right text-success",type:"number",name:"total",value:r.toFixed(2),onChange:this.catchInputs,readOnly:!0}))),i.a.createElement("div",{className:"card-text row"},i.a.createElement("label",{className:"col-6 p-2"},"Abonado"),i.a.createElement("h3",{className:"col text-success p-2 text-right"},"$ ",o.toFixed(2))),i.a.createElement("div",{className:"card-text row"},i.a.createElement("label",{className:"col-6 p-2"},"Saldo"),i.a.createElement("h3",{className:"col text-success p-2 text-right"},"$ ",a.toFixed(2)))))}}]),t}(c.Component),xe=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(e){var o;Object(r.a)(this,t),(o=a.call(this,e)).printSale=function(){var e=document.getElementById("print_sale"),a=document.getElementById("ifmcontentstoprint").contentWindow;a.document.open(),a.document.write(e.innerHTML),a.document.close(),a.focus(),a.print()},o.handleChangeInput=function(e,a){var t,r=0;if("items"===e)for(var l=0;l<a.length;l++)r+=a[l].cantidad*a[l].precio;else r=o.state.subtotal;o.setState((t={},Object(n.a)(t,e,a),Object(n.a)(t,"subtotal",r),t))},o.catchInputs=function(e){var a=e.target,t=a.name,r=a.value;"number"===a.type&&(r*=1),"descuento"===t&&r>=o.state.subtotal-o.state.descuento&&(r=o.state.subtotal-1),o.setState(Object(n.a)({},t,r))},o.getIdContact=function(e,a){o.setState({contact_id:e,edad:a})},o.changePage=function(e){o.props.page(e)},o.handleSave=function(e){e.preventDefault();var a=o.state.id;window.Swal.fire({title:"Almacenamiento",text:a?"\xbfEsta seguro de actualizar la venta?":"\xbfEsta seguro de crear una nueva venta?",icon:"question",showCancelButton:!0,confirmButtonColor:"#007bff",confirmButtonText:a?"Actualizar":"Crear",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,preConfirm:function(e){if(e){var t,n=o.state,r=n.host,l=n.token,s=a?"http://"+r+"/api/sales/"+a:"http://"+r+"/api/sales",c=a?"PUT":"POST",i=[];return o.state.items.map((function(e){return i.push({cant:e.cantidad,price:e.precio,subtotal:e.subtotal,inStorage:e.inStorage,out:e.out,session:e.session,store_items_id:e.store_items_id,descripcion:e.descripcion}),!1})),t={session:o.state.session,descuento:o.state.descuento,subtotal:o.state.subtotal,total:o.state.subtotal-o.state.descuento,contact_id:o.state.contact_id,order_id:o.state.order_id?o.state.order_id:"",pagado:o.state.pagado,items:JSON.stringify(i)},console.log("Enviando datos a API para almacenar"),fetch(s,{method:c,body:JSON.stringify(t),headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+l}}).then(function(){var e=Object(y.a)(N.a.mark((function e(a){var t;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t={},204===a.status){e.next=5;break}return e.next=4,a.json();case 4:t=e.sent;case 5:if(a.ok){e.next=7;break}throw new Error(t.message);case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}()).catch((function(e){console.error("Orus fetch",e),window.Swal.fire("Fallo de conexion","Verifique la conexion al servidor","error")}))}}}).then((function(e){if(e&&!e.dismiss&&e.value){var t=e.value;t.data?(console.log("Venta almacenada"),window.Swal.fire({icon:"success",title:a?"Venta actualizada con exito":"Venta almacenada con exito",showConfirmButton:!1,timer:1500}).then((function(e){o.setState({id:t.data.id}),o.props.history.push("/notas/registro/".concat(t.data.id))}))):(window.Swal.fire("Error","al almacenar la venta","error"),console.error("Orus res: ",t.message))}}))},o.getSales=function(e){if(e>0){var a=o.state,t=a.host,n=a.token;console.log("Solicitando datos de pedido a la API"),fetch("http://"+t+"/api/sales/"+e,{method:"GET",signal:o.signal,headers:{Accept:"application/json",Authorization:"Bearer "+n}}).then((function(e){if(!e.ok)throw new Error(e.statusText);return e.json()})).then((function(e){if(e.message)console.error("Orus: ",e.message),window.Swal.fire("Error",e.message,"error"),o.setState({load:!1});else{var a=o.props.data.rol;console.log("Mostrando datos del pedido"),o.setState({id:e.data.id,session:e.data.session?e.data.session:o.state.session,items:e.data.productos,descuento:e.data.descuento,subtotal:e.data.subtotal,total:e.data.total,contact_id:e.data.cliente.id,usuario:e.data.created,date:e.data.created_at,status:a?1:0,order_id:e.data.pedido,pagado:e.data.pagado,load:!1})}})).catch((function(e){console.log("Orus:",e),window.Swal.fire("Fallo de conexion","Verifique la conexion al servidor","error"),o.setState({load:!1})}))}else o.setState({load:!1})};var l=JSON.parse(localStorage.getItem("OrusContactInUse"));return o.state={id:0,session:Math.random().toString(36).substring(2,16)+Math.random().toString(36).substring(2,16)+Math.random().toString(36).substring(2,16)+Math.random().toString(36).substring(2,16)+Math.random().toString(36).substring(2,16)+Math.random().toString(36).substring(2,16)+Math.random().toString(10),descuento:0,subtotal:0,total:0,items:[],contact_id:l&&l.id?l.id:0,order_id:0,status:0,usuario:"",date:Date.now(),load:!0,pagado:0,host:e.data.host,token:e.data.token},o.total=0,o.controller=new AbortController,o.signal=o.controller.signal,o}return Object(o.a)(t,[{key:"componentWillUnmount",value:function(){this.controller.abort()}},{key:"componentDidMount",value:function(){var e=this.props.match.params.id;this.getSales(e)}},{key:"render",value:function(){var e=this,a=this.state,t=a.contact_id,n=a.subtotal,r=a.descuento,o=a.pagado,l=a.items,s=a.status,c=a.id,m=a.session,u=a.load,p=a.date,h=a.order_id,g=n-(r+o),E=this.props.data,v=h?i.a.createElement(le,{data:E,table:"orders",idRow:h,pagado:o}):i.a.createElement(le,{data:E,table:"sales",idRow:c,pagado:o});return this.total=n-r,g=g>0?g:0,i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"row d-print-none"},i.a.createElement("div",{className:"col-3"},i.a.createElement(X,{contact:t,status:s,getIdContact:this.getIdContact,changePage:this.changePage}),t&&l.length?i.a.createElement(we,{pay:g,descuento:r,subtotal:n,total:this.total,pagado:o,catchInputs:this.catchInputs}):null),i.a.createElement("div",{className:"col"},i.a.createElement("div",{className:"card card-success card-outline"},i.a.createElement("div",{className:"card-body"},t&&!u?i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"row mb-4"},i.a.createElement("div",{className:"col-2"},i.a.createElement("div",{className:"border border-success rounded p-2 d-flex justify-content-between align-items-center"},i.a.createElement("span",{className:"badge badge-pill badge-success mx-2"},"Folio"),i.a.createElement("strong",null,c||"Nuevo"))),i.a.createElement("div",{className:"col-4"},i.a.createElement("div",{className:"border border-success rounded p-2 d-flex justify-content-between align-items-center"},i.a.createElement("span",{className:"badge badge-pill badge-success mx-2"},"Creador"),i.a.createElement("strong",null,this.state.usuario?this.state.usuario:this.props.data.name))),i.a.createElement("div",{className:"col-2"},i.a.createElement("div",{className:"border border-success rounded p-2 d-flex justify-content-between align-items-center"},i.a.createElement("span",{className:"badge badge-pill badge-warning mx-2"},"Pedido"),i.a.createElement("strong",null,h?i.a.createElement(d.b,{to:"/pedidos/registro/"+h,onClick:function(a){e.changePage("/pedidos/registro")}},h):"--"))),i.a.createElement("div",{className:"col"},i.a.createElement("div",{className:"border border-success rounded p-2 d-flex justify-content-between align-items-center"},i.a.createElement("span",{className:"badge badge-pill badge-success mx-2"},"Fecha"),i.a.createElement("strong",null,f()(p).format("ll"))))),i.a.createElement(me,{items:l,status:!(!s||this.total!==o),session:m,ChangeInput:this.handleChangeInput})):u?i.a.createElement("div",{className:"text-center p-4"},i.a.createElement("div",{className:"spinner-border text-primary mr-4",role:"status"},i.a.createElement("span",{className:"sr-only"},"Loading...")),i.a.createElement("span",{className:"font-weight-light font-italic"},"Espere cargando datos de la venta")):i.a.createElement("div",{className:"alert alert-light"},i.a.createElement("h4",{className:"alert-heading"},"Nueva nota"),i.a.createElement("p",null,i.a.createElement("i",{className:"fas fa-user mr-1"})," Primero seleccione al cliente!"))),i.a.createElement("div",{className:"card-footer text-right"},i.a.createElement("div",{className:"btn-group",role:"group"},i.a.createElement(d.b,{to:"/notas",className:"btn btn-dark",onClick:function(a){e.changePage("/notas")}},i.a.createElement("i",{className:c?"fas fa-arrow-left mr-2":"fas fa-ban mr-2"}),i.a.createElement("strong",null,c?"Regresar":"Cancelar")),i.a.createElement("button",{className:t&&l.length?"btn btn-dark":"btn btn-dark disabled",onClick:this.printSale,disabled:!t||!l.length},i.a.createElement("i",{className:"fas fa-print mr-2"}),i.a.createElement("strong",null,"Imprimir")),i.a.createElement("button",{className:t&&l.length&&g?"btn btn-success":"btn btn-success disabled",onClick:this.handleSave,disabled:!(t&&l.length&&g)},i.a.createElement("i",{className:"fas fa-save mr-2"}),i.a.createElement("strong",null,"Guardar"))))),t&&c?i.a.createElement("div",{className:"card card-success card-outline"},i.a.createElement("div",{className:"card-body"},i.a.createElement("h5",{className:"card-title mb-4"},i.a.createElement("i",{className:"fas fa-money-bill mr-2"}),"Ultimos Abonos"),i.a.createElement(Ne,{abonos:1*o,sale:1*c,contact:t,pay:1*g,order:1*h,user:this.props.data.name,handleChange:this.handleChangeInput}))):null),c&&t?i.a.createElement("div",{className:"col-3 d-print-none"},v):null),i.a.createElement(ye,{id:"print_sale",folio:c,date:p,items:l,descuento:r,total:this.total,saldo:g,abonado:o,contact:t}))}}]),t}(c.Component),Ce=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(e){var n;return Object(r.a)(this,t),(n=a.call(this,e)).getStockOut=function(){var e=n.state,a=e.host,t=e.token,r="http://"+a+"/api/salesItems";console.log("Descargando stock faltante"),fetch(r+"?stock=false",{method:"GET",signal:n.signal,headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+t}}).then((function(e){return e.ok||401===e.status||(window.alert("Ups!\n Hubo un error, intentelo mas tarde"),console.error("Orus: ",e)),e.json()})).then((function(e){console.log("Almacenando datos de stock"),e.data&&n.setState({stock:e.data})}))},n.state={stock:[],host:e.data.host,token:e.data.token},n.controller=new AbortController,n.signal=n.controller.signal,n}return Object(o.a)(t,[{key:"componentDidMount",value:function(){this.getStockOut()}},{key:"componentWillUnmount",value:function(){this.controller.abort()}},{key:"render",value:function(){var e=this.state.stock;return i.a.createElement("div",{className:"card card-primary card-outline"},i.a.createElement("div",{className:"card-header"},i.a.createElement("h3",{className:"card-title text-primary"},"Articulos en pedido sin stock")),i.a.createElement("div",{className:"card-body"},i.a.createElement("table",{className:"table table-sm"},i.a.createElement("thead",null,i.a.createElement("tr",null,i.a.createElement("th",{scope:"col"},"Producto"),i.a.createElement("th",{scope:"col"},"Pedido"),i.a.createElement("th",{scope:"col"},"Faltante"))),i.a.createElement("tbody",null,e.length?e.map((function(e,a){return i.a.createElement("tr",{key:a},i.a.createElement("td",null,e.producto),i.a.createElement("td",null,e.pedido),i.a.createElement("td",null,e.faltante))})):i.a.createElement("tr",null,i.a.createElement("td",{className:"text-center",colSpan:"3"},"No hay datos"))))))}}]),t}(c.Component),ke=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(e){var o;return Object(r.a)(this,t),(o=a.call(this,e)).changeState=function(e){var a=e.target,t=a.value,r=a.name;"user"===r&&(t*=1),o.setState(Object(n.a)({},r,t))},o.getSaleDay=function(){var e=o.state,a=e.host,t=e.token,n=o.props,r=n.date,l=n.user,s="http://"+a+"/api/saleday",c="?date="+r,i=l?"&user="+l:"";t&&a&&(console.log("Solicitando datos a la API"),fetch(s+c+i,{method:"GET",signal:o.signal,headers:{Accept:"application/json",Authorization:"Bearer "+t}}).then((function(e){return e.ok||(window.Swal.fire({title:"Error!",text:"Ups!\n Hubo un error al descargar las ventas",icon:"error",confirmButtonText:"Ok"}),console.log(e)),e.json()})).then(function(){var e=Object(y.a)(N.a.mark((function e(a){var t,n,r,l,s,c,i;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=window.$("#donutChart").get(0).getContext("2d"),n={maintainAspectRatio:!0,responsive:!0},r=[],l=[],s=0,c=0,i={},o.char&&o.char.destroy(),a.message){e.next=14;break}if(console.log("Mostrando datos de la venta del dia"),!a||!a.length){e.next=9;break}return e.next=7,a.map((function(e){return r.push(o.SetMethodPayment(e.metodopago)),l.push(e.total.toFixed(2)),1===e.metodopago&&(o.props.changeState("ventas",e.total),c=e.total),s+=e.total,null}));case 7:e.next=11;break;case 9:r=["No hay datos"],l=[100];case 11:o.setState({total:s,efectivo:c}),e.next=17;break;case 14:console.error("Error al cargar la venta del dia",a.message),r=["No hay datos"],l=[100];case 17:i={labels:r,datasets:[{data:l,backgroundColor:["#f56954","#00a65a","#f39c12","#00c0ef","#3c8dbc","#d2d6de","#000"]}]},o.char=new window.Chart(t,{type:"pie",data:i,options:n});case 19:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}()).catch((function(e){console.error(e),window.Swal.fire({title:"Error!",text:"Ups!\n Hubo un error de usuario, intentelo mas tarde",icon:"error",confirmButtonText:"Ok"})})))},o.SetMethodPayment=function(e){switch(e){case 1:return"Efectivo";case 2:return"Tarjeta debito";case 3:return"Tarjeta de credito";case 4:return"La marina";case 5:return"Cheque";case 6:return"Transferencia";default:return"Otro"}},o.state={host:e.data.host,rol:e.data.rol,token:e.data.token,total:0,efectivo:0},o.char=null,o.controller=new AbortController,o.signal=o.controller.signal,o}return Object(o.a)(t,[{key:"componentWillUnmount",value:function(){this.controller.abort()}},{key:"componentDidMount",value:function(){this.getSaleDay()}},{key:"componentDidUpdate",value:function(e,a){e.date===this.props.date&&e.user===this.props.user||(console.log("Recarga datos de char"),this.getSaleDay())}},{key:"render",value:function(){var e=this.state,a=e.total,t=e.efectivo,n=e.rol,r=this.props.data;return i.a.createElement("div",{className:"card card-success card-outline"},i.a.createElement("div",{className:"card-header"},i.a.createElement("h3",{className:"card-title text-success"},r.rol?"Mis ventas del dia":"Ventas del dia")),i.a.createElement("div",{className:"card-body"},i.a.createElement("canvas",{id:"donutChart"}),i.a.createElement("p",null,n?null:i.a.createElement(i.a.Fragment,null,"Venta: ",i.a.createElement("strong",null,"$ ",a.toFixed(2)),i.a.createElement("br",null)),"Efectivo: ",i.a.createElement("strong",null,"$ ",t.toFixed(2)))))}}]),t}(c.Component),Se=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(e){var o;return Object(r.a)(this,t),(o=a.call(this,e)).deleteAtm=function(e,a,t){t=t>0?t:-1*t,a=a?"la ENTRADA":"el EGRESO",window.Swal.fire({title:"Eliminar",text:"\xbfEsta seguro de eliminar "+a+" de "+t+"?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Eliminar",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,preConfirm:function(a){var n=o.state,r=n.host,l=n.token;if(a&&t)return console.log("Enviando datos ATM a API"),fetch("http://"+r+"/api/atms/"+e,{method:"DELETE",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+l}}).then(function(){var e=Object(y.a)(N.a.mark((function e(a){var t;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t={},204===a.status){e.next=5;break}return e.next=4,a.json();case 4:t=e.sent;case 5:if(a.ok){e.next=7;break}throw new Error(t.message);case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}()).catch((function(e){console.error("Orus fetch",e),window.Swal.fire("Fallo de conexion","Verifique la conexion al servidor","error")}))}}).then((function(e){e&&!e.dismiss&&e.value?(console.log("Entrada eliminada"),window.Swal.fire({icon:"success",title:"Entrada eliminada con exito",showConfirmButton:!1,timer:1500}).then((function(e){return o.getAtms()}))):e&&!e.dismiss&&(console.log("Orus res: ",e),window.Swal.fire("Error","Se perdio la conexion con el servidor","error"))}))},o.changeState=function(e){var a=e.target,t=a.value,r=a.name;"tipo"===r&&(t*=1),o.setState(Object(n.a)({},r,t))},o.sendAtm=function(){window.Swal.fire({title:"Almacenamiento",text:"\xbfEsta seguro de agregar un movimiento a la caja?",icon:"question",showCancelButton:!0,confirmButtonColor:"#007bff",confirmButtonText:"Crear",cancelButtonText:"Cancelar",showLoaderOnConfirm:!0,preConfirm:function(e){var a=o.state,t=a.host,n=a.token,r=a.efectivo,l=a.tipo,s={efectivo:l?r:-1*r,type:l},c="http://"+t+"/api/atms";if(e&&r)return console.log("Enviando datos ATM a API"),fetch(c,{method:"POST",body:JSON.stringify(s),headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+n}}).then((function(e){if(!e.ok)throw new Error(e.statusText);return e.json()})).catch((function(e){console.error("Orus fetch",e),window.Swal.fire("Fallo de conexion","Verifique la conexion al servidor","error")}))}}).then((function(e){if(e&&!e.dismiss&&e.value){var a=e.value;a.data?(console.log("ATM almacenado"),window.Swal.fire({icon:"success",title:"Movimiento almacenado con exito",showConfirmButton:!1,timer:1500}).then((function(e){return o.getAtms()}))):(window.Swal.fire("Error","al almacenar el movimiento","error"),console.error("Orus res: ",a.message))}}))},o.getAtms=function(){var e=o.state,a=e.host,t=e.token,n=o.props,r=n.date,l=n.user,s="http://"+a+"/api/atms",c="?date="+r,i=l?"&user="+l:"";console.log("Descargando datos de efectivo"),fetch(s+c+i,{method:"GET",signal:o.signal,headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+t}}).then((function(e){return e.ok||401===e.status||(window.Swal.fire({title:"Error!",text:"Ups!\n Hubo un error, intentelo mas tarde",icon:"error"}),console.log(e)),e.json()})).then(function(){var e=Object(y.a)(N.a.mark((function e(a){var t;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Almacenando datos de efectivo"),a.message){e.next=7;break}return t=0,e.next=5,a.data.map((function(e){return t+=e.efectivo,null}));case 5:o.props.changeState("caja",t),o.setState({atms:a.data,efectivo:0});case 7:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}()).catch((function(e){console.error(e),window.Swal.fire({title:"Error!",text:"Ups!\n Hubo un error, intentelo mas tarde",icon:"error"})}))},o.state={atms:[],efectivo:0,tipo:1,host:e.data.host,token:e.data.token},o.controller=new AbortController,o.signal=o.controller.signal,o}return Object(o.a)(t,[{key:"componentDidMount",value:function(){this.getAtms()}},{key:"componentWillUnmount",value:function(){this.controller.abort()}},{key:"componentDidUpdate",value:function(e,a){e.date===this.props.date&&e.user===this.props.user||this.getAtms()}},{key:"render",value:function(){var e=this,a=this.state,t=a.atms,n=a.efectivo,r=a.tipo,o=0;return i.a.createElement("div",{className:"card card-dark card-outline"},i.a.createElement("div",{className:"card-header"},i.a.createElement("h3",{className:"card-title text-dark"},"Movimientos de caja")),i.a.createElement("div",{className:"card-body"},i.a.createElement("table",{className:"table table-sm"},i.a.createElement("thead",null,i.a.createElement("tr",null,i.a.createElement("th",null,"Hora"),i.a.createElement("th",null,"Usuario"),i.a.createElement("th",null,"Tipo"),i.a.createElement("th",null,"Monto"),i.a.createElement("th",null,"D"))),i.a.createElement("tbody",null,t.length?t.map((function(a){return o+=a.efectivo,i.a.createElement("tr",{key:a.id,className:a.efectivo>0?"text-success":"text-danger"},i.a.createElement("td",null,f()(a.created_at).format("LT")),i.a.createElement("td",null,a.created_user),i.a.createElement("td",null,a.tipo?"Ingreso":"Egreso"),i.a.createElement("td",{className:"text-right"},"$",a.efectivo>0?a.efectivo.toFixed(2):(-1*a.efectivo).toFixed(2)),i.a.createElement("th",{className:"text-right"},i.a.createElement("a",{href:"#delete",className:"text-dark",onClick:function(t){t.preventDefault(),e.deleteAtm(a.id,a.tipo,a.efectivo.toFixed(2))}},i.a.createElement("i",{className:"fas fa-trash"}))))})):i.a.createElement("tr",null,i.a.createElement("td",{colSpan:"5",className:"text-center"},"No hay datos"))),i.a.createElement("tfoot",null,i.a.createElement("tr",null,i.a.createElement("td",{colSpan:"3",className:"text-right"},i.a.createElement("label",null,"Total")),i.a.createElement("td",{className:"text-right"},"$ ",o.toFixed(2)),i.a.createElement("td",null))))),i.a.createElement("div",{className:"card-footer"},i.a.createElement("div",{className:"form-group row"},i.a.createElement("label",{className:"col-4 col-form-label"},"Efectivo"),i.a.createElement("div",{className:"col"},i.a.createElement("select",{className:"form-control",name:"tipo",value:r,onChange:this.changeState},i.a.createElement("option",{value:"1"},"Ingresos"),i.a.createElement("option",{value:"0"},"Egreso"))),i.a.createElement("div",{className:"col"},i.a.createElement("input",{type:"number",name:"efectivo",className:"form-control text-right",min:"0",max:"10000",value:n,onChange:this.changeState})),i.a.createElement("div",{className:"col"},i.a.createElement("button",{className:"btn btn-dark",onClick:this.sendAtm,disabled:!(n>0)},"Enviar")))))}}]),t}(c.Component),Oe=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(e){var o;return Object(r.a)(this,t),(o=a.call(this,e)).changeState=function(e){var a=e.target,t=a.value,r=a.name;o.setState(Object(n.a)({},r,t)),o.props.changeState(r,t)},o.getUsers=function(){var e=o.state,a=e.host,t=e.token,n="http://"+a+"/api/users";console.log("Descargando usuarios de API"),fetch(n+"?page=1&orderby=username&order=asc&rol=10",{method:"GET",signal:o.signal,headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+t}}).then((function(e){return e.ok||(window.Swal.fire({title:"Error!",text:"Ups!\n Hubo un error al descargar usuarios de sistema",icon:"error",confirmButtonText:"Ok"}),console.error(e)),e.json()})).then((function(e){e.message?console.error("Error en la descarga de usuarios",e.message):(console.log("Almacenando usuarios"),o.setState({users:e.data}))})).catch((function(e){console.error(e),window.Swal.fire({title:"Error!",text:"Ups!\n Hubo un error de usuario, intentelo mas tarde",icon:"error",confirmButtonText:"Ok"})}))},o.state={host:e.data.host,token:e.data.token,date:f()().format("YYYY-MM-DD"),user:e.data.rol?e.data.idUser:0,users:[]},o.controller=new AbortController,o.signal=o.controller.signal,o}return Object(o.a)(t,[{key:"componentWillUnmount",value:function(){this.controller.abort()}},{key:"componentDidMount",value:function(){this.getUsers()}},{key:"render",value:function(){var e=this.state,a=e.date,t=e.user,n=e.users;return i.a.createElement("div",{className:"card"},i.a.createElement("div",{className:"card-body bg-light"},i.a.createElement("div",{className:"row mb-4"},i.a.createElement("h5",{className:"card-title text-secondary"},"Filtros")),i.a.createElement("div",{className:"form-group row"},i.a.createElement("label",{className:"col col-form-label"},"Fecha"),i.a.createElement("div",{className:"col"},i.a.createElement("input",{type:"date",name:"date",className:"form-control",value:a,onChange:this.changeState}))),i.a.createElement("div",{className:"form-group row"},i.a.createElement("label",{className:"col col-form-label"},"Usuario"),i.a.createElement("div",{className:"col"},i.a.createElement("select",{name:"user",className:"form-control",value:t,onChange:this.changeState},i.a.createElement("option",{value:"0"},"Todos"),n.map((function(e){return i.a.createElement("option",{key:e.id,value:e.id},e.name)})))))))}}]),t}(c.Component),je=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(){return Object(r.a)(this,t),a.apply(this,arguments)}return Object(o.a)(t,[{key:"render",value:function(){var e=this.props,a=e.caja,t=e.ventas,n=a+t;return i.a.createElement("div",{className:"card"},i.a.createElement("div",{className:"card-body bg-light text-right"},i.a.createElement("h5",{className:"card-title text-secondary"},"Corte de caja"),i.a.createElement("p",{className:"card-text"},i.a.createElement("label",null,"caja:")," $",a.toFixed(2)),i.a.createElement("p",{className:"card-text"},i.a.createElement("label",null,"Efectivo:")," $",t.toFixed(2))),i.a.createElement("div",{className:"card-footer text-right"},i.a.createElement("label",null,"Total:")," $",n.toFixed(2)))}}]),t}(c.Component),_e=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(e){var o;return Object(r.a)(this,t),(o=a.call(this,e)).changeState=function(e,a){o.setState(Object(n.a)({},e,a))},o.state={host:e.data.host,token:e.data.token,user:e.data.rol?e.data.idUser:"",date:f()().format("YYYY-MM-DD"),caja:0,ventas:0},o}return Object(o.a)(t,[{key:"render",value:function(){var e=this.state,a=e.user,t=e.date,n=e.caja,r=e.ventas,o=this.props.data;return i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col"},i.a.createElement(ke,{data:o,user:a,date:t,changeState:this.changeState}),o.rol?null:i.a.createElement(Ce,{data:o})),i.a.createElement("div",{className:"col"},i.a.createElement(Se,{data:o,user:a,date:t,changeState:this.changeState})),o.rol?null:i.a.createElement("div",{className:"col-3"},i.a.createElement(Oe,{data:o,changeState:this.changeState}),i.a.createElement(je,{caja:n,ventas:r})))}}]),t}(c.Component),Ie=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(e){var n;return Object(r.a)(this,t),(n=a.call(this,e)).verifyUser=function(){var e=n.props,a=e.data,t=e.logOut,r=a.host,o=a.isLogged,l=a.token;o&&r&&l?(console.log("Verificando usuario"),""!==l&&""!==r&&fetch("http://"+r+"/api/user",{method:"GET",signal:n.signal,headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+l}}).then((function(e){return e.ok||""===l||(console.error("Usuario invalido:",e.statusText),t()),e.json()})).then((function(e){e.message||console.log("Usuario valido:",e.username)}))):(console.error("La sesion ya no esta activa o se perdio el host"),t())},n.handlePage=function(e){var a=n.handleTitleSection(e);n.setState({page:a})},n.handleTitleSection=function(e){""!==(e=e||window.location.pathname)&&"undefined"!==typeof e&&"object"!==typeof e||(e="/");var a=e.split("/");return""===a[1]?"dashboard":a[1]},n.state={page:n.handleTitleSection(window.location.pathname),company:e.data.company},n.controller=new AbortController,n.signal=n.controller.signal,n}return Object(o.a)(t,[{key:"componentWillUnmount",value:function(){this.controller.abort()}},{key:"componentDidMount",value:function(){var e=window.location.pathname,a=this.props.data.rol;1===a&&(e.match(/^\/consultorio/g)||e.match(/^\/usuarios/g)||e.match(/^\/almacen/g)||e.match(/^\/configuraciones/g))&&(window.location.href="/"),2===a&&(e.match(/^\/pedidos/g)||e.match(/^\/usuarios/g)||e.match(/^\/almacen/g)||e.match(/^\/notas/g)||e.match(/^\/configuraciones/g))&&(window.location.href="/"),this.verifyUser()}},{key:"componentDidUpdate",value:function(e,a){this.state.page!==a.page&&this.verifyUser()}},{key:"render",value:function(){var e=this,a=this.props,t=a.data,n=a.logOut;return i.a.createElement("div",{className:"wrapper"},i.a.createElement(p,null),i.a.createElement(h,{companyName:this.state.company,user:t,page:this.handlePage,logOut:n,active:this.state.page}),i.a.createElement("div",{className:"content-wrapper"},i.a.createElement(E,{title:this.state.page}),i.a.createElement("div",{className:"content"},i.a.createElement("div",{className:"container-fluid"},i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-lg-12"},i.a.createElement(u.c,null,i.a.createElement(u.a,{path:"/usuarios/registro/:id?",render:function(a){return i.a.createElement(_,Object.assign({},a,{data:t,page:e.handlePage}))}}),i.a.createElement(u.a,{extric:!0,path:"/usuarios",render:function(a){return i.a.createElement(S,Object.assign({},a,{data:t,page:e.handlePage}))}}),i.a.createElement(u.a,{path:"/almacen/registro/:id?",render:function(a){return i.a.createElement(F,Object.assign({},a,{data:t,page:e.handlePage}))}}),i.a.createElement(u.a,{extric:!0,path:"/almacen",render:function(a){return i.a.createElement(A,Object.assign({},a,{data:t,page:e.handlePage}))}}),i.a.createElement(u.a,{path:"/contactos/registro/:id?",render:function(a){return i.a.createElement($,Object.assign({},a,{data:t,page:e.handlePage}))}}),i.a.createElement(u.a,{extric:!0,path:"/contactos/add",render:function(a){return i.a.createElement(Z,Object.assign({},a,{data:t,page:e.handlePage}))}}),i.a.createElement(u.a,{extric:!0,path:"/contactos",render:function(a){return i.a.createElement(D,Object.assign({},a,{data:t,page:e.handlePage}))}}),i.a.createElement(u.a,{extric:!0,path:"/consultorio/registro/:id?",render:function(a){return i.a.createElement(se,Object.assign({},a,{data:t,page:e.handlePage}))}}),i.a.createElement(u.a,{extric:!0,path:"/consultorio",render:function(a){return i.a.createElement(Y,Object.assign({},a,{data:t,page:e.handlePage}))}}),i.a.createElement(u.a,{extric:!0,path:"/configuraciones",render:function(a){return i.a.createElement(K,Object.assign({},a,{data:t,page:e.handlePage}))}}),i.a.createElement(u.a,{extric:!0,path:"/pedidos/registro/:id?",render:function(a){return i.a.createElement(ge,Object.assign({},a,{data:t,page:e.handlePage}))}}),i.a.createElement(u.a,{extric:!0,path:"/pedidos",render:function(a){return i.a.createElement(ie,Object.assign({},a,{data:t,page:e.handlePage}))}}),i.a.createElement(u.a,{extric:!0,path:"/notas/registro/:id?",render:function(a){return i.a.createElement(xe,Object.assign({},a,{data:t,page:e.handlePage}))}}),i.a.createElement(u.a,{extric:!0,path:"/notas",render:function(a){return i.a.createElement(Ee,Object.assign({},a,{data:t,page:e.handlePage}))}}),i.a.createElement(u.a,{extric:!0,path:"/",render:function(a){return i.a.createElement(_e,Object.assign({},a,{data:t,page:e.handlePage}))}}))))))),i.a.createElement(v,null))}}]),t}(c.Component),Ae=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(e){var o;return Object(r.a)(this,t),(o=a.call(this,e)).pressEnter=function(e){if(e.preventDefault(),"Enter"===e.key){var a=o.state.host;window.Swal.fire({icon:"success",title:"La conexion al servidor fue actualizada con exito: "+a,showConfirmButton:!1,timer:1500}).then((function(e){o.setState({hostShow:!1}),o.props.changeState("host",a)}))}},o.showTools=function(e){e.preventDefault(),o.setState({hostShow:!o.state.hostShow})},o.handleLogin=function(e){e.preventDefault();var a=o.state,t=a.host,n=a.username,r=a.password;if(o.setState({load:!0}),t){var l={email:n,password:r};o.validInputs()?(console.log("Enviado credenciales al servidor"),fetch("http://"+t+"/api/users/login",{method:"POST",body:JSON.stringify(l),signal:o.signal,headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(){var e=Object(y.a)(N.a.mark((function e(a){var t;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t={},204===a.status){e.next=5;break}return e.next=4,a.json();case 4:t=e.sent;case 5:if(a.ok){e.next=7;break}throw new Error(t.message);case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}()).then((function(e){e.data?(console.log("Loggin: realizado con exito"),o.props.loginFunction(e)):(console.error("Login: Sin acceso",e),e.message&&window.Swal.fire("Session",e.message,"error"),e.errors&&window.Swal.fire("Session",e.errors,"error"),o.setState({load:!1}))})).catch((function(e){console.error("Orus fetch: ",e),window.Swal.fire("Fallo de servidor","Los datos no son correctos","error"),o.setState({load:!1})}))):o.setState({load:!1})}else console.error("No existe un valor para host"),o.setState({hostShow:!0,load:!1})},o.catchInputs=function(e){var a=e.target,t=a.name,r=a.value;o.setState(Object(n.a)({},t,r))},o.state={username:"",password:"",host:e.host,hostShow:!1,load:!1},o.controller=new AbortController,o.signal=o.controller.signal,o}return Object(o.a)(t,[{key:"componentWillUnmount",value:function(){this.controller.abort()}},{key:"render",value:function(){var e=this.state,a=e.load,t=e.username,n=e.password,r=e.hostShow,o=e.host,l=this.props.company;return i.a.createElement("div",{className:"login-page"},i.a.createElement("div",{className:"login-box"},i.a.createElement("div",{className:"login-logo"},i.a.createElement("a",{href:"."},i.a.createElement("b",{className:"text-primary"},"Orus")," LTE")),i.a.createElement("div",{className:"card"},i.a.createElement("div",{className:"card-body login-card-body"},i.a.createElement("p",{className:"login-box-msg"},l),i.a.createElement("form",{onSubmit:this.handleLogin},i.a.createElement("div",{className:"input-group mb-3"},i.a.createElement("input",{type:"email",className:"form-control",placeholder:"Usuario",name:"username",required:"required",autoFocus:!r,onChange:this.catchInputs,value:t}),i.a.createElement("div",{className:"input-group-append"},i.a.createElement("div",{className:"input-group-text"},i.a.createElement("span",{className:"fas fa-user"})))),i.a.createElement("div",{className:"input-group mb-3"},i.a.createElement("input",{type:"password",className:"form-control",placeholder:"Contrase\xf1a",name:"password",required:"required",minLength:"8",maxLength:"16",pattern:"^(?=.*[A-Z])(?=.*[!@#$&\\.*])(?=.*[0-9])(?=.*[a-z]).{8,16}$",autoComplete:"off",onChange:this.catchInputs,value:n}),i.a.createElement("div",{className:"input-group-append"},i.a.createElement("div",{className:"input-group-text"},i.a.createElement("span",{className:"fas fa-lock"})))),i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-12 mb-4"},i.a.createElement("a",{href:"#tools",onClick:this.showTools,className:"text-muted"},i.a.createElement("i",{className:"fas fa-wifi"})," Servidor"),r?i.a.createElement("div",{className:"input-group mb-3"},i.a.createElement("input",{type:"text",className:"form-control",placeholder:"Servidor",name:"host",autoComplete:"off",autoFocus:!!r,onChange:this.catchInputs,value:o,onKeyPress:this.pressEnter}),i.a.createElement("div",{className:"input-group-append"},i.a.createElement("div",{className:"input-group-text"},i.a.createElement("span",{className:"fas fa-server"})))):"")),i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-12 text-center"},a?i.a.createElement("div",{className:"spinner-border text-primary",role:"status"},i.a.createElement("span",{className:"sr-only"},"Loading...")):i.a.createElement("button",{type:"submit",className:"btn btn-primary btn-block"},"Iniciar sesion"))))))))}},{key:"validInputs",value:function(){var e=this.state,a=e.username,t=e.password;return a=a.replace(/\s/g,"").toLowerCase(),!(!/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(a)||!/^(?=.*[A-Z])(?=.*[!@#$&.*])(?=.*[0-9])(?=.*[a-z]).{8,16}$/.test(t))||(alert("Los datos ingresados no son validos"),!1)}}]),t}(c.Component),Te=function(e){Object(l.a)(t,e);var a=Object(s.a)(t);function t(e){var o;Object(r.a)(this,t),(o=a.call(this,e)).changeState=function(e,a){o.setState(Object(n.a)({},e,a))},o.login=function(e){o.setState({isLogged:!!e.data.id,idUser:e.data.id,username:e.data.username,name:e.data.name,email:e.data.email,rol:e.data.rol,token:e.token})},o.logOut=function(){var e={isLogged:!1,token:"",idUser:0,username:"",name:"",rol:0,email:"",host:o.state.host,company:o.state.company};console.log("La session ha sido cerrada"),localStorage.setItem("OrusSystem",JSON.stringify(e)),window.location.href="/"};var l=JSON.parse(localStorage.getItem("OrusSystem"));return o.state={isLogged:!!l&&l.isLogged,token:l?l.token:"",idUser:l?l.idUser:0,username:l?l.username:"",name:l?l.name:"",rol:l?l.rol:0,email:l?l.email:"",host:l?l.host:window.location.hostname,company:l?l.company:"Optica Madero"},o}return Object(o.a)(t,[{key:"componentDidMount",value:function(){console.log("Cargando data a storage"),localStorage.setItem("OrusSystem",JSON.stringify(this.state))}},{key:"componentDidUpdate",value:function(){console.log("Actualizando data a storage"),localStorage.setItem("OrusSystem",JSON.stringify(this.state))}},{key:"render",value:function(){return i.a.createElement(d.a,null,i.a.createElement("main",null,this.state.isLogged?i.a.createElement(Ie,{data:this.state,logOut:this.logOut}):i.a.createElement(Ae,{company:this.state.company,host:this.state.host,loginFunction:this.login,changeState:this.changeState})))}}]),t}(c.Component);Object(m.render)(i.a.createElement(Te,null),document.getElementById("root"))}},[[26,1,2]]]);
//# sourceMappingURL=main.aa684bb0.chunk.js.map